\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling}{\section{Q\-U\-E\-S\-O\-:\-:M\-L\-Sampling$<$ P\-\_\-\-V, P\-\_\-\-M $>$ Class Template Reference}
\label{class_q_u_e_s_o_1_1_m_l_sampling}\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling$<$ P\-\_\-\-V, P\-\_\-\-M $>$@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling$<$ P\-\_\-\-V, P\-\_\-\-M $>$}}
}


A templated class that represents a Multilevel generator of samples.  




{\ttfamily \#include $<$M\-L\-Sampling.\-h$>$}



Collaboration diagram for Q\-U\-E\-S\-O\-:\-:M\-L\-Sampling$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_q_u_e_s_o_1_1_m_l_sampling__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{Indent}{\bf Constructor/\-Destructor methods}\par
\begin{DoxyCompactItemize}
\item 
\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7738e481975c7ca2a47fa763bb92bdbe}{M\-L\-Sampling} (const char $\ast$prefix, const \hyperlink{class_q_u_e_s_o_1_1_base_vector_r_v}{Base\-Vector\-R\-V}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&prior\-Rv, const \hyperlink{class_q_u_e_s_o_1_1_base_scalar_function}{Base\-Scalar\-Function}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&likelihood\-Function)
\begin{DoxyCompactList}\small\item\em Constructor. \end{DoxyCompactList}\item 
\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ad3f442d1cac363497d04a4c8f8cf76c3}{$\sim$\-M\-L\-Sampling} ()
\begin{DoxyCompactList}\small\item\em Destructor. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\begin{Indent}{\bf Statistical methods}\par
\begin{DoxyCompactItemize}
\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a8d7296b30623c73ada38971cae27994a}{generate\-Sequence} (\hyperlink{class_q_u_e_s_o_1_1_base_vector_sequence}{Base\-Vector\-Sequence}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&working\-Chain, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ $\ast$working\-Log\-Likelihood\-Values, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ $\ast$working\-Log\-Target\-Values)
\begin{DoxyCompactList}\small\item\em Method to generate the chain. \end{DoxyCompactList}\item 
double \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ae870f4b12060ae67d0c4473828b142f1}{log\-Evidence} () const 
\begin{DoxyCompactList}\small\item\em Method to calculate the logarithm of the evidence. \end{DoxyCompactList}\item 
double \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ace6bbf605f8b655e0671d20309160941}{mean\-Log\-Likelihood} () const 
\begin{DoxyCompactList}\small\item\em Method to calculate the mean of the logarithm of the likelihood. \end{DoxyCompactList}\item 
double \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a31f7f977a3d42a06fdcd2918cc31bb40}{eig} () const 
\begin{DoxyCompactList}\small\item\em Calculates the expected information gain value, E\-I\-G. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\begin{Indent}{\bf I/\-O methods}\par
\begin{DoxyCompactItemize}
\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aec103dbc7af1af9e982d8c162033e77b}{print} (std\-::ostream \&os) const 
\begin{DoxyCompactList}\small\item\em T\-O\-D\-O\-: Prints the sequence. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aa8e7bb1bd54ccafb9b276127a76eba71}{checkpoint\-M\-L} (double curr\-Exponent, double curr\-Eta, const \hyperlink{class_q_u_e_s_o_1_1_sequence_of_vectors}{Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&curr\-Chain, const \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&curr\-Log\-Likelihood\-Values, const \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&curr\-Log\-Target\-Values)
\begin{DoxyCompactList}\small\item\em Writes checkpoint data for the M\-L method. \end{DoxyCompactList}\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aa387be291dd763ce001ea769e87266c4}{restart\-M\-L} (double \&curr\-Exponent, double \&curr\-Eta, \hyperlink{class_q_u_e_s_o_1_1_sequence_of_vectors}{Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&curr\-Chain, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&curr\-Log\-Likelihood\-Values, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&curr\-Log\-Target\-Values)
\begin{DoxyCompactList}\small\item\em Restarts M\-L algorithm. \end{DoxyCompactList}\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a0a2615d8f3627630d0cb62cb91614bd1}{generate\-Sequence\-\_\-\-Level0\-\_\-all} (const \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_level_options}{M\-L\-Sampling\-Level\-Options} \&curr\-Options, unsigned int \&unified\-Requested\-Num\-Samples, \hyperlink{class_q_u_e_s_o_1_1_sequence_of_vectors}{Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&curr\-Chain, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&curr\-Log\-Likelihood\-Values, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&curr\-Log\-Target\-Values)
\begin{DoxyCompactList}\small\item\em Generates the sequence at the level 0. \end{DoxyCompactList}\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aea8da13aed5b04e64b8490ca5f107889}{generate\-Sequence\-\_\-\-Step01\-\_\-inter0} (const \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_level_options}{M\-L\-Sampling\-Level\-Options} $\ast$curr\-Options, unsigned int \&unified\-Requested\-Num\-Samples)
\begin{DoxyCompactList}\small\item\em Reads options for the M\-L algorithm (Step 01 from M\-L algorithm). \end{DoxyCompactList}\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a06c37730b943a1838d58475d322639b9}{generate\-Sequence\-\_\-\-Step02\-\_\-inter0} (const \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_level_options}{M\-L\-Sampling\-Level\-Options} $\ast$curr\-Options, \hyperlink{class_q_u_e_s_o_1_1_sequence_of_vectors}{Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&curr\-Chain, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&curr\-Log\-Likelihood\-Values, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&curr\-Log\-Target\-Values, \hyperlink{class_q_u_e_s_o_1_1_sequence_of_vectors}{Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&prev\-Chain, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&prev\-Log\-Likelihood\-Values, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&prev\-Log\-Target\-Values, unsigned int \&index\-Of\-First\-Weight, unsigned int \&index\-Of\-Last\-Weight)
\begin{DoxyCompactList}\small\item\em Saves chain and corresponding target pdf values from previous level (Step 02 from M\-L algorithm). \end{DoxyCompactList}\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ae53e6bc0ec5d1f3d3ac9df268086cd75}{generate\-Sequence\-\_\-\-Step03\-\_\-inter0} (const \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_level_options}{M\-L\-Sampling\-Level\-Options} $\ast$curr\-Options, const \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&prev\-Log\-Likelihood\-Values, double prev\-Exponent, double failed\-Exponent, double \&curr\-Exponent, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&weight\-Sequence)
\begin{DoxyCompactList}\small\item\em Computes {\ttfamily curr\-Exponent} and sequence of weights for current level and update 'm\-\_\-log\-Evidence\-Factors' (Step 03 from M\-L algorithm). \end{DoxyCompactList}\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a955fb446652327edbc275e3d9145e2db}{generate\-Sequence\-\_\-\-Step04\-\_\-inter0} (const \hyperlink{class_q_u_e_s_o_1_1_sequence_of_vectors}{Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&prev\-Chain, const \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&weight\-Sequence, P\-\_\-\-M \&unified\-Cov\-Matrix)
\begin{DoxyCompactList}\small\item\em Creates covariance matrix for current level (Step 04 from M\-L algorithm). \end{DoxyCompactList}\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a3db529d364d5bb47916066d7cc21cb00}{generate\-Sequence\-\_\-\-Step05\-\_\-inter0} (unsigned int unified\-Requested\-Num\-Samples, const \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&weight\-Sequence, std\-::vector$<$ unsigned int $>$ \&unified\-Index\-Counters\-At\-Proc0\-Only, std\-::vector$<$ double $>$ \&unified\-Weight\-Std\-Vector\-At\-Proc0\-Only)
\begin{DoxyCompactList}\small\item\em Creates {\bfseries unified} finite distribution for current level (Step 05 from M\-L algorithm). \end{DoxyCompactList}\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a21f642100e0690f65563e2c1f8bed816}{generate\-Sequence\-\_\-\-Step06\-\_\-all} (const \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_level_options}{M\-L\-Sampling\-Level\-Options} $\ast$curr\-Options, unsigned int index\-Of\-First\-Weight, unsigned int index\-Of\-Last\-Weight, const std\-::vector$<$ unsigned int $>$ \&unified\-Index\-Counters\-At\-Proc0\-Only, bool \&use\-Balanced\-Chains, std\-::vector$<$ \hyperlink{struct_q_u_e_s_o_1_1_exchange_info_struct}{Exchange\-Info\-Struct} $>$ \&exchange\-Std\-Vec)
\begin{DoxyCompactList}\small\item\em Decides on wheter or not to use balanced chains (Step 06 from M\-L algorithm). \end{DoxyCompactList}\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a270d639f90f6f2c60d1af851eea63d41}{generate\-Sequence\-\_\-\-Step07\-\_\-inter0} (bool use\-Balanced\-Chains, unsigned int index\-Of\-First\-Weight, unsigned int index\-Of\-Last\-Weight, const std\-::vector$<$ unsigned int $>$ \&unified\-Index\-Counters\-At\-Proc0\-Only, \hyperlink{struct_q_u_e_s_o_1_1_unbalanced_linked_chains_per_node_struct}{Unbalanced\-Linked\-Chains\-Per\-Node\-Struct} \&unbalanced\-Link\-Control, const \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_level_options}{M\-L\-Sampling\-Level\-Options} $\ast$curr\-Options, const \hyperlink{class_q_u_e_s_o_1_1_sequence_of_vectors}{Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&prev\-Chain, std\-::vector$<$ \hyperlink{struct_q_u_e_s_o_1_1_exchange_info_struct}{Exchange\-Info\-Struct} $>$ \&exchange\-Std\-Vec, \hyperlink{struct_q_u_e_s_o_1_1_balanced_linked_chains_per_node_struct}{Balanced\-Linked\-Chains\-Per\-Node\-Struct}$<$ P\-\_\-\-V $>$ \&balanced\-Link\-Control)
\begin{DoxyCompactList}\small\item\em Plans for number of linked chains for each node so that all nodes generate the closest possible to the same number of positions (Step 07 from M\-L algorithm). \end{DoxyCompactList}\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a754bc11c7802f627fece9f063450739a}{generate\-Sequence\-\_\-\-Step08\-\_\-all} (\hyperlink{class_q_u_e_s_o_1_1_bayesian_joint_pdf}{Bayesian\-Joint\-Pdf}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&curr\-Pdf, \hyperlink{class_q_u_e_s_o_1_1_generic_vector_r_v}{Generic\-Vector\-R\-V}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&curr\-Rv)
\begin{DoxyCompactList}\small\item\em Creates a vector R\-V for current level (Step 08 from M\-L algorithm). \end{DoxyCompactList}\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a26892288f3b1902d78ba049b96579a08}{generate\-Sequence\-\_\-\-Step09\-\_\-all} (const \hyperlink{class_q_u_e_s_o_1_1_sequence_of_vectors}{Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&prev\-Chain, unsigned int index\-Of\-First\-Weight, unsigned int index\-Of\-Last\-Weight, const std\-::vector$<$ double $>$ \&unified\-Weight\-Std\-Vector\-At\-Proc0\-Only, const \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&weight\-Sequence, double prev\-Eta, const \hyperlink{class_q_u_e_s_o_1_1_generic_vector_r_v}{Generic\-Vector\-R\-V}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&curr\-Rv, \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_level_options}{M\-L\-Sampling\-Level\-Options} $\ast$curr\-Options, P\-\_\-\-M \&unified\-Cov\-Matrix, double \&curr\-Eta)
\begin{DoxyCompactList}\small\item\em Scales the unified covariance matrix until min $<$= rejection rate $<$= max (Step 09 from M\-L algorithm). \end{DoxyCompactList}\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a04322fda4c97eee6c6739fc007d642c1}{generate\-Sequence\-\_\-\-Step10\-\_\-all} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_level_options}{M\-L\-Sampling\-Level\-Options} \&curr\-Options, const P\-\_\-\-M \&unified\-Cov\-Matrix, const \hyperlink{class_q_u_e_s_o_1_1_generic_vector_r_v}{Generic\-Vector\-R\-V}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&curr\-Rv, bool use\-Balanced\-Chains, const \hyperlink{struct_q_u_e_s_o_1_1_unbalanced_linked_chains_per_node_struct}{Unbalanced\-Linked\-Chains\-Per\-Node\-Struct} \&unbalanced\-Link\-Control, unsigned int index\-Of\-First\-Weight, const \hyperlink{class_q_u_e_s_o_1_1_sequence_of_vectors}{Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&prev\-Chain, const \hyperlink{struct_q_u_e_s_o_1_1_balanced_linked_chains_per_node_struct}{Balanced\-Linked\-Chains\-Per\-Node\-Struct}$<$ P\-\_\-\-V $>$ \&balanced\-Link\-Control, \hyperlink{class_q_u_e_s_o_1_1_sequence_of_vectors}{Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&curr\-Chain, double \&cumulative\-Raw\-Chain\-Run\-Time, unsigned int \&cumulative\-Raw\-Chain\-Rejections, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ $\ast$curr\-Log\-Likelihood\-Values, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ $\ast$curr\-Log\-Target\-Values)
\begin{DoxyCompactList}\small\item\em Samples the vector R\-V of current level (Step 10 from M\-L algorithm). \end{DoxyCompactList}\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aae527304bc1012a91ffc396e94fbab11}{generate\-Sequence\-\_\-\-Step11\-\_\-inter0} (const \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_level_options}{M\-L\-Sampling\-Level\-Options} $\ast$curr\-Options, unsigned int unified\-Requested\-Num\-Samples, unsigned int cumulative\-Raw\-Chain\-Rejections, \hyperlink{class_q_u_e_s_o_1_1_sequence_of_vectors}{Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&curr\-Chain, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&curr\-Log\-Likelihood\-Values, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ \&curr\-Log\-Target\-Values, unsigned int \&unified\-Number\-Of\-Rejections)
\begin{DoxyCompactList}\small\item\em Filters chain (Step 11 from M\-L algorithm). \end{DoxyCompactList}\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af71979655e46135b6a3c97b8909321f0}{sample\-Indexes\-\_\-proc0} (unsigned int unified\-Requested\-Num\-Samples, const std\-::vector$<$ double $>$ \&unified\-Weight\-Std\-Vector\-At\-Proc0\-Only, std\-::vector$<$ unsigned int $>$ \&unified\-Index\-Counters\-At\-Proc0\-Only)
\item 
bool \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a0f6f7872635b9546b3215fee347601f6}{decide\-On\-Balanced\-Chains\-\_\-all} (const \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_level_options}{M\-L\-Sampling\-Level\-Options} $\ast$curr\-Options, unsigned int index\-Of\-First\-Weight, unsigned int index\-Of\-Last\-Weight, const std\-::vector$<$ unsigned int $>$ \&unified\-Index\-Counters\-At\-Proc0\-Only, std\-::vector$<$ \hyperlink{struct_q_u_e_s_o_1_1_exchange_info_struct}{Exchange\-Info\-Struct} $>$ \&exchange\-Std\-Vec)
\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75b2d73a0b07f594951a89cc1bc96849}{prepare\-Bal\-Linked\-Chains\-\_\-inter0} (const \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_level_options}{M\-L\-Sampling\-Level\-Options} $\ast$curr\-Options, const \hyperlink{class_q_u_e_s_o_1_1_sequence_of_vectors}{Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&prev\-Chain, std\-::vector$<$ \hyperlink{struct_q_u_e_s_o_1_1_exchange_info_struct}{Exchange\-Info\-Struct} $>$ \&exchange\-Std\-Vec, \hyperlink{struct_q_u_e_s_o_1_1_balanced_linked_chains_per_node_struct}{Balanced\-Linked\-Chains\-Per\-Node\-Struct}$<$ P\-\_\-\-V $>$ \&balanced\-Link\-Control)
\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a37dcf4d893b6c8f67fe077892bada773}{prepare\-Unb\-Linked\-Chains\-\_\-inter0} (unsigned int index\-Of\-First\-Weight, unsigned int index\-Of\-Last\-Weight, const std\-::vector$<$ unsigned int $>$ \&unified\-Index\-Counters\-At\-Proc0\-Only, \hyperlink{struct_q_u_e_s_o_1_1_unbalanced_linked_chains_per_node_struct}{Unbalanced\-Linked\-Chains\-Per\-Node\-Struct} \&unbalanced\-Link\-Control)
\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a8e9d7681d17623c726814d206c8be4b2}{generate\-Bal\-Linked\-Chains\-\_\-all} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_level_options}{M\-L\-Sampling\-Level\-Options} \&input\-Options, const P\-\_\-\-M \&unified\-Cov\-Matrix, const \hyperlink{class_q_u_e_s_o_1_1_generic_vector_r_v}{Generic\-Vector\-R\-V}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&rv, const \hyperlink{struct_q_u_e_s_o_1_1_balanced_linked_chains_per_node_struct}{Balanced\-Linked\-Chains\-Per\-Node\-Struct}$<$ P\-\_\-\-V $>$ \&balanced\-Link\-Control, \hyperlink{class_q_u_e_s_o_1_1_sequence_of_vectors}{Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&working\-Chain, double \&cumulative\-Run\-Time, unsigned int \&cumulative\-Rejections, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ $\ast$curr\-Log\-Likelihood\-Values, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ $\ast$curr\-Log\-Target\-Values)
\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a04b0d797b321bb5c4047aab89a445e3c}{generate\-Unb\-Linked\-Chains\-\_\-all} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_level_options}{M\-L\-Sampling\-Level\-Options} \&input\-Options, const P\-\_\-\-M \&unified\-Cov\-Matrix, const \hyperlink{class_q_u_e_s_o_1_1_generic_vector_r_v}{Generic\-Vector\-R\-V}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&rv, const \hyperlink{struct_q_u_e_s_o_1_1_unbalanced_linked_chains_per_node_struct}{Unbalanced\-Linked\-Chains\-Per\-Node\-Struct} \&unbalanced\-Link\-Control, unsigned int index\-Of\-First\-Weight, const \hyperlink{class_q_u_e_s_o_1_1_sequence_of_vectors}{Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&prev\-Chain, \hyperlink{class_q_u_e_s_o_1_1_sequence_of_vectors}{Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&working\-Chain, double \&cumulative\-Run\-Time, unsigned int \&cumulative\-Rejections, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ $\ast$curr\-Log\-Likelihood\-Values, \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence}{Scalar\-Sequence}$<$ double $>$ $\ast$curr\-Log\-Target\-Values)
\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a44ff302d505e5de781ea6635ea0d85d9}{just\-Balance\-\_\-proc0} (const \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_level_options}{M\-L\-Sampling\-Level\-Options} $\ast$curr\-Options, std\-::vector$<$ \hyperlink{struct_q_u_e_s_o_1_1_exchange_info_struct}{Exchange\-Info\-Struct} $>$ \&exchange\-Std\-Vec)
\item 
void \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1bb275df38553b88e2196103c7f5ea46}{mpi\-Exchange\-Positions\-\_\-inter0} (const \hyperlink{class_q_u_e_s_o_1_1_sequence_of_vectors}{Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&prev\-Chain, const std\-::vector$<$ \hyperlink{struct_q_u_e_s_o_1_1_exchange_info_struct}{Exchange\-Info\-Struct} $>$ \&exchange\-Std\-Vec, const std\-::vector$<$ unsigned int $>$ \&final\-Num\-Chains\-Per\-Node, const std\-::vector$<$ unsigned int $>$ \&final\-Num\-Positions\-Per\-Node, \hyperlink{struct_q_u_e_s_o_1_1_balanced_linked_chains_per_node_struct}{Balanced\-Linked\-Chains\-Per\-Node\-Struct}$<$ P\-\_\-\-V $>$ \&balanced\-Link\-Control)
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
const \hyperlink{class_q_u_e_s_o_1_1_base_environment}{Base\-Environment} \& \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\-\_\-env}
\begin{DoxyCompactList}\small\item\em Queso enviroment. \end{DoxyCompactList}\item 
const \hyperlink{class_q_u_e_s_o_1_1_base_vector_r_v}{Base\-Vector\-R\-V}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \& \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aa45e9c06bd51cae0dc2294af1831c158}{m\-\_\-prior\-Rv}
\begin{DoxyCompactList}\small\item\em Prior R\-V. \end{DoxyCompactList}\item 
const \hyperlink{class_q_u_e_s_o_1_1_base_scalar_function}{Base\-Scalar\-Function}$<$ P\-\_\-\-V, \\*
P\-\_\-\-M $>$ \& \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ab08c3059d23460db49b229aa88bd4e70}{m\-\_\-likelihood\-Function}
\begin{DoxyCompactList}\small\item\em Likelihood function. \end{DoxyCompactList}\item 
const \hyperlink{class_q_u_e_s_o_1_1_vector_space}{Vector\-Space}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \& \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\-\_\-vector\-Space}
\begin{DoxyCompactList}\small\item\em \hyperlink{class_q_u_e_s_o_1_1_vector}{Vector} space. \end{DoxyCompactList}\item 
\hyperlink{class_q_u_e_s_o_1_1_vector_set}{Vector\-Set}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ $\ast$ \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a21525858e93a7d9654fdf68c8ac25576}{m\-\_\-target\-Domain}
\begin{DoxyCompactList}\small\item\em Domain of the target P\-D\-F\-: intersection of the domains of the prior P\-Df and likelihood function. \end{DoxyCompactList}\item 
unsigned int \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_afbe27e6149562020663b72da6592d933}{m\-\_\-num\-Disabled\-Parameters}
\item 
std\-::vector$<$ bool $>$ \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ac76690384f70d74b8662faf7a051449e}{m\-\_\-parameter\-Enabled\-Status}
\item 
\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_options}{M\-L\-Sampling\-Options} \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\-\_\-options}
\begin{DoxyCompactList}\small\item\em Options for the M\-L algorithm. \end{DoxyCompactList}\item 
unsigned int \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\-\_\-curr\-Level}
\begin{DoxyCompactList}\small\item\em Current level. \end{DoxyCompactList}\item 
unsigned int \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\-\_\-curr\-Step}
\begin{DoxyCompactList}\small\item\em Curret step. \end{DoxyCompactList}\item 
double \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_abdd5cd35419283c33cc40a77d0f4f07f}{m\-\_\-debug\-Exponent}
\begin{DoxyCompactList}\small\item\em Exponent for debugging. \end{DoxyCompactList}\item 
std\-::vector$<$ double $>$ \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\-\_\-log\-Evidence\-Factors}
\item 
double \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_afad63c42dccb1518319bf677f2bffde0}{m\-\_\-log\-Evidence}
\item 
double \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aec4229773274b58e3eaa49a77738389f}{m\-\_\-mean\-Log\-Likelihood}
\item 
double \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_abec7f8cf9da08bc5c0a20d99fa4570af}{m\-\_\-eig}
\end{DoxyCompactItemize}
\subsection*{Friends}
\begin{DoxyCompactItemize}
\item 
std\-::ostream \& \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a5a8aa9e185dfa1698ec94d6709895d2c}{operator$<$$<$} (std\-::ostream \&os, const \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling}{M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&obj)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\subsubsection*{template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$class Q\-U\-E\-S\-O\-::\-M\-L\-Sampling$<$ P\-\_\-\-V, P\-\_\-\-M $>$}

A templated class that represents a Multilevel generator of samples. 

A templated class that represents a Multilevel sampler. Options reading is handled by class '\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_options}{M\-L\-Sampling\-Options}'. It implements the method\-: S. H. Cheung and E. E. Prudencio. Parallel adaptive multilevel sampling algorithms for the Bayesian analysis of mathematical models. International Journal for Uncertainty Quantification, 2(3)\-:215237, 2012. 

Definition at line 118 of file M\-L\-Sampling.\-h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a7738e481975c7ca2a47fa763bb92bdbe}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!M\-L\-Sampling@{M\-L\-Sampling}}
\index{M\-L\-Sampling@{M\-L\-Sampling}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{M\-L\-Sampling}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::{\bf M\-L\-Sampling} (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{prefix, }
\item[{const {\bf Base\-Vector\-R\-V}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{prior\-Rv, }
\item[{const {\bf Base\-Scalar\-Function}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{likelihood\-Function}
\end{DoxyParamCaption}
)}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a7738e481975c7ca2a47fa763bb92bdbe}


Constructor. 

Constructor\-: instantiates an object of the class given a prefix, the prior R\-V and the likelihood function. Internally, this method set the domain of the target P\-D\-F to be the intersection of the domains of the prior P\-D\-F and of the likelihood function. Also the current level and exponent of the Multilevel method are set to zero. 
\begin{DoxyParams}{Parameters}
{\em prefix} & Prefix \\
\hline
{\em prior\-Rv} & The prior rv \\
\hline
{\em likelihood\-Function} & The likelihood function \\
\hline
\end{DoxyParams}


Definition at line 4033 of file M\-L\-Sampling.\-C.



References Q\-U\-E\-S\-O\-::\-M\-L\-Sampling$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-env, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-options, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Options\-::scan\-Options\-Values(), and Q\-U\-E\-S\-O\-::\-Base\-Environment\-::sub\-Display\-File().


\begin{DoxyCode}
4037   :
4038   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}               (priorRv.\hyperlink{class_q_u_e_s_o_1_1_base_vector_r_v_ad5bf8486b3bacb46b9d4ecba513fd37b}{env}()),
4039   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aa45e9c06bd51cae0dc2294af1831c158}{m\_priorRv}           (priorRv),
4040   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ab08c3059d23460db49b229aa88bd4e70}{m\_likelihoodFunction}(likelihoodFunction),
4041   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}       (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aa45e9c06bd51cae0dc2294af1831c158}{m\_priorRv}.\hyperlink{class_q_u_e_s_o_1_1_base_vector_r_v_aa4dd2f036228eac1f945bacc7147a922}{imageSet}().
      \hyperlink{class_q_u_e_s_o_1_1_vector_set_a923421590baf5bf93cf066e528f927dc}{vectorSpace}()),
4042   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a21525858e93a7d9654fdf68c8ac25576}{m\_targetDomain}      (\hyperlink{namespace_q_u_e_s_o_aa79046437ab085c5487ae16e9a0baeec}{InstantiateIntersection}(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aa45e9c06bd51cae0dc2294af1831c158}{m\_priorRv}.\hyperlink{class_q_u_e_s_o_1_1_base_vector_r_v_a3206740e05e0c64a88273029e963b185}{pdf}().\hyperlink{class_q_u_e_s_o_1_1_base_scalar_function_ad0937628825249dd36ded3ce0c7959ac}{domainSet}(),\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ab08c3059d23460db49b229aa88bd4e70}{m\_likelihoodFunction}.
      \hyperlink{class_q_u_e_s_o_1_1_base_scalar_function_ad0937628825249dd36ded3ce0c7959ac}{domainSet}())),
4043   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_afbe27e6149562020663b72da6592d933}{m\_numDisabledParameters} (0), \textcolor{comment}{// gpmsa2}
4044   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ac76690384f70d74b8662faf7a051449e}{m\_parameterEnabledStatus}(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.
      \hyperlink{class_q_u_e_s_o_1_1_vector_space_a5829a1f4f996f8307c840b705144d666}{dimLocal}(),\textcolor{keyword}{true}), \textcolor{comment}{// gpmsa2}
4045   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}           (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env},prefix),
4046   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}         (0),
4047   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}          (0),
4048   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_abdd5cd35419283c33cc40a77d0f4f07f}{m\_debugExponent}     (0.),
4049   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}(0),
4050   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_afad63c42dccb1518319bf677f2bffde0}{m\_logEvidence}       (0.),
4051   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aec4229773274b58e3eaa49a77738389f}{m\_meanLogLikelihood} (0.),
4052   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_abec7f8cf9da08bc5c0a20d99fa4570af}{m\_eig}               (0.)
4053 \{
4054   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) \{
4055     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Entering MLSampling<P\_V,P\_M>::constructor()"}
4056                             << std::endl;
4057   \}
4058 
4059   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_options_ac30d28bbd4eea520fbbcfa5641dc62e1}{scanOptionsValues}();
4060 
4061   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) \{
4062     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving MLSampling<P\_V,P\_M>::constructor()"}
4063                             << std::endl;
4064   \}
4065 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_ad3f442d1cac363497d04a4c8f8cf76c3}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!$\sim$\-M\-L\-Sampling@{$\sim$\-M\-L\-Sampling}}
\index{$\sim$\-M\-L\-Sampling@{$\sim$\-M\-L\-Sampling}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{$\sim$\-M\-L\-Sampling}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::$\sim${\bf M\-L\-Sampling} (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_q_u_e_s_o_1_1_m_l_sampling_ad3f442d1cac363497d04a4c8f8cf76c3}


Destructor. 



Definition at line 4068 of file M\-L\-Sampling.\-C.


\begin{DoxyCode}
4069 \{
4070   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_afbe27e6149562020663b72da6592d933}{m\_numDisabledParameters} = 0; \textcolor{comment}{// gpmsa2}
4071   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ac76690384f70d74b8662faf7a051449e}{m\_parameterEnabledStatus}.clear(); \textcolor{comment}{// gpmsa2}
4072   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a21525858e93a7d9654fdf68c8ac25576}{m\_targetDomain}) \textcolor{keyword}{delete} \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a21525858e93a7d9654fdf68c8ac25576}{m\_targetDomain};
4073 \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_aa8e7bb1bd54ccafb9b276127a76eba71}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!checkpoint\-M\-L@{checkpoint\-M\-L}}
\index{checkpoint\-M\-L@{checkpoint\-M\-L}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{checkpoint\-M\-L}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::checkpoint\-M\-L (
\begin{DoxyParamCaption}
\item[{double}]{curr\-Exponent, }
\item[{double}]{curr\-Eta, }
\item[{const {\bf Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{curr\-Chain, }
\item[{const {\bf Scalar\-Sequence}$<$ double $>$ \&}]{curr\-Log\-Likelihood\-Values, }
\item[{const {\bf Scalar\-Sequence}$<$ double $>$ \&}]{curr\-Log\-Target\-Values}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_aa8e7bb1bd54ccafb9b276127a76eba71}


Writes checkpoint data for the M\-L method. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em curr\-Exponent,curr\-Eta,curr\-Chain,curr\-Log\-Likelihood\-Values,curr\-Log\-Target\-Values.} & \\
\hline
\end{DoxyParams}


Definition at line 2033 of file M\-L\-Sampling.\-C.



References L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-Base\-Vector\-Sequence$<$ V, M $>$\-::unified\-Sequence\-Size(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::unified\-Sequence\-Size(), Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::unified\-Write\-Contents(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::unified\-Write\-Contents(), and U\-Q\-\_\-\-F\-A\-T\-A\-L\-\_\-\-T\-E\-S\-T\-\_\-\-M\-A\-C\-R\-O.


\begin{DoxyCode}
2039 \{
2040   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 2)) \{
2041     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"\(\backslash\)n CHECKPOINTING initiating at level "} << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}
2042                             << \textcolor{stringliteral}{"\(\backslash\)n"} << std::endl;
2043   \}
2044 
2045   \textcolor{comment}{//******************************************************************************}
2046   \textcolor{comment}{// Write 'control' file without 'level' spefication in name}
2047   \textcolor{comment}{//******************************************************************************}
2048   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} quantity1 = currChain.unifiedSequenceSize();
2049   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} quantity2 = currLogLikelihoodValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a52829afc95e5c36e9db44f40854153b0}{unifiedSequenceSize}(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1);
2050   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} quantity3 = currLogTargetValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a52829afc95e5c36e9db44f40854153b0}{unifiedSequenceSize}(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1);
2051   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
2052     \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.size() != 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel},
2053                         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a84a239e42ae443cf71db6e03e8159620}{fullRank}(),
2054                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::checkpointML()"},
2055                         \textcolor{stringliteral}{"number of evidence factors is not consistent"});
2056     \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(quantity1 != quantity2,
2057                         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a84a239e42ae443cf71db6e03e8159620}{fullRank}(),
2058                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::checkpointML()"},
2059                         \textcolor{stringliteral}{"quantity2 is not consistent"});
2060     \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(quantity1 != quantity3,
2061                         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a84a239e42ae443cf71db6e03e8159620}{fullRank}(),
2062                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::checkpointML()"},
2063                         \textcolor{stringliteral}{"quantity3 is not consistent"});
2064   \}
2065 
2066   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a84a239e42ae443cf71db6e03e8159620}{fullRank}() == 0) \{
2067     std::ofstream* ofsVar = \textcolor{keyword}{new} std::ofstream((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.m\_restartOutput\_baseNameForFiles + \textcolor{stringliteral}{"
      Control.txt"}).c\_str(),
2068                                               std::ofstream::out | std::ofstream::trunc);
2069     *ofsVar << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}               << std::endl  \textcolor{comment}{// 1}
2070             << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_acd4359dc120905c22ca1064e33787239}{dimGlobal}() << std::endl  \textcolor{comment}{// 2}
2071             << currExponent              << std::endl  \textcolor{comment}{// 3}
2072             << currEta                   << std::endl  \textcolor{comment}{// 4}
2073             << quantity1                 << std::endl; \textcolor{comment}{// 5}
2074     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} savedPrecision = ofsVar->precision();
2075     ofsVar->precision(16);
2076     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.size(); ++i) \{
2077       *ofsVar << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}[i] << std::endl;
2078     \}
2079     ofsVar->precision(savedPrecision);
2080     *ofsVar << \textcolor{stringliteral}{"COMPLETE"}                << std::endl; \textcolor{comment}{// 6 = ML\_CHECKPOINT\_FIXED\_AMOUNT\_OF\_DATA}
2081 
2082     \textcolor{keyword}{delete} ofsVar;
2083   \}
2084   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
2085 
2086   \textcolor{comment}{//******************************************************************************}
2087   \textcolor{comment}{// Write three 'data' files}
2088   \textcolor{comment}{//******************************************************************************}
2089   \textcolor{keywordtype}{char} levelSufix[256];
2090   sprintf(levelSufix,\textcolor{stringliteral}{"%d"},\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}); \textcolor{comment}{// Yes, '+0'}
2091 
2092   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 2)) \{
2093     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"\(\backslash\)n CHECKPOINTING chain at level "} << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}
2094                             << \textcolor{stringliteral}{"\(\backslash\)n"} << std::endl;
2095   \}
2096   currChain.unifiedWriteContents(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.m\_restartOutput\_baseNameForFiles + \textcolor{stringliteral}{"Chain\_l"} + 
      levelSufix,
2097                                  \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.m\_restartOutput\_fileType);
2098   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
2099 
2100   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 2)) \{
2101     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"\(\backslash\)n CHECKPOINTING like at level "} << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}
2102                             << \textcolor{stringliteral}{"\(\backslash\)n"} << std::endl;
2103   \}
2104   currLogLikelihoodValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a2f832dd5eda37df06eb52650ab8ce733}{unifiedWriteContents}(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.
      m\_restartOutput\_baseNameForFiles + \textcolor{stringliteral}{"LogLike\_l"} + levelSufix,
2105                                                \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.m\_restartOutput\_fileType);
2106   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
2107 
2108   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 2)) \{
2109     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"\(\backslash\)n CHECKPOINTING target at level "} << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}
2110                             << \textcolor{stringliteral}{"\(\backslash\)n"} << std::endl;
2111   \}
2112   currLogTargetValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a2f832dd5eda37df06eb52650ab8ce733}{unifiedWriteContents}(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.
      m\_restartOutput\_baseNameForFiles + \textcolor{stringliteral}{"LogTarget\_l"} + levelSufix,
2113                                            \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.m\_restartOutput\_fileType);
2114   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
2115 
2116   \textcolor{comment}{//******************************************************************************}
2117   \textcolor{comment}{// Write 'control' file *with* 'level' spefication in name}
2118   \textcolor{comment}{//******************************************************************************}
2119   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a84a239e42ae443cf71db6e03e8159620}{fullRank}() == 0) \{
2120     std::ofstream* ofsVar = \textcolor{keyword}{new} std::ofstream((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.m\_restartOutput\_baseNameForFiles + \textcolor{stringliteral}{"
      Control\_l"} + levelSufix + \textcolor{stringliteral}{".txt"}).c\_str(),
2121                                               std::ofstream::out | std::ofstream::trunc);
2122     *ofsVar << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}               << std::endl  \textcolor{comment}{// 1}
2123             << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_acd4359dc120905c22ca1064e33787239}{dimGlobal}() << std::endl  \textcolor{comment}{// 2}
2124             << currExponent              << std::endl  \textcolor{comment}{// 3}
2125             << currEta                   << std::endl  \textcolor{comment}{// 4}
2126             << quantity1                 << std::endl; \textcolor{comment}{// 5}
2127     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} savedPrecision = ofsVar->precision();
2128     ofsVar->precision(16);
2129     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.size(); ++i) \{
2130       *ofsVar << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}[i] << std::endl;
2131     \}
2132     ofsVar->precision(savedPrecision);
2133     *ofsVar << \textcolor{stringliteral}{"COMPLETE"}                << std::endl; \textcolor{comment}{// 6 = ML\_CHECKPOINT\_FIXED\_AMOUNT\_OF\_DATA}
2134 
2135     \textcolor{keyword}{delete} ofsVar;
2136   \}
2137   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
2138 
2139   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 2)) \{
2140     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"\(\backslash\)n CHECKPOINTING done at level "} << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}
2141                             << \textcolor{stringliteral}{"\(\backslash\)n"} << std::endl;
2142   \}
2143 
2144   \textcolor{keywordflow}{return};
2145 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a0f6f7872635b9546b3215fee347601f6}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!decide\-On\-Balanced\-Chains\-\_\-all@{decide\-On\-Balanced\-Chains\-\_\-all}}
\index{decide\-On\-Balanced\-Chains\-\_\-all@{decide\-On\-Balanced\-Chains\-\_\-all}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{decide\-On\-Balanced\-Chains\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ bool {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::decide\-On\-Balanced\-Chains\-\_\-all (
\begin{DoxyParamCaption}
\item[{const {\bf M\-L\-Sampling\-Level\-Options} $\ast$}]{curr\-Options, }
\item[{unsigned int}]{index\-Of\-First\-Weight, }
\item[{unsigned int}]{index\-Of\-Last\-Weight, }
\item[{const std\-::vector$<$ unsigned int $>$ \&}]{unified\-Index\-Counters\-At\-Proc0\-Only, }
\item[{std\-::vector$<$ {\bf Exchange\-Info\-Struct} $>$ \&}]{exchange\-Std\-Vec}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a0f6f7872635b9546b3215fee347601f6}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em curr\-Options,index\-Of\-First\-Weight,index\-Of\-Last\-Weight,unified\-Index\-Counters\-At\-Proc0\-Only} & \\
\hline
\mbox{\tt out}  & {\em exchange\-Std\-Vec} & \\
\hline
\end{DoxyParams}


Definition at line 147 of file M\-L\-Sampling.\-C.



References Q\-U\-E\-S\-O\-::\-Exchange\-Info\-Struct\-::final\-Node\-Of\-Initial\-Position, L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-load\-Balance\-Algorithm\-Id, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-load\-Balance\-Treshold, Q\-U\-E\-S\-O\-::\-Exchange\-Info\-Struct\-::number\-Of\-Positions, Q\-U\-E\-S\-O\-::\-Exchange\-Info\-Struct\-::original\-Index\-Of\-Initial\-Position, Q\-U\-E\-S\-O\-::\-Exchange\-Info\-Struct\-::original\-Node\-Of\-Initial\-Position, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-U\-N\-S\-I\-G\-N\-E\-D, and U\-Q\-\_\-\-F\-A\-T\-A\-L\-\_\-\-T\-E\-S\-T\-\_\-\-M\-A\-C\-R\-O.


\begin{DoxyCode}
153 \{
154   \textcolor{keywordtype}{bool} result = \textcolor{keyword}{false};
155 
156   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
157     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Entering
       MLSampling<P\_V,P\_M>::decideOnBalancedChains\_all()"}
158                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
159                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
160                             << \textcolor{stringliteral}{": indexOfFirstWeight = "} << indexOfFirstWeight
161                             << \textcolor{stringliteral}{", indexOfLastWeight = "}  << indexOfLastWeight
162                             << std::endl;
163   \}
164 
165   \textcolor{keywordflow}{if} (\textcolor{keyword}{true}) \{
166     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} Np = 0;
167     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{ \textcolor{comment}{// Yes, '>= 0'}
168       Np = (\textcolor{keywordtype}{unsigned} int) \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_aa780721ae0fdeabc5a15e04cb0cad964}{NumProc}();
169     \}
170     std::vector<unsigned int> allFirstIndexes(Np,0); \textcolor{comment}{// '0' is already the correct value for recvcnts[0]}
171     std::vector<unsigned int> allLastIndexes(Np,0);  \textcolor{comment}{// '0' is NOT the correct value for recvcnts[0]}
172 
173     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{ \textcolor{comment}{// Yes, '>= 0'}
175 \textcolor{comment}{}      \textcolor{comment}{// Gather information at proc 0: number of chains and positions per node}
177 \textcolor{comment}{}      \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} auxUInt = indexOfFirstWeight;
178       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a184a5e411afcfb6dc41e99fca9435045}{Gather}((\textcolor{keywordtype}{void} *) &auxUInt, 1, 
      \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, (\textcolor{keywordtype}{void} *) &allFirstIndexes[0], (\textcolor{keywordtype}{int}) 1, 
      \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 0, \textcolor{comment}{// LOAD BALANCE}
179                                 \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::decideOnBalancedChains\_all()"},
180                                 \textcolor{stringliteral}{"failed MPI.Gather() for first indexes"});
181 
182       \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() == 0) \{
183         \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(allFirstIndexes[0] != indexOfFirstWeight,
184                             \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
185                             \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::decideOnBalancedChains\_all()"},
186                             \textcolor{stringliteral}{"failed MPI.Gather() result for first indexes, at proc 0"});
187       \}
188 
189       auxUInt = indexOfLastWeight;
190       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a184a5e411afcfb6dc41e99fca9435045}{Gather}((\textcolor{keywordtype}{void} *) &auxUInt, 1, 
      \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, (\textcolor{keywordtype}{void} *) &allLastIndexes[0], (\textcolor{keywordtype}{int}) 1, 
      \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 0, \textcolor{comment}{// LOAD BALANCE}
191                                 \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::decideOnBalancedChains\_all()"},
192                                 \textcolor{stringliteral}{"failed MPI.Gather() for last indexes"});
193 
194       \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() == 0) \{ \textcolor{comment}{// Yes, '== 0'}
195         \textcolor{comment}{//allLastIndexes[0] = indexOfLastWeight; // FIX ME: really necessary????}
196         \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(allLastIndexes[0] != indexOfLastWeight,
197                             \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
198                             \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::decideOnBalancedChains\_all()"},
199                             \textcolor{stringliteral}{"failed MPI.Gather() result for last indexes, at proc 0"});
200       \}
201     \}
202 
204     \textcolor{comment}{// Proc 0 prepares information to decide if load balancing is needed}
206 \textcolor{comment}{}    \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() == 0) \{
207       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
208         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::decideOnBalancedChains\_all()
      "}
209                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
210                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
211                                 << \textcolor{stringliteral}{": original distribution of unified indexes in 'inter0Comm' is as
       follows"}
212                                 << std::endl;
213         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} r = 0; r < Np; ++r) \{
214           *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"  allFirstIndexes["} << r << \textcolor{stringliteral}{"] = "} << 
      allFirstIndexes[r]
215                                   << \textcolor{stringliteral}{"  allLastIndexes["}  << r << \textcolor{stringliteral}{"] = "} << allLastIndexes[r]
216                                   << std::endl;
217         \}
218       \}
219       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} r = 0; r < (Np-1); ++r) \{ \textcolor{comment}{// Yes, '-1'}
220         \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(allFirstIndexes[r+1] != (allLastIndexes[r]+1),
221                             \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
222                             \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::decideOnBalancedChains\_all()"},
223                             \textcolor{stringliteral}{"wrong indexes"});
224       \}
225 
226       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} r = 0; r < (Np-1); ++r) \{ \textcolor{comment}{// Yes, '-1'}
227         \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(allFirstIndexes[r+1] != (allLastIndexes[r]+1),
228                             \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
229                             \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::decideOnBalancedChains\_all()"},
230                             \textcolor{stringliteral}{"wrong indexes"});
231       \}
232 
233       std::vector<unsigned int> origNumChainsPerNode   (Np,0);
234       std::vector<unsigned int> origNumPositionsPerNode(Np,0);
235       \textcolor{keywordtype}{int} r = 0;
236       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < unifiedIndexCountersAtProc0Only.size(); ++i) \{
237         \textcolor{keywordflow}{if} ((allFirstIndexes[r] <= i) && \textcolor{comment}{// FIX ME: not a robust logic}
238             (i <= allLastIndexes[r] )) \{
239           \textcolor{comment}{// Ok}
240         \}
241         \textcolor{keywordflow}{else} \{
242           r++;
243           \textcolor{keywordflow}{if} ((r < (\textcolor{keywordtype}{int}) Np           ) &&
244               (allFirstIndexes[r] <= i) &&
245               (i <= allLastIndexes[r] )) \{
246             \textcolor{comment}{// Ok}
247           \}
248           \textcolor{keywordflow}{else} \{
249       std::cerr << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::decideOnBalancedChains\_all()"}
250                       << \textcolor{stringliteral}{": i = "} << i
251                       << \textcolor{stringliteral}{", r = "} << r
252                       << \textcolor{stringliteral}{", allFirstIndexes[r] = "} << allFirstIndexes[r]
253                       << \textcolor{stringliteral}{", allLastIndexes[r] = "}  << allLastIndexes[r]
254                       << std::endl;
255             \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(\textcolor{keyword}{true},
256                                 \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
257                                 \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::decideOnBalancedChains\_all()"},
258                                 \textcolor{stringliteral}{"wrong indexes or 'r' got too large"});
259           \}
260         \}
261         \textcolor{keywordflow}{if} (unifiedIndexCountersAtProc0Only[i] != 0) \{
262           origNumChainsPerNode   [r] += 1;
263           origNumPositionsPerNode[r] += unifiedIndexCountersAtProc0Only[i];
264 
265           ExchangeInfoStruct auxInfo;
266           auxInfo.originalNodeOfInitialPosition  = r;
267           auxInfo.originalIndexOfInitialPosition = i - allFirstIndexes[r];
268           auxInfo.finalNodeOfInitialPosition     = -1; \textcolor{comment}{// Yes, '-1' for now, important}
269           auxInfo.numberOfPositions              = unifiedIndexCountersAtProc0Only[i];
270           exchangeStdVec.push\_back(auxInfo);
271         \}
272         \textcolor{comment}{// FIX ME: swap trick to save memory}
273       \}
274 
275       \textcolor{comment}{// Check if number of procs is too large}
276       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} totalNumberOfChains = 0;
277       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} r = 0; r < Np; ++r) \{
278         totalNumberOfChains += origNumChainsPerNode[r];
279       \}
280       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
281         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"  KEY"}
282                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
283                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
284                                 << \textcolor{stringliteral}{", Np = "}  << Np
285                                 << \textcolor{stringliteral}{", totalNumberOfChains = "} << totalNumberOfChains
286                                 << std::endl;
287       \}
288 
289       \textcolor{comment}{// Check if ratio max/min justifies optimization}
290       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} origMinPosPerNode  = *std::min\_element(origNumPositionsPerNode.begin(), 
      origNumPositionsPerNode.end());
291       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} origMaxPosPerNode  = *std::max\_element(origNumPositionsPerNode.begin(), 
      origNumPositionsPerNode.end());
292       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
293         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = 0; nodeId < Np; ++nodeId) \{
294           *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"  KEY"}
295                                   << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
296                                   << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
297                                   << \textcolor{stringliteral}{", origNumChainsPerNode["}     << nodeId << \textcolor{stringliteral}{"] = "} << 
      origNumChainsPerNode[nodeId]
298                                   << \textcolor{stringliteral}{", origNumPositionsPerNode["}  << nodeId << \textcolor{stringliteral}{"] = "} << 
      origNumPositionsPerNode[nodeId]
299                                   << std::endl;
300         \}
301       \}
302       \textcolor{keywordtype}{double} origRatioOfPosPerNode = ((double) origMaxPosPerNode ) / ((double) origMinPosPerNode);
303       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
304         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"  KEY"}
305                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
306                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
307                                 << \textcolor{stringliteral}{", origRatioOfPosPerNode = "}      << origRatioOfPosPerNode
308                                 << \textcolor{stringliteral}{", option loadBalanceTreshold = "} << currOptions->m\_loadBalanceTreshold
309                                 << std::endl;
310       \}
311 
312       \textcolor{comment}{// At this point, only proc 0 is running...}
313       \textcolor{comment}{// Set boolean 'result' for good}
314       \textcolor{keywordflow}{if} ((currOptions->m\_loadBalanceAlgorithmId > 0                                 ) &&
315           (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ac0345f57e31ef7833e379ed972bd094d}{numSubEnvironments}()            > 1                                
       ) && \textcolor{comment}{// Cannot use 'm\_env.inter0Comm().NumProc()': not all nodes at this point of the code belong to
       'inter0Comm'}
316           (Np                                    < totalNumberOfChains               ) &&
317           (origRatioOfPosPerNode                 > currOptions->m\_loadBalanceTreshold)) \{
318         result = \textcolor{keyword}{true};
319       \}
320     \} \textcolor{comment}{// if (m\_env.inter0Rank() == 0)}
321   \} \textcolor{comment}{// if (true)}
322 
323   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
324   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} tmpValue = result;
325   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &tmpValue, (\textcolor{keywordtype}{int}) 1, 
      \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 0, \textcolor{comment}{// LOAD BALANCE}
326                          \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::decideOnBalancedChains\_all()"},
327                          \textcolor{stringliteral}{"failed MPI.Bcast() for 'result'"});
328   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() != 0) result = tmpValue;
329 
330   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
331     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving
       MLSampling<P\_V,P\_M>::decideOnBalancedChains\_all()"}
332                             << \textcolor{stringliteral}{", level "}    << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
333                             << \textcolor{stringliteral}{", step "}     << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
334                             << \textcolor{stringliteral}{": result = "} << result
335                             << std::endl;
336   \}
337 
338   \textcolor{keywordflow}{return} result;
339 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a31f7f977a3d42a06fdcd2918cc31bb40}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!eig@{eig}}
\index{eig@{eig}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{eig}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ double {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::eig (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a31f7f977a3d42a06fdcd2918cc31bb40}


Calculates the expected information gain value, E\-I\-G. 

The expected information gain is defined as the expected log ratio between the posterior and prior distribution for the parameters in the statistical model. Recalling the Bayes formula\-: \[ \pi (\theta|D, M_j) = \frac{f(D|\theta, M_j) \cdot \pi (\theta | M_j)}{\pi(D, M_j)} \] where $ \pi (\theta|D, M_j) $ is the posterior P\-D\-F, $ \pi (\theta | M_j) $ is the prior, $ f(D|\theta, M_j)$ is the likelihood function and $ \pi(D, M_j) $ is the evidence for a given set of parameters $ \theta $, data $ D $ and model class $ M_j $. Then the E\-I\-G can be calculated as\-: \[ EIG = log \left(\frac{ \pi (\theta|D, M_j)}{\pi (\theta | M_j) } \right) = log \left(\frac{f(D|\theta, M_j) }{\pi(D, M_j)} \right) = log \left(\frac{f(D|\theta, M_j) }{\pi(D, M_j)} \right) = log \left(f(D|\theta, M_j)\right) - log\left(f(D|\theta, M_j) \right) \]

\begin{DoxySeeAlso}{See Also}
Long, Quan and Scavino, Marco and Tempone, Raul and Wang, Suojin, Fast estimation of expected information gains for Bayesian experimental designs based on Laplace approximations. Computer Methods In Applied Mechanics And Engineering, 259\-:24-\/39,2013. D\-O\-I = 10.\-1016/j.cma.\-2013.\-02.\-017. 
\end{DoxySeeAlso}


Definition at line 4884 of file M\-L\-Sampling.\-C.


\begin{DoxyCode}
4885 \{
4886   \textcolor{keywordflow}{return} \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_abec7f8cf9da08bc5c0a20d99fa4570af}{m\_eig};
4887 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a8e9d7681d17623c726814d206c8be4b2}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!generate\-Bal\-Linked\-Chains\-\_\-all@{generate\-Bal\-Linked\-Chains\-\_\-all}}
\index{generate\-Bal\-Linked\-Chains\-\_\-all@{generate\-Bal\-Linked\-Chains\-\_\-all}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{generate\-Bal\-Linked\-Chains\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Bal\-Linked\-Chains\-\_\-all (
\begin{DoxyParamCaption}
\item[{{\bf M\-L\-Sampling\-Level\-Options} \&}]{input\-Options, }
\item[{const P\-\_\-\-M \&}]{unified\-Cov\-Matrix, }
\item[{const {\bf Generic\-Vector\-R\-V}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{rv, }
\item[{const {\bf Balanced\-Linked\-Chains\-Per\-Node\-Struct}$<$ P\-\_\-\-V $>$ \&}]{balanced\-Link\-Control, }
\item[{{\bf Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{working\-Chain, }
\item[{double \&}]{cumulative\-Run\-Time, }
\item[{unsigned int \&}]{cumulative\-Rejections, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ $\ast$}]{curr\-Log\-Likelihood\-Values, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ $\ast$}]{curr\-Log\-Target\-Values}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a8e9d7681d17623c726814d206c8be4b2}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em input\-Options,unified\-Cov\-Matrix,rv,balanced\-Link\-Control,@param\mbox{[}out\mbox{]}} & working\-Chain, cumulative\-Run\-Time, cumulative\-Rejections, curr\-Log\-Likelihood\-Values, curr\-Log\-Target\-Values \\
\hline
\end{DoxyParams}


Definition at line 656 of file M\-L\-Sampling.\-C.



References Q\-U\-E\-S\-O\-::\-Base\-Vector\-Sequence$<$ V, M $>$\-::append(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::append(), Q\-U\-E\-S\-O\-::\-Balanced\-Linked\-Chains\-Per\-Node\-Struct$<$ P\-\_\-\-V $>$\-::bal\-Linked\-Chains, Q\-U\-E\-S\-O\-::\-Metropolis\-Hastings\-S\-G$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Sequence(), Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::get\-Position\-Values(), Q\-U\-E\-S\-O\-::\-Metropolis\-Hastings\-S\-G$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::get\-Raw\-Chain\-Info(), L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-raw\-Chain\-Size, Q\-U\-E\-S\-O\-::\-Misc\-Get\-Ellapsed\-Seconds(), Q\-U\-E\-S\-O\-::\-M\-H\-Raw\-Chain\-Info\-Struct\-::num\-Rejections, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-M\-A\-X, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-M\-I\-N, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-S\-U\-M, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-U\-N\-S\-I\-G\-N\-E\-D, Q\-U\-E\-S\-O\-::\-M\-H\-Raw\-Chain\-Info\-Struct\-::run\-Time, Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::sub\-Sequence\-Size(), and Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::sub\-Sequence\-Size().


\begin{DoxyCode}
666 \{
667   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
668 
669   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
670     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Entering
       MLSampling<P\_V,P\_M>::generateBalLinkedChains\_all()"}
671                             << \textcolor{stringliteral}{": balancedLinkControl.balLinkedChains.size() = "} << balancedLinkControl.
      balLinkedChains.size()
672                             << std::endl;
673   \}
674 
675   P\_V auxInitialPosition(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a92e963bb5cab3eecd290dfe4b8f03b04}{zeroVector}());
676 
677   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} chainIdMax = 0;
678   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
679     chainIdMax = balancedLinkControl.balLinkedChains.size();
680   \}
681   \textcolor{comment}{// KAUST: all nodes in 'subComm' should have the same 'chainIdMax'}
682   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &chainIdMax, (\textcolor{keywordtype}{int}) 1, 
      \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 0, \textcolor{comment}{// Yes, 'subComm', important // LOAD BALANCE}
683                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateBalLinkedChains\_all()"},
684                         \textcolor{stringliteral}{"failed MPI.Bcast() for chainIdMax"});
685 
686   \textcolor{keyword}{struct }timeval timevalEntering;
687   \textcolor{keywordtype}{int} iRC = 0;
688   iRC = gettimeofday(&timevalEntering, NULL);
689   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
690 
691   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
692     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} numberOfPositions = 0;
693     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} chainId = 0; chainId < chainIdMax; ++chainId) \{
694       numberOfPositions += balancedLinkControl.balLinkedChains[chainId].numberOfPositions;
695     \}
696 
697     std::vector<unsigned int> auxBuf(1,0);
698 
699     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} minNumberOfPositions = 0;
700     auxBuf[0] = numberOfPositions;
701     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &auxBuf[0], (\textcolor{keywordtype}{void} *) &
      minNumberOfPositions, (\textcolor{keywordtype}{int}) auxBuf.size(), \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 
      \hyperlink{_mpi_comm_8h_a8e30f42fdac116861205e83e2aa18042}{RawValue\_MPI\_MIN}, \textcolor{comment}{// LOAD BALANCE}
702                                  \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateBalLinkedChains\_all()"},
703                                  \textcolor{stringliteral}{"failed MPI.Allreduce() for min"});
704 
705     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} maxNumberOfPositions = 0;
706     auxBuf[0] = numberOfPositions;
707     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &auxBuf[0], (\textcolor{keywordtype}{void} *) &
      maxNumberOfPositions, (\textcolor{keywordtype}{int}) auxBuf.size(), \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 
      \hyperlink{_mpi_comm_8h_a68f3ac7ff71a6504e236b0c95de78178}{RawValue\_MPI\_MAX}, \textcolor{comment}{// LOAD BALANCE}
708                                  \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateBalLinkedChains\_all()"},
709                                  \textcolor{stringliteral}{"failed MPI.Allreduce() for max"});
710 
711     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} sumNumberOfPositions = 0;
712     auxBuf[0] = numberOfPositions;
713     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &auxBuf[0], (\textcolor{keywordtype}{void} *) &
      sumNumberOfPositions, (\textcolor{keywordtype}{int}) auxBuf.size(), \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 
      \hyperlink{_mpi_comm_8h_afbf78d291c032aa7f512bc566cee2bd1}{RawValue\_MPI\_SUM}, \textcolor{comment}{// LOAD BALANCE}
714                                  \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateBalLinkedChains\_all()"},
715                                  \textcolor{stringliteral}{"failed MPI.Allreduce() for sum"});
716 
717     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
718       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"KEY In
       MLSampling<P\_V,P\_M>::generateBalLinkedChains\_all()"}
719                               << \textcolor{stringliteral}{", level "}               << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
720                               << \textcolor{stringliteral}{", step "}                << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
721                               << \textcolor{stringliteral}{": chainIdMax = "}        << chainIdMax
722                               << \textcolor{stringliteral}{", numberOfPositions = "} << numberOfPositions
723                               << \textcolor{stringliteral}{", at "}                  << ctime(&timevalEntering.tv\_sec)
724                               << std::endl;
725       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"KEY In
       MLSampling<P\_V,P\_M>::generateBalLinkedChains\_all()"}
726                               << \textcolor{stringliteral}{", level "}                  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
727                               << \textcolor{stringliteral}{", step "}                   << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
728                               << \textcolor{stringliteral}{": minNumberOfPositions = "} << minNumberOfPositions
729                               << \textcolor{stringliteral}{", avgNumberOfPositions = "} << ((double) sumNumberOfPositions)/((double) 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_aa780721ae0fdeabc5a15e04cb0cad964}{NumProc}())
730                               << \textcolor{stringliteral}{", maxNumberOfPositions = "} << maxNumberOfPositions
731                               << std::endl;
732     \}
733 
734     \textcolor{comment}{// 2013-02-23: print sizes, and expected final size}
735   \}
736   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_abdd5cd35419283c33cc40a77d0f4f07f}{m\_debugExponent} == 1.) &&
737       (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}      == 10)) \{
738     \textcolor{comment}{//m\_env.setExceptionalCircumstance(true);}
739   \}
740   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} cumulativeNumPositions = 0;
741   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} chainId = 0; chainId < chainIdMax; ++chainId) \{
742     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} tmpChainSize = 0;
743     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
744       \textcolor{comment}{// aqui 4}
745       auxInitialPosition = *(balancedLinkControl.balLinkedChains[chainId].initialPosition); \textcolor{comment}{// Round Rock}
746       tmpChainSize = balancedLinkControl.balLinkedChains[chainId].numberOfPositions+1; \textcolor{comment}{// IMPORTANT: '+1'
       in order to discard initial position afterwards}
747       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()       ) &&
748           (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 3)) \{
749         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In
       MLSampling<P\_V,P\_M>::generateBalLinkedChains\_all()"}
750                                 << \textcolor{stringliteral}{", level "}            << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
751                                 << \textcolor{stringliteral}{", step "}             << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
752                                 << \textcolor{stringliteral}{", chainId = "}        << chainId
753                                 << \textcolor{stringliteral}{" < "}                 << chainIdMax
754                                 << \textcolor{stringliteral}{": begin generating "} << tmpChainSize
755                                 << \textcolor{stringliteral}{" chain positions"}
756                                 << std::endl;
757       \}
758     \}
759     auxInitialPosition.mpiBcast(0, \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}()); \textcolor{comment}{// Yes, 'subComm', important // KAUST}
760 \textcolor{preprocessor}{#if 0 // For debug only}
761 \textcolor{preprocessor}{}    \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} r = 0; r < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_aa780721ae0fdeabc5a15e04cb0cad964}{NumProc}(); ++r) \{
762       \textcolor{keywordflow}{if} (r == \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_ab806f80f206210723fcb4df8185a55a8}{MyPID}()) \{
763   std::cout << \textcolor{stringliteral}{"Vector 'auxInitialPosition at rank "} << r
764                   << \textcolor{stringliteral}{" has contents "}                      << auxInitialPosition
765                   << std::endl;
766       \}
767       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
768     \}
769     sleep(1);
770 \textcolor{preprocessor}{#endif}
771 \textcolor{preprocessor}{}
772     \textcolor{comment}{// KAUST: all nodes in 'subComm' should have the same 'tmpChainSize'}
773     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &tmpChainSize, (\textcolor{keywordtype}{int}) 1, 
      \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 0, \textcolor{comment}{// Yes, 'subComm', important // LOAD BALANCE}
774                           \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateBalLinkedChains\_all()"},
775                           \textcolor{stringliteral}{"failed MPI.Bcast() for tmpChainSize"});
776 
777     inputOptions.m\_rawChainSize = tmpChainSize;
778     SequenceOfVectors<P\_V,P\_M> tmpChain(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace},
779                                                0,
780                                                \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_options_a1d3d48598e0b59b46337ce66a52671a5}{m\_prefix}+\textcolor{stringliteral}{"tmp\_chain"});
781     ScalarSequence<double> tmpLogLikelihoodValues(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env},0,\textcolor{stringliteral}{""});
782     ScalarSequence<double> tmpLogTargetValues    (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env},0,\textcolor{stringliteral}{""});
783 
784     \textcolor{comment}{// KAUST: all nodes should call here}
785     MetropolisHastingsSG<P\_V,P\_M> mcSeqGenerator(inputOptions,
786                                                         rv,
787                                                         auxInitialPosition, \textcolor{comment}{// KEY new: pass logPrior and
       logLikelihood}
788                                                         &unifiedCovMatrix);
789 
790     \textcolor{comment}{// KAUST: all nodes should call here}
791     mcSeqGenerator.generateSequence(tmpChain,
792                                     &tmpLogLikelihoodValues, \textcolor{comment}{// likelihood is IMPORTANT}
793                                     &tmpLogTargetValues);
794     MHRawChainInfoStruct mcRawInfo;
795     mcSeqGenerator.getRawChainInfo(mcRawInfo);
796     cumulativeRunTime    += mcRawInfo.runTime;
797     cumulativeRejections += mcRawInfo.numRejections;
798 
799     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
800       \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_af0bc451b18302cfd5ee747c321e1c6e5}{exceptionalCircumstance}()) \{
801         \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()       ) &&
802             (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{ \textcolor{comment}{// detailed output debug}
803           P\_V tmpVec(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a92e963bb5cab3eecd290dfe4b8f03b04}{zeroVector}());
804           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < tmpLogLikelihoodValues.subSequenceSize(); ++i) \{
805             tmpChain.getPositionValues(i,tmpVec);
806             *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"DEBUG finalChain["} << cumulativeNumPositions+i <
      < \textcolor{stringliteral}{"] "}
807                                     << \textcolor{stringliteral}{"= tmpChain["}               << i << \textcolor{stringliteral}{"] = "} << tmpVec
808                                     << \textcolor{stringliteral}{", tmpLogLikelihoodValues["} << i << \textcolor{stringliteral}{"] = "} << tmpLogLikelihoodValues
      [i]
809                                     << \textcolor{stringliteral}{", tmpLogTargetValues["}     << i << \textcolor{stringliteral}{"] = "} << tmpLogTargetValues[i]
810                                     << std::endl;
811           \}
812         \}
813       \} \textcolor{comment}{// exceptional}
814 
815       cumulativeNumPositions += tmpChainSize;
816       \textcolor{keywordflow}{if} (cumulativeNumPositions > 100) \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_abb2a6a8de19058957f856341fce2440e}{setExceptionalCircumstance}(\textcolor{keyword}{
      false});
817 
818       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()       ) &&
819           (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 3)) \{
820         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In
       MLSampling<P\_V,P\_M>::generateBalLinkedChains\_all()"}
821                                 << \textcolor{stringliteral}{", level "}               << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
822                                 << \textcolor{stringliteral}{", step "}                << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
823                                 << \textcolor{stringliteral}{", chainId = "}           << chainId
824                                 << \textcolor{stringliteral}{" < "}                    << chainIdMax
825                                 << \textcolor{stringliteral}{": finished generating "} << tmpChain.subSequenceSize()
826                                 << \textcolor{stringliteral}{" chain positions"}
827                                 << std::endl;
828       \}
829 
830       \textcolor{comment}{// KAUST5: what if workingChain ends up with different size in different nodes? Important}
831       workingChain.append              (tmpChain,              1,tmpChain.subSequenceSize()-1              
      ); \textcolor{comment}{// IMPORTANT: '1' in order to discard initial position}
832       \textcolor{keywordflow}{if} (currLogLikelihoodValues) \{
833         currLogLikelihoodValues->\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a75cdd556cc417e35a6b9f7aff86896ae}{append}(tmpLogLikelihoodValues,1,tmpLogLikelihoodValues.
      subSequenceSize()-1); \textcolor{comment}{// IMPORTANT: '1' in order to discard initial position}
834         \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()        ) &&
835             (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 99) &&
836             (chainId == 0                  )) \{
837           *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In
       MLSampling<P\_V,P\_M>::generateBalLinkedChains\_all()"}
838                                   << \textcolor{stringliteral}{", level "}     << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
839                                   << \textcolor{stringliteral}{", step "}      << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
840                                   << \textcolor{stringliteral}{", chainId = "} << chainId
841                                   << \textcolor{stringliteral}{", tmpLogLikelihoodValues.subSequenceSize() = "} << 
      tmpLogLikelihoodValues.subSequenceSize()
842                                   << \textcolor{stringliteral}{", tmpLogLikelihoodValues[0] = "}                << 
      tmpLogLikelihoodValues[0]
843                                   << \textcolor{stringliteral}{", tmpLogLikelihoodValues[1] = "}                << 
      tmpLogLikelihoodValues[1]
844                                   << \textcolor{stringliteral}{", currLogLikelihoodValues[0] = "}               << 
      (*currLogLikelihoodValues)[0]
845                                   << std::endl;
846         \}
847       \}
848       \textcolor{keywordflow}{if} (currLogTargetValues) \{
849         currLogTargetValues->\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a75cdd556cc417e35a6b9f7aff86896ae}{append}    (tmpLogTargetValues,    1,tmpLogTargetValues.subSequenceSize()
      -1    ); \textcolor{comment}{// IMPORTANT: '1' in order to discard initial position}
850       \}
851       \textcolor{comment}{// 2013-02-23: print size just appended}
852     \}
853   \} \textcolor{comment}{// for 'chainId'}
854 
855   \textcolor{comment}{// 2013-02-23: print final size}
856 
857   \textcolor{keyword}{struct }timeval timevalBarrier;
858   iRC = gettimeofday(&timevalBarrier, NULL);
859   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
860   \textcolor{keywordtype}{double} loopTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalEntering);
861   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
862     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateBalLinkedChains\_all()"}
863                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
864                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
865                             << \textcolor{stringliteral}{": ended chain loop after "} << loopTime << \textcolor{stringliteral}{" seconds"}
866                             << \textcolor{stringliteral}{", calling fullComm().Barrier() at "} << ctime(&timevalBarrier.tv\_sec)
867                             << std::endl;
868   \}
869 
870   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}(); \textcolor{comment}{// KAUST4}
871 
872   \textcolor{keyword}{struct }timeval timevalLeaving;
873   iRC = gettimeofday(&timevalLeaving, NULL);
874   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
875   \textcolor{keywordtype}{double} barrierTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalBarrier);
876   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
877     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving
       MLSampling<P\_V,P\_M>::generateBalLinkedChains\_all()"}
878                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
879                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
880                             << \textcolor{stringliteral}{": after "} << barrierTime << \textcolor{stringliteral}{" seconds in fullComm().Barrier()"}
881                             << \textcolor{stringliteral}{", at "} << ctime(&timevalLeaving.tv\_sec)
882                             << std::endl;
883   \}
884 
885   \textcolor{keywordflow}{return};
886 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a8d7296b30623c73ada38971cae27994a}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!generate\-Sequence@{generate\-Sequence}}
\index{generate\-Sequence@{generate\-Sequence}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{generate\-Sequence}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Sequence (
\begin{DoxyParamCaption}
\item[{{\bf Base\-Vector\-Sequence}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{working\-Chain, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ $\ast$}]{working\-Log\-Likelihood\-Values, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ $\ast$}]{working\-Log\-Target\-Values}
\end{DoxyParamCaption}
)}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a8d7296b30623c73ada38971cae27994a}


Method to generate the chain. 

\begin{DoxyVerb}Requirement: the vector space 'm_vectorSpace' should have dimension equal to the size of a
\end{DoxyVerb}
 vector in 'working\-Chain'. If the requirement is satisfied, this operation sets the size and the contents of 'working\-Chain' using the algorithm options set in the constructor. If not N\-U\-L\-L, 'working\-Log\-Likelihood\-Values' and 'working\-Log\-Target\-Values' are set accordingly. This operation currently implements the The Parallel Adaptive Multilevel Stochastic Simulation Algorithm (P\-A\-M\-S\-S\-A).\par
 It consists of 11 steps\-: 
\begin{DoxyEnumerate}
\item read options; 
\item save chain and corresponding target pdf values from previous level 
\item compute curr\-Exponent and sequence of weights for current level and update 'm\-\_\-log\-Evidence\-Factors' 
\item create covariance matrix for current level 
\item create {\itshape unified} finite distribution for current level 
\item decide on using balanced chains or not 
\item plan for number of linked chains for each node so that all nodes generate the closest possible to the same number of positions 
\item create vector R\-V for current level 
\item scale unified covariance matrix until min $<$= rejection rate $<$= max 
\item sample vector R\-V of current level 
\item filter chain if requested. 
\end{DoxyEnumerate}At the end, the method computes information gain\-: $ ln( \pi(D|M) ) = E[ln( \pi(D|\theta,M) )] - E[ln( \pi(\theta|D,M) / \pi(\theta|M) )] $

\begin{DoxySeeAlso}{See Also}
S. H. Cheung and E. E. Prudencio. Parallel adaptive multilevel sampling algorithms for the Bayesian analysis of mathematical models. International Journal for Uncertainty Quantification, 2(3)\-:215237, 2012. 
\end{DoxySeeAlso}


Definition at line 4080 of file M\-L\-Sampling.\-C.



References Q\-U\-E\-S\-O\-::\-Balanced\-Linked\-Chains\-Per\-Node\-Struct$<$ P\-\_\-\-V $>$\-::bal\-Linked\-Chains, Q\-U\-E\-S\-O\-::\-Base\-Vector\-Sequence$<$ V, M $>$\-::clear(), Q\-U\-E\-S\-O\-::\-Base\-Vector\-Sequence$<$ V, M $>$\-::compute\-Filter\-Params(), Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::filter(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::filter(), Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::get\-Position\-Values(), L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-min\-Acceptable\-Eta, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-parameter\-Disabled\-Set, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-raw\-Chain\-Size, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-stop\-At\-End, Q\-U\-E\-S\-O\-::\-Misc\-Get\-Ellapsed\-Seconds(), Q\-U\-E\-S\-O\-::\-File\-Ptr\-Set\-Struct\-::ofs\-Var, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-D\-O\-U\-B\-L\-E, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-M\-A\-X, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-M\-I\-N, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-S\-U\-M, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-U\-N\-S\-I\-G\-N\-E\-D, Q\-U\-E\-S\-O\-::\-Base\-Vector\-Sequence$<$ V, M $>$\-::resize\-Sequence(), Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::scan\-Options\-Values(), Q\-U\-E\-S\-O\-::\-Base\-Vector\-Sequence$<$ V, M $>$\-::set\-Name(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::set\-Name(), Q\-U\-E\-S\-O\-::\-Base\-Vector\-Sequence$<$ V, M $>$\-::set\-Position\-Values(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::sub\-Min\-Max\-Extra(), Q\-U\-E\-S\-O\-::\-Base\-Vector\-Sequence$<$ V, M $>$\-::sub\-Sequence\-Size(), Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::sub\-Sequence\-Size(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::sub\-Sequence\-Size(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::unified\-Mean\-Extra(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::unified\-Mean\-Plain(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::unified\-Min\-Max\-Extra(), Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::unified\-Write\-Contents(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::unified\-Write\-Contents(), U\-Q\-\_\-\-F\-A\-T\-A\-L\-\_\-\-T\-E\-S\-T\-\_\-\-M\-A\-C\-R\-O, U\-Q\-\_\-\-F\-I\-L\-E\-\_\-\-E\-X\-T\-E\-N\-S\-I\-O\-N\-\_\-\-F\-O\-R\-\_\-\-M\-A\-T\-L\-A\-B\-\_\-\-F\-O\-R\-M\-A\-T, U\-Q\-\_\-\-M\-H\-\_\-\-S\-G\-\_\-\-F\-I\-L\-E\-N\-A\-M\-E\-\_\-\-F\-O\-R\-\_\-\-N\-O\-\_\-\-F\-I\-L\-E, and Q\-U\-E\-S\-O\-::\-U\-Q\-\_\-\-O\-K\-\_\-\-R\-C.


\begin{DoxyCode}
4084 \{
4085   \textcolor{keyword}{struct }timeval timevalRoutineBegin;
4086   \textcolor{keywordtype}{int} iRC = 0;
4087   iRC = gettimeofday(&timevalRoutineBegin, NULL);
4088   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
4089 
4090   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
4091     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Entering MLSampling<P\_V,P\_M>::generateSequence()"}
4092                             << \textcolor{stringliteral}{", at  "}   << ctime(&timevalRoutineBegin.tv\_sec)
4093                             << \textcolor{stringliteral}{", after "} << timevalRoutineBegin.tv\_sec - \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1adcf7ca2d95e75a29360bcfe091cd65}{timevalBegin}().tv\_sec
4094                             << \textcolor{stringliteral}{" seconds from queso environment instatiation..."}
4095                             << std::endl;
4096   \}
4097 
4098   \textcolor{comment}{//***********************************************************}
4099   \textcolor{comment}{// Declaration of Variables}
4100   \textcolor{comment}{//***********************************************************}
4101   \textcolor{keywordtype}{double}                            currExponent                   = 0.;   \textcolor{comment}{// restate}
4102   \textcolor{keywordtype}{double}                            currEta                        = 1.;   \textcolor{comment}{// restate}
4103   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}                      currUnifiedRequestedNumSamples = 0;
4104   SequenceOfVectors<P\_V,P\_M> currChain              (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}, \textcolor{comment}{// restate}
4105                                                             0,
4106                                                             \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_options_a1d3d48598e0b59b46337ce66a52671a5}{m\_prefix}+\textcolor{stringliteral}{"curr\_chain"});
4107   ScalarSequence<double>     currLogLikelihoodValues(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env},         \textcolor{comment}{// restate}
4108                                                             0,
4109                                                             \textcolor{stringliteral}{""});
4110   ScalarSequence<double>     currLogTargetValues    (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env},         \textcolor{comment}{// restate}
4111                                                             0,
4112                                                             \textcolor{stringliteral}{""});
4113 
4114   \textcolor{keywordtype}{bool} stopAtEndOfLevel = \textcolor{keyword}{false};
4115   \textcolor{keywordtype}{char} levelPrefix[256];
4116 
4117   \textcolor{comment}{//***********************************************************}
4118   \textcolor{comment}{// Take care of first level (level '0')}
4119   \textcolor{comment}{//***********************************************************}
4120   MLSamplingLevelOptions defaultLevelOptions(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env},(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_options_a1d3d48598e0b59b46337ce66a52671a5}{m\_prefix} + \textcolor{stringliteral}{"default\_"}).c\_str());
4121   defaultLevelOptions.scanOptionsValues(NULL);
4122 
4123   MLSamplingLevelOptions lastLevelOptions(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env},(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_options_a1d3d48598e0b59b46337ce66a52671a5}{m\_prefix} + \textcolor{stringliteral}{"last\_"}).c\_str());
4124   lastLevelOptions.scanOptionsValues(&defaultLevelOptions);
4125 
4126   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.m\_restartInput\_baseNameForFiles != \textcolor{stringliteral}{"."}) \{
4127     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aa387be291dd763ce001ea769e87266c4}{restartML}(currExponent,            \textcolor{comment}{// output}
4128               currEta,                 \textcolor{comment}{// output}
4129               currChain,               \textcolor{comment}{// output}
4130               currLogLikelihoodValues, \textcolor{comment}{// output}
4131               currLogTargetValues);    \textcolor{comment}{// output}
4132 
4133     \textcolor{keywordflow}{if} (currExponent == 1.) \{
4134       \textcolor{keywordflow}{if} (lastLevelOptions.m\_parameterDisabledSet.size() > 0) \{ \textcolor{comment}{// gpmsa2}
4135         \textcolor{keywordflow}{for} (std::set<unsigned int>::iterator setIt = lastLevelOptions.m\_parameterDisabledSet.begin(); 
      setIt != lastLevelOptions.m\_parameterDisabledSet.end(); ++setIt) \{
4136           \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} paramId = *setIt;
4137           \textcolor{keywordflow}{if} (paramId < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a5829a1f4f996f8307c840b705144d666}{dimLocal}()) \{
4138             \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_afbe27e6149562020663b72da6592d933}{m\_numDisabledParameters}++;
4139             \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ac76690384f70d74b8662faf7a051449e}{m\_parameterEnabledStatus}[paramId] = \textcolor{keyword}{false};
4140           \}
4141         \}
4142       \}
4143 
4144 \textcolor{preprocessor}{#ifdef QUESO\_USES\_SEQUENCE\_STATISTICAL\_OPTIONS}
4145 \textcolor{preprocessor}{}      \textcolor{keywordflow}{if} (lastLevelOptions.m\_rawChainComputeStats) \{
4146         FilePtrSetStruct filePtrSet;
4147         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ab8fe853074f12ea34e18724119a2fc75}{openOutputFile}(lastLevelOptions.m\_dataOutputFileName,
4148                              \hyperlink{_defines_8h_ac440026eff7deb1c1eed1eea0e8e36ba}{UQ\_FILE\_EXTENSION\_FOR\_MATLAB\_FORMAT}, \textcolor{comment}{//
       Yes, always ".m"}
4149                              lastLevelOptions.m\_dataOutputAllowedSet,
4150                              \textcolor{keyword}{false},
4151                              filePtrSet);
4152 
4153         currChain.computeStatistics(*lastLevelOptions.m\_rawChainStatisticalOptionsObj,
4154                                     filePtrSet.ofsVar);
4155 
4156         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ab712bff194ddd91459d4ea8715c77e8b}{closeFile}(filePtrSet,
      \hyperlink{_defines_8h_ac440026eff7deb1c1eed1eea0e8e36ba}{UQ\_FILE\_EXTENSION\_FOR\_MATLAB\_FORMAT});
4157       \}
4158 \textcolor{preprocessor}{#endif}
4159 \textcolor{preprocessor}{}      \textcolor{comment}{// Compute MLE and MAP}
4160       \textcolor{comment}{// rr0}
4161 
4162       \textcolor{keywordflow}{if} (lastLevelOptions.m\_rawChainDataOutputFileName != 
      \hyperlink{_metropolis_hastings_s_g_options_8h_a75699ceb938d800e2b7f59ede3ea9a31}{UQ\_MH\_SG\_FILENAME\_FOR\_NO\_FILE}) \{
4163         currChain.unifiedWriteContents              (lastLevelOptions.m\_rawChainDataOutputFileName,
      lastLevelOptions.m\_rawChainDataOutputFileType);
4164         currLogLikelihoodValues.unifiedWriteContents(lastLevelOptions.m\_rawChainDataOutputFileName,
      lastLevelOptions.m\_rawChainDataOutputFileType);
4165         currLogTargetValues.unifiedWriteContents    (lastLevelOptions.m\_rawChainDataOutputFileName,
      lastLevelOptions.m\_rawChainDataOutputFileType);
4166       \}
4167 
4168       \textcolor{keywordflow}{if} (lastLevelOptions.m\_filteredChainGenerate) \{
4169         FilePtrSetStruct filePtrSet;
4170         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ab8fe853074f12ea34e18724119a2fc75}{openOutputFile}(lastLevelOptions.m\_dataOutputFileName,
4171                              \hyperlink{_defines_8h_ac440026eff7deb1c1eed1eea0e8e36ba}{UQ\_FILE\_EXTENSION\_FOR\_MATLAB\_FORMAT}, \textcolor{comment}{//
       Yes, always ".m"}
4172                              lastLevelOptions.m\_dataOutputAllowedSet,
4173                              \textcolor{keyword}{false},
4174                              filePtrSet);
4175 
4176         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} filterInitialPos = (\textcolor{keywordtype}{unsigned} int) (lastLevelOptions.m\_filteredChainDiscardedPortion * 
      (\textcolor{keywordtype}{double}) currChain.subSequenceSize());
4177         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} filterSpacing    = lastLevelOptions.m\_filteredChainLag;
4178         \textcolor{keywordflow}{if} (filterSpacing == 0) \{
4179           currChain.computeFilterParams(filePtrSet.ofsVar,
4180                                         filterInitialPos,
4181                                         filterSpacing);
4182         \}
4183 
4184         \textcolor{comment}{// Filter positions from the converged portion of the chain}
4185         currChain.filter(filterInitialPos,
4186                          filterSpacing);
4187         currChain.setName(lastLevelOptions.m\_prefix + \textcolor{stringliteral}{"filtChain"});
4188 
4189         currLogLikelihoodValues.filter(filterInitialPos,
4190                                        filterSpacing);
4191         currLogLikelihoodValues.setName(lastLevelOptions.m\_prefix + \textcolor{stringliteral}{"filtLogLikelihood"});
4192 
4193         currLogTargetValues.filter(filterInitialPos,
4194                                    filterSpacing);
4195         currLogTargetValues.setName(lastLevelOptions.m\_prefix + \textcolor{stringliteral}{"filtLogTarget"});
4196 
4197 \textcolor{preprocessor}{#ifdef QUESO\_USES\_SEQUENCE\_STATISTICAL\_OPTIONS}
4198 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} (lastLevelOptions.m\_filteredChainComputeStats) \{
4199           currChain.computeStatistics(*lastLevelOptions.m\_filteredChainStatisticalOptionsObj,
4200                                       filePtrSet.ofsVar);
4201         \}
4202 \textcolor{preprocessor}{#endif}
4203 \textcolor{preprocessor}{}        \textcolor{comment}{// Compute MLE and MAP}
4204         \textcolor{comment}{// rr0}
4205         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ab712bff194ddd91459d4ea8715c77e8b}{closeFile}(filePtrSet,
      \hyperlink{_defines_8h_ac440026eff7deb1c1eed1eea0e8e36ba}{UQ\_FILE\_EXTENSION\_FOR\_MATLAB\_FORMAT});
4206 
4207         \textcolor{keywordflow}{if} (lastLevelOptions.m\_filteredChainDataOutputFileName != 
      \hyperlink{_metropolis_hastings_s_g_options_8h_a75699ceb938d800e2b7f59ede3ea9a31}{UQ\_MH\_SG\_FILENAME\_FOR\_NO\_FILE}) \{
4208           currChain.unifiedWriteContents              (lastLevelOptions.m\_filteredChainDataOutputFileName,
      lastLevelOptions.m\_filteredChainDataOutputFileType);
4209           currLogLikelihoodValues.unifiedWriteContents(lastLevelOptions.m\_filteredChainDataOutputFileName,
      lastLevelOptions.m\_filteredChainDataOutputFileType);
4210           currLogTargetValues.unifiedWriteContents    (lastLevelOptions.m\_filteredChainDataOutputFileName,
      lastLevelOptions.m\_filteredChainDataOutputFileType);
4211         \}
4212       \} \textcolor{comment}{// if (lastLevelOptions.m\_filteredChainGenerate)}
4213     \}
4214   \}
4215   \textcolor{keywordflow}{else} \{
4216     sprintf(levelPrefix,\textcolor{stringliteral}{"%d\_"},\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}); \textcolor{comment}{// Yes, '+0'}
4217     MLSamplingLevelOptions currOptions(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env},(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_options_a1d3d48598e0b59b46337ce66a52671a5}{m\_prefix} + levelPrefix).c\_str
      ());
4218     currOptions.scanOptionsValues(&defaultLevelOptions);
4219 
4220     \textcolor{keywordflow}{if} (currOptions.m\_parameterDisabledSet.size() > 0) \{ \textcolor{comment}{// gpmsa2}
4221       \textcolor{keywordflow}{for} (std::set<unsigned int>::iterator setIt = currOptions.m\_parameterDisabledSet.begin(); setIt != 
      currOptions.m\_parameterDisabledSet.end(); ++setIt) \{
4222         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} paramId = *setIt;
4223         \textcolor{keywordflow}{if} (paramId < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a5829a1f4f996f8307c840b705144d666}{dimLocal}()) \{
4224           \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_afbe27e6149562020663b72da6592d933}{m\_numDisabledParameters}++;
4225           \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ac76690384f70d74b8662faf7a051449e}{m\_parameterEnabledStatus}[paramId] = \textcolor{keyword}{false};
4226         \}
4227       \}
4228     \}
4229 
4230     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a0a2615d8f3627630d0cb62cb91614bd1}{generateSequence\_Level0\_all}(currOptions,                    \textcolor{comment}{// input}
4231                                 currUnifiedRequestedNumSamples, \textcolor{comment}{// output}
4232                                 currChain,                      \textcolor{comment}{// output}
4233                                 currLogLikelihoodValues,        \textcolor{comment}{// output}
4234                                 currLogTargetValues);           \textcolor{comment}{// output}
4235 
4236     stopAtEndOfLevel = currOptions.m\_stopAtEnd;
4237     \textcolor{keywordtype}{bool} performCheckpoint = stopAtEndOfLevel;
4238     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.m\_restartOutput\_levelPeriod > 0) \{
4239       performCheckpoint = performCheckpoint || ( ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel} + 1) % 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.m\_restartOutput\_levelPeriod) == 0 );
4240     \}
4241     \textcolor{keywordflow}{if} (performCheckpoint) \{
4242       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aa8e7bb1bd54ccafb9b276127a76eba71}{checkpointML}(currExponent,            \textcolor{comment}{// input}
4243                    currEta,                 \textcolor{comment}{// input}
4244                    currChain,               \textcolor{comment}{// input}
4245                    currLogLikelihoodValues, \textcolor{comment}{// input}
4246                    currLogTargetValues);    \textcolor{comment}{// input}
4247     \}
4248   \}
4249   \textcolor{comment}{//std::cout << "In QUESO: end of level 0. Exiting on purpose" << std::endl;}
4250   \textcolor{comment}{//exit(1);}
4251 
4252   \textcolor{keywordtype}{double} minLogLike = -INFINITY;
4253   \textcolor{keywordtype}{double} maxLogLike =  INFINITY;
4254   currLogLikelihoodValues.subMinMaxExtra(0,
4255                                          currLogLikelihoodValues.subSequenceSize(),
4256                                          minLogLike,
4257                                          maxLogLike);
4258   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
4259     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
4260                             << \textcolor{stringliteral}{": at end of level "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
4261                             << \textcolor{stringliteral}{", sub minLogLike = "} << minLogLike
4262                             << \textcolor{stringliteral}{", sub maxLogLike = "} << maxLogLike
4263                             << std::endl;
4264   \}
4265 
4266   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
4267 
4268   minLogLike = -INFINITY;
4269   maxLogLike =  INFINITY;
4270   currLogLikelihoodValues.unifiedMinMaxExtra(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.
      \hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1,
4271                                              0,
4272                                              currLogLikelihoodValues.subSequenceSize(),
4273                                              minLogLike,
4274                                              maxLogLike);
4275   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
4276     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
4277                             << \textcolor{stringliteral}{": at end of level "}      << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
4278                             << \textcolor{stringliteral}{", unified minLogLike = "} << minLogLike
4279                             << \textcolor{stringliteral}{", unified maxLogLike = "} << maxLogLike
4280                             << std::endl;
4281   \}
4282 
4283   \textcolor{comment}{//***********************************************************}
4284   \textcolor{comment}{// Take care of next levels}
4285   \textcolor{comment}{//***********************************************************}
4286   \textcolor{keywordflow}{while} ((currExponent     <  1.   ) && \textcolor{comment}{// begin level while}
4287          (stopAtEndOfLevel == \textcolor{keyword}{false})) \{
4288     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}++; \textcolor{comment}{// restate}
4289 
4290     \textcolor{keyword}{struct }timeval timevalLevelBegin;
4291     iRC = 0;
4292     iRC = gettimeofday(&timevalLevelBegin, NULL);
4293 
4294     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
4295       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
4296                               << \textcolor{stringliteral}{": beginning level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
4297                               << \textcolor{stringliteral}{", at  "}   << ctime(&timevalLevelBegin.tv\_sec)
4298                               << \textcolor{stringliteral}{", after "} << timevalLevelBegin.tv\_sec - timevalRoutineBegin.tv\_sec
4299                               << \textcolor{stringliteral}{" seconds from entering the routine"}
4300                               << \textcolor{stringliteral}{", after "} << timevalLevelBegin.tv\_sec - \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1adcf7ca2d95e75a29360bcfe091cd65}{timevalBegin}().tv\_sec
4301                               << \textcolor{stringliteral}{" seconds from queso environment instatiation"}
4302                               << std::endl;
4303     \}
4304 
4305     iRC = \hyperlink{namespace_q_u_e_s_o_a8e909502900aecf24cedba022ea84471}{UQ\_OK\_RC};
4306     \textcolor{keyword}{struct }timeval timevalLevel;
4307     iRC = gettimeofday(&timevalLevel, NULL);
4308     \textcolor{keywordtype}{double}       cumulativeRawChainRunTime    = 0.;
4309     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} cumulativeRawChainRejections = 0;
4310 
4311     \textcolor{keywordtype}{bool}   tryExponentEta = \textcolor{keyword}{true}; \textcolor{comment}{// gpmsa1}
4312     \textcolor{keywordtype}{double} failedExponent = 0.;   \textcolor{comment}{// gpmsa1}
4313     \textcolor{keywordtype}{double} failedEta      = 0.;   \textcolor{comment}{// gpmsa1}
4314 
4315     MLSamplingLevelOptions*            currOptions           = NULL;  \textcolor{comment}{// step 1}
4316     SequenceOfVectors<P\_V,P\_M>*        prevChain             = NULL;  \textcolor{comment}{// step 2}
4317     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}                              indexOfFirstWeight    = 0;     \textcolor{comment}{// step 2}
4318     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}                              indexOfLastWeight     = 0;     \textcolor{comment}{// step 2}
4319     P\_M*                                      unifiedCovMatrix      = NULL;  \textcolor{comment}{// step 4}
4320     \textcolor{keywordtype}{bool}                                      useBalancedChains     = \textcolor{keyword}{false}; \textcolor{comment}{// step 6}
4321     BalancedLinkedChainsPerNodeStruct<P\_V>* balancedLinkControl   = NULL;  \textcolor{comment}{// step 7}
4322     UnbalancedLinkedChainsPerNodeStruct*    unbalancedLinkControl = NULL;  \textcolor{comment}{// step 7}
4323     BayesianJointPdf<P\_V,P\_M>*         currPdf               = NULL;  \textcolor{comment}{// step 8}
4324     GenericVectorRV<P\_V,P\_M>*          currRv                = NULL;  \textcolor{comment}{// step 8}
4325 
4326     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} exponentEtaTriedAmount = 0;
4327     \textcolor{keywordflow}{while} (tryExponentEta) \{ \textcolor{comment}{// gpmsa1}
4328       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
4329         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In IMLSampling<P\_V,P\_M>::generateSequence()"}
4330                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
4331                                 << \textcolor{stringliteral}{", beginning 'do-while(tryExponentEta)"}
4332                                 << \textcolor{stringliteral}{": failedExponent = "} << failedExponent
4333                                 << \textcolor{stringliteral}{", failedEta = "}      << failedEta
4334                                 << std::endl;
4335       \}
4336 
4337     \textcolor{comment}{//***********************************************************}
4338     \textcolor{comment}{// Step 1 of 11: read options}
4339     \textcolor{comment}{//***********************************************************}
4340     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep} = 1;
4341     sprintf(levelPrefix,\textcolor{stringliteral}{"%d\_"},\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}); \textcolor{comment}{// Yes, '+0'}
4342     currOptions = \textcolor{keyword}{new} MLSamplingLevelOptions(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env},(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_options_a1d3d48598e0b59b46337ce66a52671a5}{m\_prefix} + levelPrefix).c\_str());
4343     currOptions->scanOptionsValues(&defaultLevelOptions);
4344 
4345     \textcolor{keywordflow}{if} (currOptions->m\_parameterDisabledSet.size() > 0) \{ \textcolor{comment}{// gpmsa2}
4346       \textcolor{keywordflow}{for} (std::set<unsigned int>::iterator setIt = currOptions->m\_parameterDisabledSet.begin(); setIt != 
      currOptions->m\_parameterDisabledSet.end(); ++setIt) \{
4347         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} paramId = *setIt;
4348         \textcolor{keywordflow}{if} (paramId < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a5829a1f4f996f8307c840b705144d666}{dimLocal}()) \{
4349           \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_afbe27e6149562020663b72da6592d933}{m\_numDisabledParameters}++;
4350           \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ac76690384f70d74b8662faf7a051449e}{m\_parameterEnabledStatus}[paramId] = \textcolor{keyword}{false};
4351         \}
4352       \}
4353     \}
4354 
4355     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
4356       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aea8da13aed5b04e64b8490ca5f107889}{generateSequence\_Step01\_inter0}(currOptions,                     \textcolor{comment}{//
       input}
4357                                      currUnifiedRequestedNumSamples); \textcolor{comment}{// output}
4358     \}
4359 
4360     \textcolor{comment}{//***********************************************************}
4361     \textcolor{comment}{// Step 2 of 11: save [chain and corresponding target pdf values] from previous level}
4362     \textcolor{comment}{//***********************************************************}
4363     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep} = 2;
4364     \textcolor{keywordtype}{double}       prevExponent                   = currExponent;
4365     \textcolor{keywordtype}{double}       prevEta                        = currEta;
4366     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} prevUnifiedRequestedNumSamples = currUnifiedRequestedNumSamples;
4367     prevChain = \textcolor{keyword}{new} SequenceOfVectors<P\_V,P\_M>(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace},
4368                                                       0,
4369                                                       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_options_a1d3d48598e0b59b46337ce66a52671a5}{m\_prefix}+\textcolor{stringliteral}{"prev\_chain"});
4370     ScalarSequence<double> prevLogLikelihoodValues(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env},0,\textcolor{stringliteral}{""});
4371     ScalarSequence<double> prevLogTargetValues    (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env},0,\textcolor{stringliteral}{""});
4372 
4373     indexOfFirstWeight = 0;
4374     indexOfLastWeight  = 0;
4375 
4376     \textcolor{comment}{//std::cout << "m\_env.inter0Rank() = " << m\_env.inter0Rank() << std::endl;}
4377     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
4378       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a06c37730b943a1838d58475d322639b9}{generateSequence\_Step02\_inter0}(currOptions,             \textcolor{comment}{// input}
4379                                      currChain,               \textcolor{comment}{// input/output // restate}
4380                                      currLogLikelihoodValues, \textcolor{comment}{// input/output // restate}
4381                                      currLogTargetValues,     \textcolor{comment}{// input/output // restate}
4382                                      *prevChain,              \textcolor{comment}{// output}
4383                                      prevLogLikelihoodValues, \textcolor{comment}{// output}
4384                                      prevLogTargetValues,     \textcolor{comment}{// output}
4385                                      indexOfFirstWeight,      \textcolor{comment}{// output}
4386                                      indexOfLastWeight);      \textcolor{comment}{// output}
4387     \}
4388 
4389     \textcolor{comment}{//***********************************************************}
4390     \textcolor{comment}{// Step 3 of 11: compute [currExponent and sequence of weights] for current level}
4391     \textcolor{comment}{//               update 'm\_logEvidenceFactors'}
4392     \textcolor{comment}{//***********************************************************}
4393     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep} = 3;
4394     ScalarSequence<double> weightSequence(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env},prevLogLikelihoodValues.subSequenceSize(),\textcolor{stringliteral}{""});
4395     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
4396       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ae53e6bc0ec5d1f3d3ac9df268086cd75}{generateSequence\_Step03\_inter0}(currOptions,             \textcolor{comment}{// input}
4397                                      prevLogLikelihoodValues, \textcolor{comment}{// input}
4398                                      prevExponent,            \textcolor{comment}{// input}
4399                                      failedExponent,          \textcolor{comment}{// input // gpmsa1}
4400                                      currExponent,            \textcolor{comment}{// output}
4401                                      weightSequence);         \textcolor{comment}{// output}
4402     \}
4403 
4404     \textcolor{comment}{// All nodes in 'subComm' should have the same 'currExponent'}
4405     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &currExponent, (\textcolor{keywordtype}{int}) 1, 
      \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, 0, \textcolor{comment}{// Yes, 'subComm', important}
4406                           \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
4407                           \textcolor{stringliteral}{"failed MPI.Bcast() for currExponent"});
4408     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_abdd5cd35419283c33cc40a77d0f4f07f}{m\_debugExponent} = currExponent;
4409 
4410     \textcolor{keywordflow}{if} (currExponent == 1.) \{
4411       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
4412         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
4413                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
4414                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
4415                                 << \textcolor{stringliteral}{": copying 'last' level options to current options"} \textcolor{comment}{// In all nodes of
       'subComm', important}
4416                                 << std::endl;
4417       \}
4418       \textcolor{keyword}{delete} currOptions;
4419       currOptions = &lastLevelOptions;
4420 
4421       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
4422         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
4423                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
4424                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
4425                                 << \textcolor{stringliteral}{": after copying 'last' level options to current options, the current
       options are"}
4426                                 << \textcolor{stringliteral}{"\(\backslash\)n"} << *currOptions
4427                                 << std::endl;
4428       \}
4429 
4430       \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
4431         \textcolor{comment}{// It is necessary to recompute 'currUnifiedRequestedNumSamples' because}
4432         \textcolor{comment}{// 'currOptions' has just been replaced by 'lastLevelOptions'}
4433         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} tmpSize = currOptions->m\_rawChainSize;
4434         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &tmpSize, (\textcolor{keywordtype}{void} *) &
      currUnifiedRequestedNumSamples, (\textcolor{keywordtype}{int}) 1, \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 
      \hyperlink{_mpi_comm_8h_afbf78d291c032aa7f512bc566cee2bd1}{RawValue\_MPI\_SUM},
4435                                      \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
4436                                      \textcolor{stringliteral}{"failed MPI.Allreduce() for requested num samples in step 3"});
4437       \}
4438     \}
4439 
4440     \textcolor{comment}{//***********************************************************}
4441     \textcolor{comment}{// Step 4 of 11: create covariance matrix for current level}
4442     \textcolor{comment}{//***********************************************************}
4443     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep} = 4;
4444     P\_V oneVec(m\_vectorSpace.zeroVector());
4445     oneVec.cwSet(1.);
4446 
4447     unifiedCovMatrix = NULL;
4448     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
4449       unifiedCovMatrix = m\_vectorSpace.newMatrix();
4450     \}
4451     \textcolor{keywordflow}{else} \{
4452       unifiedCovMatrix = \textcolor{keyword}{new} P\_M(oneVec);
4453     \}
4454 
4455     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
4456       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a955fb446652327edbc275e3d9145e2db}{generateSequence\_Step04\_inter0}(*prevChain,         \textcolor{comment}{// input}
4457                                      weightSequence,     \textcolor{comment}{// input}
4458                                      *unifiedCovMatrix); \textcolor{comment}{// output}
4459     \}
4460 
4461     \textcolor{comment}{//***********************************************************}
4462     \textcolor{comment}{// Step 5 of 11: create *unified* finite distribution for current level}
4463     \textcolor{comment}{//***********************************************************}
4464     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep} = 5;
4465     std::vector<unsigned int> unifiedIndexCountersAtProc0Only(0);
4466     std::vector<double>       unifiedWeightStdVectorAtProc0Only(0); \textcolor{comment}{// KAUST, to check}
4467     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
4468       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a3db529d364d5bb47916066d7cc21cb00}{generateSequence\_Step05\_inter0}(currUnifiedRequestedNumSamples,     \textcolor{comment}{//
       input}
4469                                      weightSequence,                     \textcolor{comment}{// input}
4470                                      unifiedIndexCountersAtProc0Only,    \textcolor{comment}{// output}
4471                                      unifiedWeightStdVectorAtProc0Only); \textcolor{comment}{// output}
4472     \}
4473 
4474     \textcolor{comment}{//***********************************************************}
4475     \textcolor{comment}{// Step 6 of 11: decide on using balanced chains or not}
4476     \textcolor{comment}{//***********************************************************}
4477     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep} = 6;
4478     useBalancedChains = \textcolor{keyword}{false};
4479     std::vector<ExchangeInfoStruct> exchangeStdVec(0);
4480     \textcolor{comment}{// All processors should call this routine in order to have the same decision value}
4481     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a21f642100e0690f65563e2c1f8bed816}{generateSequence\_Step06\_all}(currOptions,                     \textcolor{comment}{// input}
4482                                 indexOfFirstWeight,              \textcolor{comment}{// input}
4483                                 indexOfLastWeight,               \textcolor{comment}{// input}
4484                                 unifiedIndexCountersAtProc0Only, \textcolor{comment}{// input}
4485                                 useBalancedChains,               \textcolor{comment}{// output}
4486                                 exchangeStdVec);                 \textcolor{comment}{// output}
4487 
4488     \textcolor{comment}{//***********************************************************}
4489     \textcolor{comment}{// Step 7 of 11: plan for number of linked chains for each node so that all}
4490     \textcolor{comment}{//               nodes generate the closest possible to the same number of positions}
4491     \textcolor{comment}{//***********************************************************}
4492     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep} = 7;
4493     balancedLinkControl   = \textcolor{keyword}{new} BalancedLinkedChainsPerNodeStruct<P\_V>();
4494     unbalancedLinkControl = \textcolor{keyword}{new} UnbalancedLinkedChainsPerNodeStruct   ();
4495     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
4496       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a270d639f90f6f2c60d1af851eea63d41}{generateSequence\_Step07\_inter0}(useBalancedChains,               \textcolor{comment}{//
       input}
4497                                      indexOfFirstWeight,              \textcolor{comment}{// input}
4498                                      indexOfLastWeight,               \textcolor{comment}{// input}
4499                                      unifiedIndexCountersAtProc0Only, \textcolor{comment}{// input}
4500                                      *unbalancedLinkControl,          \textcolor{comment}{// (possible) output}
4501                                      currOptions,                     \textcolor{comment}{// input}
4502                                      *prevChain,                      \textcolor{comment}{// input}
4503                                      exchangeStdVec,                  \textcolor{comment}{// (possible) input/output}
4504                                      *balancedLinkControl);           \textcolor{comment}{// (possible) output}
4505     \}
4506 
4507     \textcolor{comment}{// aqui: prevChain might not be needed anymore. Delete it to save memory}
4508 
4509     \textcolor{comment}{//***********************************************************}
4510     \textcolor{comment}{// Step 8 of 11: create vector RV for current level}
4511     \textcolor{comment}{//***********************************************************}
4512     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep} = 8;
4513     currPdf = \textcolor{keyword}{new} BayesianJointPdf<P\_V,P\_M> (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_options_a1d3d48598e0b59b46337ce66a52671a5}{m\_prefix}.c\_str(),
4514                                                     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aa45e9c06bd51cae0dc2294af1831c158}{m\_priorRv}.\hyperlink{class_q_u_e_s_o_1_1_base_vector_r_v_a3206740e05e0c64a88273029e963b185}{pdf}(),
4515                                                     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ab08c3059d23460db49b229aa88bd4e70}{m\_likelihoodFunction},
4516                                                     currExponent,
4517                                                     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a21525858e93a7d9654fdf68c8ac25576}{m\_targetDomain});
4518 
4519     currRv = \textcolor{keyword}{new} GenericVectorRV<P\_V,P\_M> (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_options_a1d3d48598e0b59b46337ce66a52671a5}{m\_prefix}.c\_str(),
4520                                                   *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a21525858e93a7d9654fdf68c8ac25576}{m\_targetDomain});
4521 
4522     \textcolor{comment}{// All nodes should set 'currRv'}
4523     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a754bc11c7802f627fece9f063450739a}{generateSequence\_Step08\_all}(*currPdf,
4524                                 *currRv);
4525 
4526     \textcolor{comment}{//***********************************************************}
4527     \textcolor{comment}{// Step 9 of 11: scale unified covariance matrix until min <= rejection rate <= max}
4528     \textcolor{comment}{//***********************************************************}
4529     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep} = 9;
4530     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a26892288f3b1902d78ba049b96579a08}{generateSequence\_Step09\_all}(*prevChain,                        \textcolor{comment}{// input}
4531                                 indexOfFirstWeight,                \textcolor{comment}{// input}
4532                                 indexOfLastWeight,                 \textcolor{comment}{// input}
4533                                 unifiedWeightStdVectorAtProc0Only, \textcolor{comment}{// input}
4534                                 weightSequence,                    \textcolor{comment}{// input}
4535                                 prevEta,                           \textcolor{comment}{// input}
4536                                 *currRv,                           \textcolor{comment}{// input}
4537                                 currOptions,                       \textcolor{comment}{// input (changed temporarily
       internally)}
4538                                 *unifiedCovMatrix,                 \textcolor{comment}{// input/output}
4539                                 currEta);                          \textcolor{comment}{// output}
4540 
4541     tryExponentEta = \textcolor{keyword}{false}; \textcolor{comment}{// gpmsa1}
4542     \textcolor{keywordflow}{if} ((currOptions->m\_minAcceptableEta > 0.     ) && \textcolor{comment}{// gpmsa1}
4543         (currEta < currOptions->m\_minAcceptableEta)) \{
4544       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
4545         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
4546                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
4547                                 << \textcolor{stringliteral}{", preparing to retry ExponentEta"}
4548                                 << \textcolor{stringliteral}{": currExponent = "} << currExponent
4549                                 << \textcolor{stringliteral}{", currEta = "}      << currEta
4550                                 << std::endl;
4551       \}
4552       exponentEtaTriedAmount++;
4553       tryExponentEta = \textcolor{keyword}{true};
4554       failedExponent = currExponent;
4555       failedEta      = currEta;
4556 
4557       \textcolor{comment}{// "Return" to previous level}
4558       \textcolor{keyword}{delete} currRv;                 \textcolor{comment}{// Step 8}
4559       currRv = NULL;                 \textcolor{comment}{// Step 8}
4560       \textcolor{keyword}{delete} currPdf;                \textcolor{comment}{// Step 8}
4561       currPdf = NULL;                \textcolor{comment}{// Step 8}
4562 
4563       \textcolor{keyword}{delete} balancedLinkControl;    \textcolor{comment}{// Step 7}
4564       balancedLinkControl   = NULL;  \textcolor{comment}{// Step 7}
4565       \textcolor{keyword}{delete} unbalancedLinkControl;  \textcolor{comment}{// Step 7}
4566       unbalancedLinkControl = NULL;  \textcolor{comment}{// Step 7}
4567 
4568       \textcolor{keyword}{delete} unifiedCovMatrix;       \textcolor{comment}{// Step 4}
4569       unifiedCovMatrix = NULL;       \textcolor{comment}{// Step 4}
4570 
4571       currExponent                   = prevExponent;
4572       currEta                        = 1.; \textcolor{comment}{// prevEta;}
4573       currUnifiedRequestedNumSamples = prevUnifiedRequestedNumSamples;
4574 
4575       currChain.clear();             \textcolor{comment}{// Step 2}
4576       currChain = (*prevChain);      \textcolor{comment}{// Step 2}
4577       \textcolor{keyword}{delete} prevChain;              \textcolor{comment}{// Step 2}
4578       prevChain = NULL;              \textcolor{comment}{// Step 2}
4579 
4580       currLogLikelihoodValues        = prevLogLikelihoodValues;
4581       currLogTargetValues            = prevLogTargetValues;
4582     \}
4583     \} \textcolor{comment}{// while (tryExponentEta) // gpmsa1}
4584 
4585     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{ \textcolor{comment}{// gpmsa1}
4586       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
4587                               << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
4588                               << \textcolor{stringliteral}{", exited 'do-while(tryExponentEta)"}
4589                               << \textcolor{stringliteral}{", failedExponent = "} << failedExponent
4590                               << \textcolor{stringliteral}{", failedEta = "}      << failedEta
4591                               << std::endl;
4592     \}
4593 
4594     \textcolor{comment}{//***********************************************************}
4595     \textcolor{comment}{// Step 10 of 11: sample vector RV of current level}
4596     \textcolor{comment}{//***********************************************************}
4597     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep} = 10;
4598     \textcolor{comment}{// All nodes should call here}
4599     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a04322fda4c97eee6c6739fc007d642c1}{generateSequence\_Step10\_all}(*currOptions,                 \textcolor{comment}{// input (changed
       temporarily internally)}
4600                                 *unifiedCovMatrix,            \textcolor{comment}{// input}
4601                                 *currRv,                      \textcolor{comment}{// input}
4602                                 useBalancedChains,            \textcolor{comment}{// input}
4603                                 *unbalancedLinkControl,       \textcolor{comment}{// input // Round Rock}
4604                                 indexOfFirstWeight,           \textcolor{comment}{// input // Round Rock}
4605                                 *prevChain,                   \textcolor{comment}{// input // Round Rock}
4606                                 *balancedLinkControl,         \textcolor{comment}{// input // Round Rock}
4607                                 currChain,                    \textcolor{comment}{// output}
4608                                 cumulativeRawChainRunTime,    \textcolor{comment}{// output}
4609                                 cumulativeRawChainRejections, \textcolor{comment}{// output}
4610                                 &currLogLikelihoodValues,     \textcolor{comment}{// output // likelihood is important}
4611                                 &currLogTargetValues);        \textcolor{comment}{// output);}
4612 
4613     \textcolor{comment}{//***********************************************************}
4614     \textcolor{comment}{// Perform checkpoint if necessary}
4615     \textcolor{comment}{//***********************************************************}
4616     stopAtEndOfLevel = currOptions->m\_stopAtEnd;
4617     \textcolor{keywordtype}{bool} performCheckpoint = stopAtEndOfLevel;
4618     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.m\_restartOutput\_levelPeriod > 0) \{
4619       performCheckpoint = performCheckpoint || ( ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel} + 1) % 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.m\_restartOutput\_levelPeriod) == 0 );
4620       \textcolor{keywordflow}{if} (currExponent == 1.) \{
4621         performCheckpoint = \textcolor{keyword}{true};
4622       \}
4623     \}
4624     \textcolor{keywordflow}{if} (performCheckpoint) \{
4625       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aa8e7bb1bd54ccafb9b276127a76eba71}{checkpointML}(currExponent,            \textcolor{comment}{// input}
4626                    currEta,                 \textcolor{comment}{// input}
4627                    currChain,               \textcolor{comment}{// input}
4628                    currLogLikelihoodValues, \textcolor{comment}{// input}
4629                    currLogTargetValues);    \textcolor{comment}{// input}
4630     \}
4631 
4632     \textcolor{comment}{//***********************************************************}
4633     \textcolor{comment}{// Just free some memory}
4634     \textcolor{comment}{//***********************************************************}
4635     \{
4636       \textcolor{keyword}{delete} unifiedCovMatrix;
4637 
4638       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < balancedLinkControl->balLinkedChains.size(); ++i) \{
4639         \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(balancedLinkControl->balLinkedChains[i].initialPosition == 
      NULL,
4640                             \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
4641                             \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
4642                             \textcolor{stringliteral}{"Initial position pointer in step 9 should not be NULL"});
4643         \textcolor{keyword}{delete} balancedLinkControl->balLinkedChains[i].initialPosition;
4644         balancedLinkControl->balLinkedChains[i].initialPosition = NULL;
4645       \}
4646       balancedLinkControl->balLinkedChains.clear();
4647     \}
4648 
4649     \textcolor{comment}{//***********************************************************}
4650     \textcolor{comment}{// Step 11 of 11: filter chain if requested}
4651     \textcolor{comment}{//***********************************************************}
4652     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep} = 11;
4653     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} unifiedNumberOfRejections = 0;
4654     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
4655       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aae527304bc1012a91ffc396e94fbab11}{generateSequence\_Step11\_inter0}(currOptions,                      \textcolor{comment}{//
       input}
4656                                      currUnifiedRequestedNumSamples,   \textcolor{comment}{// input}
4657                                      cumulativeRawChainRejections,     \textcolor{comment}{// input}
4658                                      currChain,                        \textcolor{comment}{// input/output}
4659                                      currLogLikelihoodValues,          \textcolor{comment}{// input/output}
4660                                      currLogTargetValues,              \textcolor{comment}{// input/output}
4661                                      unifiedNumberOfRejections);       \textcolor{comment}{// output}
4662     \}
4663 
4664     minLogLike = -INFINITY;
4665     maxLogLike =  INFINITY;
4666     currLogLikelihoodValues.subMinMaxExtra(0,
4667                                            currLogLikelihoodValues.subSequenceSize(),
4668                                            minLogLike,
4669                                            maxLogLike);
4670     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
4671       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
4672                               << \textcolor{stringliteral}{": at end of level "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
4673                               << \textcolor{stringliteral}{", sub minLogLike = "} << minLogLike
4674                               << \textcolor{stringliteral}{", sub maxLogLike = "} << maxLogLike
4675                               << std::endl;
4676     \}
4677 
4678     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
4679 
4680     minLogLike = -INFINITY;
4681     maxLogLike =  INFINITY;
4682     currLogLikelihoodValues.unifiedMinMaxExtra(m\_vectorSpace.numOfProcsForStorage() == 1,
4683                                                0,
4684                                                currLogLikelihoodValues.subSequenceSize(),
4685                                                minLogLike,
4686                                                maxLogLike);
4687     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
4688       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
4689                               << \textcolor{stringliteral}{": at end of level "}      << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
4690                               << \textcolor{stringliteral}{", unified minLogLike = "} << minLogLike
4691                               << \textcolor{stringliteral}{", unified maxLogLike = "} << maxLogLike
4692                               << std::endl;
4693     \}
4694 
4695     \textcolor{comment}{//***********************************************************}
4696     \textcolor{comment}{// Prepare to end current level}
4697     \textcolor{comment}{//***********************************************************}
4698     \textcolor{keywordtype}{double} levelRunTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalLevel);
4699     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
4700       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
4701                               << \textcolor{stringliteral}{": ending level "}                   << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
4702                               << \textcolor{stringliteral}{", having generated "}               << currChain.subSequenceSize()
4703                               << \textcolor{stringliteral}{" chain positions"}
4704                               << \textcolor{stringliteral}{", cumulativeRawChainRunTime = "}    << cumulativeRawChainRunTime << \textcolor{stringliteral}{"
       seconds"}
4705                               << \textcolor{stringliteral}{", total level time = "}             << levelRunTime              << \textcolor{stringliteral}{"
       seconds"}
4706                               << \textcolor{stringliteral}{", cumulativeRawChainRejections = "} << cumulativeRawChainRejections
4707                               << \textcolor{stringliteral}{" ("} << 100.*((double) cumulativeRawChainRejections)/((double) currOptions
      ->m\_rawChainSize)
4708                               << \textcolor{stringliteral}{"% at this processor)"}
4709                               << \textcolor{stringliteral}{" ("} << 100.*((double) unifiedNumberOfRejections)/((double) 
      currUnifiedRequestedNumSamples)
4710                               << \textcolor{stringliteral}{"% over all processors)"}
4711                               << \textcolor{stringliteral}{", stopAtEndOfLevel = "} << stopAtEndOfLevel
4712                               << std::endl;
4713     \}
4714 
4715     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
4716       \textcolor{keywordtype}{double} minCumulativeRawChainRunTime = 0.;
4717       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &cumulativeRawChainRunTime, (\textcolor{keywordtype}{void} *) &
      minCumulativeRawChainRunTime, (\textcolor{keywordtype}{int}) 1, \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, 
      \hyperlink{_mpi_comm_8h_a8e30f42fdac116861205e83e2aa18042}{RawValue\_MPI\_MIN},
4718                                    \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
4719                                    \textcolor{stringliteral}{"failed MPI.Allreduce() for min cumulative raw chain run time"});
4720 
4721       \textcolor{keywordtype}{double} maxCumulativeRawChainRunTime = 0.;
4722       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &cumulativeRawChainRunTime, (\textcolor{keywordtype}{void} *) &
      maxCumulativeRawChainRunTime, (\textcolor{keywordtype}{int}) 1, \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, 
      \hyperlink{_mpi_comm_8h_a68f3ac7ff71a6504e236b0c95de78178}{RawValue\_MPI\_MAX},
4723                                    \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
4724                                    \textcolor{stringliteral}{"failed MPI.Allreduce() for max cumulative raw chain run time"});
4725 
4726       \textcolor{keywordtype}{double} avgCumulativeRawChainRunTime = 0.;
4727       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &cumulativeRawChainRunTime, (\textcolor{keywordtype}{void} *) &
      avgCumulativeRawChainRunTime, (\textcolor{keywordtype}{int}) 1, \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, 
      \hyperlink{_mpi_comm_8h_afbf78d291c032aa7f512bc566cee2bd1}{RawValue\_MPI\_SUM},
4728                                    \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
4729                                    \textcolor{stringliteral}{"failed MPI.Allreduce() for sum cumulative raw chain run time"});
4730       avgCumulativeRawChainRunTime /= ((double) \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().
      \hyperlink{class_q_u_e_s_o_1_1_mpi_comm_aa780721ae0fdeabc5a15e04cb0cad964}{NumProc}());
4731 
4732       \textcolor{keywordtype}{double} minLevelRunTime = 0.;
4733       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &levelRunTime, (\textcolor{keywordtype}{void} *) &
      minLevelRunTime, (\textcolor{keywordtype}{int}) 1, \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, \hyperlink{_mpi_comm_8h_a8e30f42fdac116861205e83e2aa18042}{RawValue\_MPI\_MIN},
4734                                    \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
4735                                    \textcolor{stringliteral}{"failed MPI.Allreduce() for min level run time"});
4736 
4737       \textcolor{keywordtype}{double} maxLevelRunTime = 0.;
4738       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &levelRunTime, (\textcolor{keywordtype}{void} *) &
      maxLevelRunTime, (\textcolor{keywordtype}{int}) 1, \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, \hyperlink{_mpi_comm_8h_a68f3ac7ff71a6504e236b0c95de78178}{RawValue\_MPI\_MAX},
4739                                    \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
4740                                    \textcolor{stringliteral}{"failed MPI.Allreduce() for max level run time"});
4741 
4742       \textcolor{keywordtype}{double} avgLevelRunTime = 0.;
4743       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &levelRunTime, (\textcolor{keywordtype}{void} *) &
      avgLevelRunTime, (\textcolor{keywordtype}{int}) 1, \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, \hyperlink{_mpi_comm_8h_afbf78d291c032aa7f512bc566cee2bd1}{RawValue\_MPI\_SUM},
4744                                    \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
4745                                    \textcolor{stringliteral}{"failed MPI.Allreduce() for sum level run time"});
4746       avgLevelRunTime /= ((double) \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_aa780721ae0fdeabc5a15e04cb0cad964}{NumProc}());
4747 
4748       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
4749         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
4750                                 << \textcolor{stringliteral}{", level "}               << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
4751                                 << \textcolor{stringliteral}{": min cumul seconds = "} << minCumulativeRawChainRunTime
4752                                 << \textcolor{stringliteral}{", avg cumul seconds = "} << avgCumulativeRawChainRunTime
4753                                 << \textcolor{stringliteral}{", max cumul seconds = "} << maxCumulativeRawChainRunTime
4754                                 << \textcolor{stringliteral}{", min level seconds = "} << minLevelRunTime
4755                                 << \textcolor{stringliteral}{", avg level seconds = "} << avgLevelRunTime
4756                                 << \textcolor{stringliteral}{", max level seconds = "} << maxLevelRunTime
4757                                 << std::endl;
4758       \}
4759     \}
4760 
4761     \textcolor{keywordflow}{if} (currExponent != 1.) \textcolor{keyword}{delete} currOptions;
4762 
4763     \textcolor{keyword}{struct }timeval timevalLevelEnd;
4764     iRC = 0;
4765     iRC = gettimeofday(&timevalLevelEnd, NULL);
4766 
4767     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
4768       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Getting at the end of level "} << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
4769                               << \textcolor{stringliteral}{", as part of a 'while' on levels"}
4770                               << \textcolor{stringliteral}{", at  "}   << ctime(&timevalLevelEnd.tv\_sec)
4771                               << \textcolor{stringliteral}{", after "} << timevalLevelEnd.tv\_sec - timevalRoutineBegin.tv\_sec
4772                               << \textcolor{stringliteral}{" seconds from entering the routine"}
4773                               << \textcolor{stringliteral}{", after "} << timevalLevelEnd.tv\_sec - \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1adcf7ca2d95e75a29360bcfe091cd65}{timevalBegin}().tv\_sec
4774                               << \textcolor{stringliteral}{" seconds from queso environment instatiation"}
4775                               << std::endl;
4776     \}
4777   \} \textcolor{comment}{// end of level while}
4778 
4779   \textcolor{comment}{//UQ\_FATAL\_TEST\_MACRO((currExponent < 1.),}
4780   \textcolor{comment}{//                    m\_env.worldRank(),}
4781   \textcolor{comment}{//                    "MLSampling<P\_V,P\_M>::generateSequence()",}
4782   \textcolor{comment}{//                    "exponent has not achieved value '1' even after exiting level loop");}
4783 
4784   \textcolor{comment}{//***********************************************************}
4785   \textcolor{comment}{// Compute information gain}
4786   \textcolor{comment}{// ln( \(\backslash\)pi(D|M) ) = E[ln( \(\backslash\)pi(D|\(\backslash\)theta,M) )] - E[ln( \(\backslash\)pi(\(\backslash\)theta|D,M) / \(\backslash\)pi(\(\backslash\)theta|M) )]}
4787   \textcolor{comment}{//***********************************************************}
4788   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{ \textcolor{comment}{// KAUST}
4789     \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel} != 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.size()),
4790                         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
4791                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
4792                         \textcolor{stringliteral}{"invalid m\_currLevel at the exit of the level loop"});
4793     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_afad63c42dccb1518319bf677f2bffde0}{m\_logEvidence} = 0.;
4794     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.size(); ++i) \{
4795       m\_logEvidence += \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}[i];
4796     \}
4797 
4798 \textcolor{preprocessor}{#if 1 // prudenci-2012-07-06}
4799 \textcolor{preprocessor}{}    \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aec4229773274b58e3eaa49a77738389f}{m\_meanLogLikelihood} = currLogLikelihoodValues.unifiedMeanPlain(m\_vectorSpace.
      numOfProcsForStorage() == 1);
4800 \textcolor{preprocessor}{#else}
4801 \textcolor{preprocessor}{}    \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aec4229773274b58e3eaa49a77738389f}{m\_meanLogLikelihood} = currLogLikelihoodValues.unifiedMeanExtra(m\_vectorSpace.
      numOfProcsForStorage() == 1,
4802                                                                    0,
4803                                                                    currLogLikelihoodValues.subSequenceSize(
      ));
4804 \textcolor{preprocessor}{#endif}
4805 \textcolor{preprocessor}{}
4806     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_abec7f8cf9da08bc5c0a20d99fa4570af}{m\_eig} = \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aec4229773274b58e3eaa49a77738389f}{m\_meanLogLikelihood} - \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_afad63c42dccb1518319bf677f2bffde0}{m\_logEvidence};
4807 
4808     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
4809       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
4810                               << \textcolor{stringliteral}{", log(evidence) = "}     << m\_logEvidence
4811                               << \textcolor{stringliteral}{", evidence = "}          << exp(m\_logEvidence)
4812                               << \textcolor{stringliteral}{", meanLogLikelihood = "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aec4229773274b58e3eaa49a77738389f}{m\_meanLogLikelihood}
4813                               << \textcolor{stringliteral}{", eig = "}               << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_abec7f8cf9da08bc5c0a20d99fa4570af}{m\_eig}
4814                               << std::endl;
4815     \}
4816   \}
4817 
4818   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &m\_logEvidence, (\textcolor{keywordtype}{int}) 1, 
      \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, 0, \textcolor{comment}{// Yes, 'subComm'}
4819                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
4820                         \textcolor{stringliteral}{"failed MPI.Bcast() for m\_logEvidence"});
4821 
4822   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aec4229773274b58e3eaa49a77738389f}{m\_meanLogLikelihood}, (\textcolor{keywordtype}{int}) 1, 
      \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, 0, \textcolor{comment}{// Yes, 'subComm'}
4823                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
4824                         \textcolor{stringliteral}{"failed MPI.Bcast() for m\_meanLogLikelihood"});
4825 
4826   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_abec7f8cf9da08bc5c0a20d99fa4570af}{m\_eig}, (\textcolor{keywordtype}{int}) 1, 
      \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, 0, \textcolor{comment}{// Yes, 'subComm'}
4827                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
4828                         \textcolor{stringliteral}{"failed MPI.Bcast() for m\_eig"});
4829 
4830   \textcolor{comment}{//***********************************************************}
4831   \textcolor{comment}{// Prepare to return}
4832   \textcolor{comment}{//***********************************************************}
4833   workingChain.\hyperlink{class_q_u_e_s_o_1_1_base_vector_sequence_aae0804eacc51b37e84b1bd329ce1711c}{clear}();
4834   workingChain.\hyperlink{class_q_u_e_s_o_1_1_base_vector_sequence_adc238af7f6e8af2402ab791de7d60af5}{resizeSequence}(currChain.subSequenceSize());
4835   P\_V auxVec(m\_vectorSpace.zeroVector());
4836   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < workingChain.\hyperlink{class_q_u_e_s_o_1_1_base_vector_sequence_afd6278702d40bdf1044697bbd6ad1957}{subSequenceSize}(); ++i) \{
4837     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
4838       currChain.getPositionValues(i,auxVec);
4839     \}
4840     workingChain.\hyperlink{class_q_u_e_s_o_1_1_base_vector_sequence_a5bcce98b68e0e24c05136e7a3bb50c12}{setPositionValues}(i,auxVec);
4841   \}
4842 
4843   \textcolor{keywordflow}{if} (workingLogLikelihoodValues) *workingLogLikelihoodValues = currLogLikelihoodValues;
4844   \textcolor{keywordflow}{if} (workingLogTargetValues    ) *workingLogTargetValues     = currLogTargetValues;
4845 
4846   \textcolor{keyword}{struct }timeval timevalRoutineEnd;
4847   iRC = 0;
4848   iRC = gettimeofday(&timevalRoutineEnd, NULL);
4849 
4850   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
4851     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving MLSampling<P\_V,P\_M>::generateSequence()"}
4852                             << \textcolor{stringliteral}{", at  "}   << ctime(&timevalRoutineEnd.tv\_sec)
4853                             << \textcolor{stringliteral}{", after "} << timevalRoutineEnd.tv\_sec - timevalRoutineBegin.tv\_sec
4854                             << \textcolor{stringliteral}{" seconds from entering the routine"}
4855                             << \textcolor{stringliteral}{", after "} << timevalRoutineEnd.tv\_sec - \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1adcf7ca2d95e75a29360bcfe091cd65}{timevalBegin}().tv\_sec
4856                             << \textcolor{stringliteral}{" seconds from queso environment instatiation"}
4857                             << std::endl;
4858   \}
4859 
4860   \textcolor{keywordflow}{return};
4861 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a0a2615d8f3627630d0cb62cb91614bd1}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!generate\-Sequence\-\_\-\-Level0\-\_\-all@{generate\-Sequence\-\_\-\-Level0\-\_\-all}}
\index{generate\-Sequence\-\_\-\-Level0\-\_\-all@{generate\-Sequence\-\_\-\-Level0\-\_\-all}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{generate\-Sequence\-\_\-\-Level0\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Sequence\-\_\-\-Level0\-\_\-all (
\begin{DoxyParamCaption}
\item[{const {\bf M\-L\-Sampling\-Level\-Options} \&}]{curr\-Options, }
\item[{unsigned int \&}]{unified\-Requested\-Num\-Samples, }
\item[{{\bf Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{curr\-Chain, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ \&}]{curr\-Log\-Likelihood\-Values, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ \&}]{curr\-Log\-Target\-Values}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a0a2615d8f3627630d0cb62cb91614bd1}


Generates the sequence at the level 0. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em curr\-Options} & \\
\hline
\mbox{\tt out}  & {\em unified\-Requested\-Num\-Samples,curr\-Chain,curr\-Log\-Likelihood\-Values,curr\-Log\-Target\-Values} & \\
\hline
\end{DoxyParams}


Definition at line 2344 of file M\-L\-Sampling.\-C.



References L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-data\-Output\-Allowed\-Set, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-data\-Output\-File\-Name, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-filtered\-Chain\-Generate, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-initial\-Values\-Of\-Disabled\-Parameters, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-prefix, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-raw\-Chain\-Data\-Output\-File\-Name, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-raw\-Chain\-Data\-Output\-File\-Type, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-raw\-Chain\-Size, Q\-U\-E\-S\-O\-::\-Misc\-Get\-Ellapsed\-Seconds(), Q\-U\-E\-S\-O\-::\-File\-Ptr\-Set\-Struct\-::ofs\-Var, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-S\-U\-M, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-U\-N\-S\-I\-G\-N\-E\-D, Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::resize\-Sequence(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::resize\-Sequence(), Q\-U\-E\-S\-O\-::\-Base\-Vector\-Sequence$<$ V, M $>$\-::set\-Name(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::set\-Name(), Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::set\-Position\-Values(), Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::sub\-Sequence\-Size(), Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::unified\-Write\-Contents(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::unified\-Write\-Contents(), U\-Q\-\_\-\-F\-A\-T\-A\-L\-\_\-\-T\-E\-S\-T\-\_\-\-M\-A\-C\-R\-O, U\-Q\-\_\-\-F\-I\-L\-E\-\_\-\-E\-X\-T\-E\-N\-S\-I\-O\-N\-\_\-\-F\-O\-R\-\_\-\-M\-A\-T\-L\-A\-B\-\_\-\-F\-O\-R\-M\-A\-T, U\-Q\-\_\-\-M\-H\-\_\-\-S\-G\-\_\-\-F\-I\-L\-E\-N\-A\-M\-E\-\_\-\-F\-O\-R\-\_\-\-N\-O\-\_\-\-F\-I\-L\-E, and Q\-U\-E\-S\-O\-::\-U\-Q\-\_\-\-O\-K\-\_\-\-R\-C.


\begin{DoxyCode}
2350 \{
2351     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2352       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"KEY In MLSampling<P\_V,P\_M>::generateSequence()"}
2353                               << \textcolor{stringliteral}{": beginning level "}              << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2354                               << \textcolor{stringliteral}{", currOptions.m\_rawChainSize = "} << currOptions.m\_rawChainSize \textcolor{comment}{// Ok to
       use rawChainSize}
2355                               << std::endl;
2356     \}
2357 
2358     \textcolor{keywordtype}{int} iRC = \hyperlink{namespace_q_u_e_s_o_a8e909502900aecf24cedba022ea84471}{UQ\_OK\_RC};
2359     \textcolor{keyword}{struct }timeval timevalLevel;
2360     iRC = gettimeofday(&timevalLevel, NULL);
2361     \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
2362 
2363     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
2364       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} tmpSize = currOptions.m\_rawChainSize;
2365       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &tmpSize, (\textcolor{keywordtype}{void} *) &
      unifiedRequestedNumSamples, (\textcolor{keywordtype}{int}) 1, \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, \hyperlink{_mpi_comm_8h_afbf78d291c032aa7f512bc566cee2bd1}{RawValue\_MPI\_SUM},
2366                                    \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
2367                                    \textcolor{stringliteral}{"failed MPI.Allreduce() for requested num samples in level 0"});
2368     \}
2369     \textcolor{keywordflow}{else} \{
2370       unifiedRequestedNumSamples = currOptions.m\_rawChainSize;
2371     \}
2372 
2373     currChain.setName              (currOptions.m\_prefix + \textcolor{stringliteral}{"rawChain"}        );
2374     currLogLikelihoodValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a198b72423333bc5aa1722b830b64a263}{setName}(currOptions.m\_prefix + \textcolor{stringliteral}{"rawLogLikelihood"});
2375     currLogTargetValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a198b72423333bc5aa1722b830b64a263}{setName}    (currOptions.m\_prefix + \textcolor{stringliteral}{"rawLogTarget"}    );
2376 
2377     currChain.resizeSequence              (currOptions.m\_rawChainSize); \textcolor{comment}{// Ok to use rawChainSize}
2378     currLogLikelihoodValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a2aa8d77c39927060227275b12b6d3dd0}{resizeSequence}(currOptions.m\_rawChainSize); \textcolor{comment}{// Ok to use
       rawChainSize}
2379     currLogTargetValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a2aa8d77c39927060227275b12b6d3dd0}{resizeSequence}    (currOptions.m\_rawChainSize); \textcolor{comment}{// Ok to use
       rawChainSize}
2380 
2381     P\_V auxVec(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a92e963bb5cab3eecd290dfe4b8f03b04}{zeroVector}());
2382     ScalarFunctionSynchronizer<P\_V,P\_M> likelihoodSynchronizer(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ab08c3059d23460db49b229aa88bd4e70}{m\_likelihoodFunction},auxVec); \textcolor{comment}{// prudencio 2010-08-01}
2383     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < currChain.subSequenceSize(); ++i) \{
2384       \textcolor{comment}{//std::cout << "In QUESO: before prior realizer with i = " << i << std::endl;}
2385       \textcolor{keywordtype}{bool} outOfSupport = \textcolor{keyword}{true};
2386       \textcolor{keywordflow}{do} \{
2387 
2388         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aa45e9c06bd51cae0dc2294af1831c158}{m\_priorRv}.\hyperlink{class_q_u_e_s_o_1_1_base_vector_r_v_aea4b01eef0baf36944d14459a7b9ccf4}{realizer}().\hyperlink{class_q_u_e_s_o_1_1_base_vector_realizer_a6845173dd79a80ae11c86cde26e55817}{realization}(auxVec);  \textcolor{comment}{// gpmsa2}
2389         \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_afbe27e6149562020663b72da6592d933}{m\_numDisabledParameters} > 0) \{ \textcolor{comment}{// gpmsa2}
2390           \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} disabledCounter = 0;
2391           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} paramId = 0; paramId < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.
      \hyperlink{class_q_u_e_s_o_1_1_vector_space_a5829a1f4f996f8307c840b705144d666}{dimLocal}(); ++paramId) \{
2392             \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ac76690384f70d74b8662faf7a051449e}{m\_parameterEnabledStatus}[paramId] == \textcolor{keyword}{false}) \{
2393               auxVec[paramId] = currOptions.m\_initialValuesOfDisabledParameters[disabledCounter];
2394               disabledCounter++;
2395             \}
2396           \}
2397         \}
2398         auxVec.mpiBcast(0, \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}()); \textcolor{comment}{// prudencio 2010-08-01}
2399 
2400         outOfSupport = !(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a21525858e93a7d9654fdf68c8ac25576}{m\_targetDomain}->\hyperlink{class_q_u_e_s_o_1_1_vector_set_ab59fe6ca67647f58920681e05165a9d0}{contains}(auxVec));
2401       \} \textcolor{keywordflow}{while} (outOfSupport); \textcolor{comment}{// prudenci 2011-Oct-04}
2402 
2403       currChain.setPositionValues(i,auxVec);
2404       \textcolor{comment}{// KAUST: all nodes should call likelihood}
2405 \textcolor{preprocessor}{#if 1 // prudencio 2010-08-01}
2406 \textcolor{preprocessor}{}      currLogLikelihoodValues[i] = likelihoodSynchronizer.callFunction(&auxVec,NULL,NULL,NULL,NULL,NULL,
      NULL); \textcolor{comment}{// likelihood is important}
2407 \textcolor{preprocessor}{#else}
2408 \textcolor{preprocessor}{}      currLogLikelihoodValues[i] = \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ab08c3059d23460db49b229aa88bd4e70}{m\_likelihoodFunction}.
      \hyperlink{class_q_u_e_s_o_1_1_base_scalar_function_acf2f92adac2df2a0d750dc62cd3a4d0a}{lnValue}(auxVec,NULL,NULL,NULL,NULL); \textcolor{comment}{// likelihood is important}
2409 \textcolor{preprocessor}{#endif}
2410 \textcolor{preprocessor}{}      currLogTargetValues[i]     = \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aa45e9c06bd51cae0dc2294af1831c158}{m\_priorRv}.\hyperlink{class_q_u_e_s_o_1_1_base_vector_r_v_a3206740e05e0c64a88273029e963b185}{pdf}().\hyperlink{class_q_u_e_s_o_1_1_base_joint_pdf_aaeb1d91fd791399a502f451b07bb1bfe}{lnValue}(auxVec,NULL,NULL,NULL,NULL) +
       currLogLikelihoodValues[i];
2411       \textcolor{comment}{//std::cout << "In QUESO: currLogTargetValues[" << i << "] = " << currLogTargetValues[i] <<
       std::endl;}
2412     \}
2413 
2414     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{ \textcolor{comment}{// KAUST}
2415 \textcolor{preprocessor}{#ifdef QUESO\_USES\_SEQUENCE\_STATISTICAL\_OPTIONS}
2416 \textcolor{preprocessor}{}      \textcolor{keywordflow}{if} (currOptions.m\_rawChainComputeStats) \{
2417         FilePtrSetStruct filePtrSet;
2418         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ab8fe853074f12ea34e18724119a2fc75}{openOutputFile}(currOptions.m\_dataOutputFileName,
2419                              \hyperlink{_defines_8h_ac440026eff7deb1c1eed1eea0e8e36ba}{UQ\_FILE\_EXTENSION\_FOR\_MATLAB\_FORMAT}, \textcolor{comment}{//
       Yes, always ".m"}
2420                              currOptions.m\_dataOutputAllowedSet,
2421                              \textcolor{keyword}{false},
2422                              filePtrSet);
2423 
2424         \textcolor{comment}{//m\_env.syncPrintDebugMsg("At level 0, calling computeStatistics for
       chain",1,10,m\_env.inter0Comm()); // output debug}
2425         currChain.computeStatistics(*currOptions.m\_rawChainStatisticalOptionsObj,
2426                                     filePtrSet.ofsVar);
2427 
2428         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ab712bff194ddd91459d4ea8715c77e8b}{closeFile}(filePtrSet,
      \hyperlink{_defines_8h_ac440026eff7deb1c1eed1eea0e8e36ba}{UQ\_FILE\_EXTENSION\_FOR\_MATLAB\_FORMAT});
2429       \}
2430       \textcolor{comment}{// Compute MLE and MAP}
2431       \textcolor{comment}{// rr0}
2432 \textcolor{preprocessor}{#endif}
2433 \textcolor{preprocessor}{}      \textcolor{keywordflow}{if} (currOptions.m\_rawChainDataOutputFileName != 
      \hyperlink{_metropolis_hastings_s_g_options_8h_a75699ceb938d800e2b7f59ede3ea9a31}{UQ\_MH\_SG\_FILENAME\_FOR\_NO\_FILE}) \{
2434         currChain.unifiedWriteContents              (currOptions.m\_rawChainDataOutputFileName,
2435                                                      currOptions.m\_rawChainDataOutputFileType);
2436         currLogLikelihoodValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a2f832dd5eda37df06eb52650ab8ce733}{unifiedWriteContents}(currOptions.
      m\_rawChainDataOutputFileName,
2437                                                      currOptions.m\_rawChainDataOutputFileType);
2438         currLogTargetValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a2f832dd5eda37df06eb52650ab8ce733}{unifiedWriteContents}    (currOptions.
      m\_rawChainDataOutputFileName,
2439                                                      currOptions.m\_rawChainDataOutputFileType);
2440       \}
2441 
2442       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2443         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
2444                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2445                                 << \textcolor{stringliteral}{": finished generating "} << currChain.subSequenceSize()
2446                                 << \textcolor{stringliteral}{" chain positions"}
2447                                 << std::endl;
2448 
2449         \textcolor{comment}{//unsigned int numZeros = 0;}
2450         \textcolor{comment}{//for (unsigned int i = 0; i < currTargetValues.subSequenceSize(); ++i) \{}
2451         \textcolor{comment}{//  *m\_env.subDisplayFile() << "currTargetValues[" << i}
2452         \textcolor{comment}{//                          << "] = " << currTargetValues[i]}
2453         \textcolor{comment}{//                          << std::endl;}
2454         \textcolor{comment}{//  if (currTargetValues[i] == 0.) numZeros++;}
2455         \textcolor{comment}{//\}}
2456         \textcolor{comment}{//*m\_env.subDisplayFile() << "Number of zeros in currTargetValues = " << numZeros}
2457         \textcolor{comment}{//                        << std::endl;}
2458       \}
2459 
2460       \textcolor{keywordflow}{if} (currOptions.m\_filteredChainGenerate) \{
2461         \textcolor{comment}{// todo}
2462 \textcolor{preprocessor}{#ifdef QUESO\_USES\_SEQUENCE\_STATISTICAL\_OPTIONS}
2463 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} (currOptions.m\_filteredChainComputeStats) \{
2464           \textcolor{comment}{// todo}
2465 
2466           \textcolor{comment}{//currChain.computeStatistics(*currOptions.m\_filteredChainStatisticalOptionsObj,}
2467           \textcolor{comment}{//                            filePtrSet.ofsVar);}
2468         \}
2469         \textcolor{comment}{// Compute MLE and MAP}
2470         \textcolor{comment}{// rr0}
2471 \textcolor{preprocessor}{#endif}
2472 \textcolor{preprocessor}{}      \}
2473 
2474     \} \textcolor{comment}{// KAUST}
2475 
2476     \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}((currChain.subSequenceSize() != currOptions.m\_rawChainSize), \textcolor{comment}{//
       Ok to use rawChainSize}
2477                         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
2478                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
2479                         \textcolor{stringliteral}{"currChain (first one) has been generated with invalid size"});
2480 
2481     \textcolor{keywordtype}{double} levelRunTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalLevel);
2482     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2483       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
2484                               << \textcolor{stringliteral}{": ending level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2485                               << \textcolor{stringliteral}{", total level time = "} << levelRunTime << \textcolor{stringliteral}{" seconds"}
2486                               << std::endl;
2487     \}
2488 
2489   \textcolor{keywordflow}{return};
2490 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_aea8da13aed5b04e64b8490ca5f107889}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!generate\-Sequence\-\_\-\-Step01\-\_\-inter0@{generate\-Sequence\-\_\-\-Step01\-\_\-inter0}}
\index{generate\-Sequence\-\_\-\-Step01\-\_\-inter0@{generate\-Sequence\-\_\-\-Step01\-\_\-inter0}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{generate\-Sequence\-\_\-\-Step01\-\_\-inter0}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Sequence\-\_\-\-Step01\-\_\-inter0 (
\begin{DoxyParamCaption}
\item[{const {\bf M\-L\-Sampling\-Level\-Options} $\ast$}]{curr\-Options, }
\item[{unsigned int \&}]{unified\-Requested\-Num\-Samples}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_aea8da13aed5b04e64b8490ca5f107889}


Reads options for the M\-L algorithm (Step 01 from M\-L algorithm). 

This method is responsible for the Step 01 in the M\-L algorithm implemented/described in the method \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a8d7296b30623c73ada38971cae27994a}{M\-L\-Sampling$<$\-P\-\_\-\-V,\-P\-\_\-\-M$>$\-::generate\-Sequence}.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em curr\-Options} & \\
\hline
\mbox{\tt out}  & {\em unified\-Requested\-Num\-Samples} & \\
\hline
\end{DoxyParams}


Definition at line 2494 of file M\-L\-Sampling.\-C.



References L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-raw\-Chain\-Size, Q\-U\-E\-S\-O\-::\-Misc\-Get\-Ellapsed\-Seconds(), Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-S\-U\-M, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-U\-N\-S\-I\-G\-N\-E\-D, and Q\-U\-E\-S\-O\-::\-U\-Q\-\_\-\-O\-K\-\_\-\-R\-C.


\begin{DoxyCode}
2497 \{
2498   \textcolor{keywordtype}{int} iRC = \hyperlink{namespace_q_u_e_s_o_a8e909502900aecf24cedba022ea84471}{UQ\_OK\_RC};
2499   \textcolor{keyword}{struct }timeval timevalStep;
2500   iRC = gettimeofday(&timevalStep, NULL);
2501   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
2502 
2503       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2504         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
2505                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2506                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2507                                 << \textcolor{stringliteral}{": beginning step 1 of 11"}
2508                                 << std::endl;
2509       \}
2510 
2511       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} tmpSize = currOptions->m\_rawChainSize;
2512       \textcolor{comment}{// This computed 'unifiedRequestedNumSamples' needs to be recomputed only at the last}
2513       \textcolor{comment}{// level, when 'currOptions' is replaced by 'lastLevelOptions' (see step 3 of 11)}
2514       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &tmpSize, (\textcolor{keywordtype}{void} *) &
      unifiedRequestedNumSamples, (\textcolor{keywordtype}{int}) 1, \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, \hyperlink{_mpi_comm_8h_afbf78d291c032aa7f512bc566cee2bd1}{RawValue\_MPI\_SUM},
2515                                    \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
2516                                    \textcolor{stringliteral}{"failed MPI.Allreduce() for requested num samples in step 1"});
2517 
2518       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2519         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"KEY In MLSampling<P\_V,P\_M>::generateSequence()"}
2520                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2521                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2522                                 << \textcolor{stringliteral}{", currOptions->m\_rawChainSize = "} << currOptions->m\_rawChainSize \textcolor{comment}{// Ok
       to use rawChainSize}
2523                                 << std::endl;
2524       \}
2525 
2526   \textcolor{keywordtype}{double} stepRunTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalStep);
2527   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2528     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving MLSampling<P\_V,P\_M>::generateSequence\_Step()"}
2529                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2530                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2531                             << \textcolor{stringliteral}{", after "} << stepRunTime << \textcolor{stringliteral}{" seconds"}
2532                             << std::endl;
2533   \}
2534 
2535   \textcolor{keywordflow}{return};
2536 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a06c37730b943a1838d58475d322639b9}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!generate\-Sequence\-\_\-\-Step02\-\_\-inter0@{generate\-Sequence\-\_\-\-Step02\-\_\-inter0}}
\index{generate\-Sequence\-\_\-\-Step02\-\_\-inter0@{generate\-Sequence\-\_\-\-Step02\-\_\-inter0}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{generate\-Sequence\-\_\-\-Step02\-\_\-inter0}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Sequence\-\_\-\-Step02\-\_\-inter0 (
\begin{DoxyParamCaption}
\item[{const {\bf M\-L\-Sampling\-Level\-Options} $\ast$}]{curr\-Options, }
\item[{{\bf Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{curr\-Chain, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ \&}]{curr\-Log\-Likelihood\-Values, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ \&}]{curr\-Log\-Target\-Values, }
\item[{{\bf Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{prev\-Chain, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ \&}]{prev\-Log\-Likelihood\-Values, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ \&}]{prev\-Log\-Target\-Values, }
\item[{unsigned int \&}]{index\-Of\-First\-Weight, }
\item[{unsigned int \&}]{index\-Of\-Last\-Weight}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a06c37730b943a1838d58475d322639b9}


Saves chain and corresponding target pdf values from previous level (Step 02 from M\-L algorithm). 

This method is responsible for the Step 02 in the M\-L algorithm implemented/described in the method \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a8d7296b30623c73ada38971cae27994a}{M\-L\-Sampling$<$\-P\-\_\-\-V,\-P\-\_\-\-M$>$\-::generate\-Sequence}.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em curr\-Options} & \\
\hline
\mbox{\tt in,out}  & {\em curr\-Chain,curr\-Log\-Likelihood\-Values,curr\-Log\-Target\-Values} & \\
\hline
\mbox{\tt out}  & {\em prev\-Chain,prev\-Log\-Likelihood\-Values,prev\-Log\-Target\-Values,index\-Of\-First\-Weight,index\-Of\-Last\-Weight} & \\
\hline
\end{DoxyParams}


Definition at line 2540 of file M\-L\-Sampling.\-C.



References Q\-U\-E\-S\-O\-::\-Base\-Vector\-Sequence$<$ V, M $>$\-::clear(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::clear(), Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::get\-Position\-Values(), L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-prefix, Q\-U\-E\-S\-O\-::\-Misc\-Get\-Ellapsed\-Seconds(), Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-U\-N\-S\-I\-G\-N\-E\-D, Q\-U\-E\-S\-O\-::\-Base\-Vector\-Sequence$<$ V, M $>$\-::set\-Name(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::set\-Name(), Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::sub\-Sequence\-Size(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::sub\-Sequence\-Size(), Q\-U\-E\-S\-O\-::\-Base\-Vector\-Sequence$<$ V, M $>$\-::unified\-Sequence\-Size(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::unified\-Sequence\-Size(), U\-Q\-\_\-\-F\-A\-T\-A\-L\-\_\-\-T\-E\-S\-T\-\_\-\-M\-A\-C\-R\-O, and Q\-U\-E\-S\-O\-::\-U\-Q\-\_\-\-O\-K\-\_\-\-R\-C.


\begin{DoxyCode}
2550 \{
2551   \textcolor{keywordtype}{int} iRC = \hyperlink{namespace_q_u_e_s_o_a8e909502900aecf24cedba022ea84471}{UQ\_OK\_RC};
2552   \textcolor{keyword}{struct }timeval timevalStep;
2553   iRC = gettimeofday(&timevalStep, NULL);
2554   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
2555 
2556       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2557         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
2558                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2559                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2560                                 << \textcolor{stringliteral}{": beginning step 2 of 11"}
2561                                 << std::endl;
2562       \}
2563 
2564       prevChain = currChain;
2565       currChain.clear();
2566       currChain.setName(currOptions->m\_prefix + \textcolor{stringliteral}{"rawChain"});
2567 
2568       prevLogLikelihoodValues = currLogLikelihoodValues; \textcolor{comment}{// likelihood is important}
2569       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2570         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence\_Step()"}
2571                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2572                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2573                                 << \textcolor{stringliteral}{", prevLogLikelihoodValues[0] = "} << prevLogLikelihoodValues[0]
2574                                 << std::endl;
2575       \}
2576       prevLogTargetValues     = currLogTargetValues;
2577 
2578       currLogLikelihoodValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_aa5449ca2f03f5e6025d35804bee19ee0}{clear}();
2579       currLogLikelihoodValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a198b72423333bc5aa1722b830b64a263}{setName}(currOptions->m\_prefix + \textcolor{stringliteral}{"rawLogLikelihood"});
2580 
2581       currLogTargetValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_aa5449ca2f03f5e6025d35804bee19ee0}{clear}();
2582       currLogTargetValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a198b72423333bc5aa1722b830b64a263}{setName}(currOptions->m\_prefix + \textcolor{stringliteral}{"rawLogTarget"});
2583 
2584 \textcolor{preprocessor}{#if 0 // For debug only}
2585 \textcolor{preprocessor}{}      \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2586         P\_V prevPosition(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a92e963bb5cab3eecd290dfe4b8f03b04}{zeroVector}());
2587         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
2588                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2589                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2590                                 << \textcolor{stringliteral}{":"}
2591                                 << std::endl;
2592         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < prevChain.subSequenceSize(); ++i) \{
2593           prevChain.getPositionValues(i,prevPosition);
2594           *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"  prevChain["} << i
2595                                   << \textcolor{stringliteral}{"] = "} << prevPosition
2596                                   << \textcolor{stringliteral}{", prevLogLikelihoodValues["} << i
2597                                   << \textcolor{stringliteral}{"] = "} << prevLogLikelihoodValues[i]
2598                                   << \textcolor{stringliteral}{", prevLogTargetValues["} << i
2599                                   << \textcolor{stringliteral}{"] = "} << prevLogTargetValues[i]
2600                                   << std::endl;
2601         \}
2602       \}
2603 \textcolor{preprocessor}{#endif}
2604 \textcolor{preprocessor}{}
2605       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} quantity1 = prevChain.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a52829afc95e5c36e9db44f40854153b0}{unifiedSequenceSize}();
2606       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} quantity2 = currChain.unifiedSequenceSize();
2607       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} quantity3 = prevLogLikelihoodValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a52829afc95e5c36e9db44f40854153b0}{unifiedSequenceSize}(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1);
2608       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} quantity4 = currLogLikelihoodValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a52829afc95e5c36e9db44f40854153b0}{unifiedSequenceSize}(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1);
2609       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} quantity5 = prevLogTargetValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a52829afc95e5c36e9db44f40854153b0}{unifiedSequenceSize}(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1);
2610       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} quantity6 = currLogTargetValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a52829afc95e5c36e9db44f40854153b0}{unifiedSequenceSize}(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1);
2611       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2612         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
2613                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2614                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2615                                 << \textcolor{stringliteral}{": prevChain.unifiedSequenceSize() = "} << quantity1
2616                                 << \textcolor{stringliteral}{", currChain.unifiedSequenceSize() = "} << quantity2
2617                                 << \textcolor{stringliteral}{", prevLogLikelihoodValues.unifiedSequenceSize() = "} << quantity3
2618                                 << \textcolor{stringliteral}{", currLogLikelihoodValues.unifiedSequenceSize() = "} << quantity4
2619                                 << \textcolor{stringliteral}{", prevLogTargetValues.unifiedSequenceSize() = "} << quantity5
2620                                 << \textcolor{stringliteral}{", currLogTargetValues.unifiedSequenceSize() = "} << quantity6
2621                                 << std::endl;
2622       \}
2623 
2624       \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}((prevChain.subSequenceSize() != prevLogLikelihoodValues.
      \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a0288ea295eedc216a1617b3286f6f3a0}{subSequenceSize}()),
2625                           \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
2626                           \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
2627                           \textcolor{stringliteral}{"different sizes between previous chain and previous sequence of likelihood
       values"});
2628 
2629       \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}((prevChain.subSequenceSize() != prevLogTargetValues.
      \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a0288ea295eedc216a1617b3286f6f3a0}{subSequenceSize}()),
2630                           \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
2631                           \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
2632                           \textcolor{stringliteral}{"different sizes between previous chain and previous sequence of target values"});
2633 
2634       \textcolor{comment}{// Set 'indexOfFirstWeight' and 'indexOfLastWeight' // KAUST}
2635       indexOfFirstWeight = 0;
2636       indexOfLastWeight  = indexOfFirstWeight + prevChain.subSequenceSize()-1;
2637       \{
2638         \textcolor{comment}{//std::cout << "m\_env.inter0Comm().NumProc() = " << m\_env.inter0Comm().NumProc() << std::endl;}
2639         \textcolor{keywordtype}{int} r = \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}();
2640         \textcolor{comment}{//std::cout << "r = " << r << std::endl;}
2641         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
2642         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} auxUint = 0;
2643         \textcolor{keywordflow}{if} (r > 0) \{
2644           \hyperlink{namespace_q_u_e_s_o_af3c313103c6396188748a1d534577ff7}{RawType\_MPI\_Status} status;
2645     \textcolor{comment}{//std::cout << "Rank " << r << " is entering MPI\_Recv()" << std::endl;}
2646           \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a12d7a87a4407e442c35a17d3caaf46c1}{Recv}((\textcolor{keywordtype}{void}*) &auxUint, 1, 
      \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, r-1, r-1, &status,
2647                                   \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
2648                                   \textcolor{stringliteral}{"failed MPI.Recv()"});
2649     \textcolor{comment}{//std::cout << "Rank " << r << " received auxUint = " << auxUint << std::endl;}
2650           indexOfFirstWeight = auxUint;
2651           indexOfLastWeight = indexOfFirstWeight + prevChain.subSequenceSize()-1;
2652         \}
2653         \textcolor{keywordflow}{if} (r < (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_aa780721ae0fdeabc5a15e04cb0cad964}{NumProc}()-1)) \{
2654           auxUint = indexOfLastWeight + 1;
2655     \textcolor{comment}{//std::cout << "Rank " << r << " is sending auxUint = " << auxUint << std::endl;}
2656           \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a1ecdbeac992a2ab1ff12e45e0c1b53b4}{Send}((\textcolor{keywordtype}{void}*) &auxUint, 1, 
      \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, r+1, r,
2657                                   \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
2658                                   \textcolor{stringliteral}{"failed MPI.Send()"});
2659     \textcolor{comment}{//std::cout << "Rank " << r << " sent auxUint = " << auxUint << std::endl;}
2660         \}
2661         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
2662       \}
2663 
2664   \textcolor{keywordtype}{double} stepRunTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalStep);
2665   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2666     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving MLSampling<P\_V,P\_M>::generateSequence\_Step()"}
2667                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2668                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2669                             << \textcolor{stringliteral}{", after "} << stepRunTime << \textcolor{stringliteral}{" seconds"}
2670                             << std::endl;
2671   \}
2672 
2673   \textcolor{keywordflow}{return};
2674 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_ae53e6bc0ec5d1f3d3ac9df268086cd75}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!generate\-Sequence\-\_\-\-Step03\-\_\-inter0@{generate\-Sequence\-\_\-\-Step03\-\_\-inter0}}
\index{generate\-Sequence\-\_\-\-Step03\-\_\-inter0@{generate\-Sequence\-\_\-\-Step03\-\_\-inter0}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{generate\-Sequence\-\_\-\-Step03\-\_\-inter0}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Sequence\-\_\-\-Step03\-\_\-inter0 (
\begin{DoxyParamCaption}
\item[{const {\bf M\-L\-Sampling\-Level\-Options} $\ast$}]{curr\-Options, }
\item[{const {\bf Scalar\-Sequence}$<$ double $>$ \&}]{prev\-Log\-Likelihood\-Values, }
\item[{double}]{prev\-Exponent, }
\item[{double}]{failed\-Exponent, }
\item[{double \&}]{curr\-Exponent, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ \&}]{weight\-Sequence}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_ae53e6bc0ec5d1f3d3ac9df268086cd75}


Computes {\ttfamily curr\-Exponent} and sequence of weights for current level and update 'm\-\_\-log\-Evidence\-Factors' (Step 03 from M\-L algorithm). 

This method is responsible for the Step 03 in the M\-L algorithm implemented/described in the method \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a8d7296b30623c73ada38971cae27994a}{M\-L\-Sampling$<$\-P\-\_\-\-V,\-P\-\_\-\-M$>$\-::generate\-Sequence}.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em curr\-Options,prev\-Log\-Likelihood\-Values,prev\-Exponent,failed\-Exponent} & \\
\hline
\mbox{\tt out}  & {\em curr\-Exponent,weight\-Sequence} & \\
\hline
\end{DoxyParams}


Definition at line 2678 of file M\-L\-Sampling.\-C.



References L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-max\-Effective\-Size\-Ratio, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-min\-Effective\-Size\-Ratio, Q\-U\-E\-S\-O\-::\-Misc\-Check\-For\-Same\-Value\-In\-All\-Nodes(), Q\-U\-E\-S\-O\-::\-Misc\-Get\-Ellapsed\-Seconds(), Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-D\-O\-U\-B\-L\-E, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-S\-U\-M, Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::sub\-Sequence\-Size(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::unified\-Max\-Plain(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::unified\-Sequence\-Size(), U\-Q\-\_\-\-F\-A\-T\-A\-L\-\_\-\-T\-E\-S\-T\-\_\-\-M\-A\-C\-R\-O, and Q\-U\-E\-S\-O\-::\-U\-Q\-\_\-\-O\-K\-\_\-\-R\-C.


\begin{DoxyCode}
2685 \{
2686   \textcolor{keywordtype}{int} iRC = \hyperlink{namespace_q_u_e_s_o_a8e909502900aecf24cedba022ea84471}{UQ\_OK\_RC};
2687   \textcolor{keyword}{struct }timeval timevalStep;
2688   iRC = gettimeofday(&timevalStep, NULL);
2689   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
2690 
2691       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2692         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
2693                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2694                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2695                                 << \textcolor{stringliteral}{", failedExponent = "} << failedExponent \textcolor{comment}{// gpmsa1}
2696                                 << \textcolor{stringliteral}{": beginning step 3 of 11"}
2697                                 << std::endl;
2698       \}
2699 
2700       std::vector<double> exponents(2,0.);
2701       exponents[0] = prevExponent;
2702       exponents[1] = 1.;
2703 
2704       \textcolor{keywordtype}{double} nowExponent = 1.; \textcolor{comment}{// Try '1.' right away}
2705       \textcolor{keywordtype}{double} nowEffectiveSizeRatio = 0.; \textcolor{comment}{// To be computed}
2706 
2707       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nowAttempt = 0;
2708       \textcolor{keywordtype}{bool} testResult = \textcolor{keyword}{false};
2709       \textcolor{keywordtype}{double} meanEffectiveSizeRatio = .5*(currOptions->m\_minEffectiveSizeRatio + currOptions->
      m\_maxEffectiveSizeRatio);
2710       ScalarSequence<double> omegaLnDiffSequence(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env},prevLogLikelihoodValues.
      \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a0288ea295eedc216a1617b3286f6f3a0}{subSequenceSize}(),\textcolor{stringliteral}{""});
2711 
2712       \textcolor{keywordtype}{double} nowUnifiedEvidenceLnFactor = 0.;
2713       \textcolor{keywordflow}{do} \{
2714         \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2715           *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
2716                                   << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2717                                   << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2718                                   << \textcolor{stringliteral}{", failedExponent = "} << failedExponent \textcolor{comment}{// gpmsa1}
2719                                   << \textcolor{stringliteral}{": entering loop for computing next exponent"}
2720                                   << \textcolor{stringliteral}{", with nowAttempt = "} << nowAttempt
2721                                   << std::endl;
2722         \}
2723 
2724         \textcolor{keywordflow}{if} (failedExponent > 0.) \{ \textcolor{comment}{// gpmsa1}
2725           nowExponent = .5*(prevExponent+failedExponent);
2726         \}
2727         \textcolor{keywordflow}{else} \{
2728           \textcolor{keywordflow}{if} (nowAttempt > 0) \{
2729             \textcolor{keywordflow}{if} (nowEffectiveSizeRatio > meanEffectiveSizeRatio) \{
2730               exponents[0] = nowExponent;
2731             \}
2732             \textcolor{keywordflow}{else} \{
2733               exponents[1] = nowExponent;
2734             \}
2735             nowExponent = .5*(exponents[0] + exponents[1]);
2736           \}
2737         \}
2738         \textcolor{keywordtype}{double} auxExponent = nowExponent;
2739         \textcolor{keywordflow}{if} (prevExponent != 0.) \{
2740           auxExponent /= prevExponent;
2741           auxExponent -= 1.;
2742         \}
2743         \textcolor{keywordtype}{double} subWeightRatioSum     = 0.;
2744         \textcolor{keywordtype}{double} unifiedWeightRatioSum = 0.;
2745 
2746         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < weightSequence.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a0288ea295eedc216a1617b3286f6f3a0}{subSequenceSize}(); ++i) \{
2747           omegaLnDiffSequence[i] = prevLogLikelihoodValues[i]*auxExponent; \textcolor{comment}{// likelihood is important}
2748         \}
2749 
2750 \textcolor{preprocessor}{#if 1 // prudenci-2012-07-06}
2751 \textcolor{preprocessor}{}      \textcolor{comment}{//double unifiedOmegaLnMin = omegaLnDiffSequence.unifiedMinPlain(m\_vectorSpace.numOfProcsForStorage()
       == 1);}
2752         \textcolor{keywordtype}{double} unifiedOmegaLnMax = omegaLnDiffSequence.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a70dd5db8c036d364ac56e3cb9c2c7d04}{unifiedMaxPlain}(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1);
2753 \textcolor{preprocessor}{#else}
2754 \textcolor{preprocessor}{}        \textcolor{keywordtype}{double} unifiedOmegaLnMin = 0.;
2755         \textcolor{keywordtype}{double} unifiedOmegaLnMax = 0.;
2756         omegaLnDiffSequence.unifiedMinMaxExtra(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.
      \hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1, \textcolor{comment}{// KAUST3}
2757                                                0,
2758                                                omegaLnDiffSequence.subSequenceSize(),
2759                                                unifiedOmegaLnMin,
2760                                                unifiedOmegaLnMax);
2761 \textcolor{preprocessor}{#endif}
2762 \textcolor{preprocessor}{}        \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < weightSequence.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a0288ea295eedc216a1617b3286f6f3a0}{subSequenceSize}(); ++i) \{
2763           omegaLnDiffSequence[i] -= unifiedOmegaLnMax;
2764           weightSequence[i] = exp(omegaLnDiffSequence[i]);
2765           subWeightRatioSum += weightSequence[i];
2766 \textcolor{preprocessor}{#if 0 // For debug only}
2767 \textcolor{preprocessor}{}          \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel} == 1) && (nowAttempt == 6))  \{
2768             \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 99)) \{
2769               *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
2770                                       << \textcolor{stringliteral}{", level "}                        << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2771                                       << \textcolor{stringliteral}{", step "}                         << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2772                                       << \textcolor{stringliteral}{", i = "}                          << i
2773                                       << \textcolor{stringliteral}{", prevLogLikelihoodValues[i] = "} << prevLogLikelihoodValues[i]
2774                                       << \textcolor{stringliteral}{", omegaLnDiffSequence[i] = "}     << omegaLnDiffSequence[i]
2775                                       << \textcolor{stringliteral}{", weightSequence[i] = "}          << weightSequence[i]
2776     \textcolor{comment}{//<< ", subWeightRatioSum = "          << subWeightRatioSum}
2777                                       << std::endl;
2778             \}
2779           \}
2780 \textcolor{preprocessor}{#endif}
2781 \textcolor{preprocessor}{}        \}
2782         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &subWeightRatioSum, (\textcolor{keywordtype}{void} *) &
      unifiedWeightRatioSum, (\textcolor{keywordtype}{int}) 1, \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, \hyperlink{_mpi_comm_8h_afbf78d291c032aa7f512bc566cee2bd1}{RawValue\_MPI\_SUM},
2783                                      \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
2784                                      \textcolor{stringliteral}{"failed MPI.Allreduce() for weight ratio sum"});
2785 
2786         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} auxQuantity = weightSequence.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a52829afc95e5c36e9db44f40854153b0}{unifiedSequenceSize}(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1);
2787         nowUnifiedEvidenceLnFactor = log(unifiedWeightRatioSum) + unifiedOmegaLnMax - log(auxQuantity);
2788 
2789         \textcolor{keywordtype}{double} effectiveSampleSize = 0.;
2790         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < weightSequence.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a0288ea295eedc216a1617b3286f6f3a0}{subSequenceSize}(); ++i) \{
2791           weightSequence[i] /= unifiedWeightRatioSum;
2792           effectiveSampleSize += weightSequence[i]*weightSequence[i];
2793           \textcolor{comment}{//if ((m\_env.subDisplayFile()) && (m\_env.displayVerbosity() >= 0)) \{}
2794           \textcolor{comment}{//  *m\_env.subDisplayFile() << "In MLSampling<P\_V,P\_M>::generateSequence()"}
2795           \textcolor{comment}{//                          << ", level "                 << m\_currLevel+LEVEL\_REF\_ID}
2796           \textcolor{comment}{//                          << ", step "                  << m\_currStep}
2797           \textcolor{comment}{//                          << ": i = "                   << i}
2798           \textcolor{comment}{//                          << ", effectiveSampleSize = " << effectiveSampleSize}
2799           \textcolor{comment}{//                          << std::endl;}
2800           \textcolor{comment}{//\}}
2801         \}
2802 
2803         \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2804           *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
2805                                   << \textcolor{stringliteral}{", level "}                                  << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2806                                   << \textcolor{stringliteral}{", step "}                                   << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2807                                   << \textcolor{stringliteral}{": nowAttempt = "}                           << nowAttempt
2808                                   << \textcolor{stringliteral}{", prevExponent = "}                         << prevExponent
2809                                   << \textcolor{stringliteral}{", exponents[0] = "}                         << exponents[0]
2810                                   << \textcolor{stringliteral}{", nowExponent = "}                          << nowExponent
2811                                   << \textcolor{stringliteral}{", exponents[1] = "}                         << exponents[1]
2812                                   << \textcolor{stringliteral}{", subWeightRatioSum = "}                    << subWeightRatioSum
2813                                   << \textcolor{stringliteral}{", unifiedWeightRatioSum = "}                << unifiedWeightRatioSum
2814                                   << \textcolor{stringliteral}{", unifiedOmegaLnMax = "}                    << unifiedOmegaLnMax
2815                                   << \textcolor{stringliteral}{", weightSequence.unifiedSequenceSize() = "} << auxQuantity
2816                                   << \textcolor{stringliteral}{", nowUnifiedEvidenceLnFactor = "}           << 
      nowUnifiedEvidenceLnFactor
2817                                   << \textcolor{stringliteral}{", effectiveSampleSize = "}                  << effectiveSampleSize
2818                                   << std::endl;
2819         \}
2820 
2821 \textcolor{preprocessor}{#if 0 // For debug only}
2822 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2823           *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
2824                                   << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2825                                   << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2826                                   << \textcolor{stringliteral}{":"}
2827                                   << std::endl;
2828         \}
2829         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < weightSequence.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a0288ea295eedc216a1617b3286f6f3a0}{subSequenceSize}(); ++i) \{
2830           \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2831             *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"  weightSequence["} << i
2832                                     << \textcolor{stringliteral}{"] = "}              << weightSequence[i]
2833                                     << std::endl;
2834           \}
2835         \}
2836 \textcolor{preprocessor}{#endif}
2837 \textcolor{preprocessor}{}
2838         \textcolor{keywordtype}{double} subQuantity = effectiveSampleSize;
2839         effectiveSampleSize = 0.;
2840         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &subQuantity, (\textcolor{keywordtype}{void} *) &
      effectiveSampleSize, (\textcolor{keywordtype}{int}) 1, \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, \hyperlink{_mpi_comm_8h_afbf78d291c032aa7f512bc566cee2bd1}{RawValue\_MPI\_SUM},
2841                                      \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
2842                                      \textcolor{stringliteral}{"failed MPI.Allreduce() for effective sample size"});
2843 
2844         effectiveSampleSize = 1./effectiveSampleSize;
2845         nowEffectiveSizeRatio = effectiveSampleSize/((double) weightSequence.
      \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a52829afc95e5c36e9db44f40854153b0}{unifiedSequenceSize}(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.
      \hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1));
2846         \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}((nowEffectiveSizeRatio > (1.+1.e-8)),
2847                             \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
2848                             \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
2849                             \textcolor{stringliteral}{"effective sample size ratio cannot be > 1"});
2850         \textcolor{comment}{//UQ\_FATAL\_TEST\_MACRO((nowEffectiveSizeRatio < (1.-1.e-8)),}
2851         \textcolor{comment}{//                    m\_env.worldRank(),}
2852         \textcolor{comment}{//                    "MLSampling<P\_V,P\_M>::generateSequence()",}
2853         \textcolor{comment}{//                    "effective sample size ratio cannot be < 1");}
2854 
2855         \textcolor{keywordflow}{if} (failedExponent > 0.) \{ \textcolor{comment}{// gpmsa1}
2856           testResult = \textcolor{keyword}{true};
2857         \}
2858         \textcolor{keywordflow}{else} \{
2859           \textcolor{comment}{//bool aux1 = (nowEffectiveSizeRatio == meanEffectiveSizeRatio);}
2860           \textcolor{keywordtype}{bool} aux2 = (nowExponent == 1.                             )
2861                       &&
2862                       (nowEffectiveSizeRatio > meanEffectiveSizeRatio);
2863           \textcolor{keywordtype}{bool} aux3 = (nowEffectiveSizeRatio >= currOptions->m\_minEffectiveSizeRatio)
2864                       &&
2865                       (nowEffectiveSizeRatio <= currOptions->m\_maxEffectiveSizeRatio);
2866           testResult = aux2 || aux3;
2867         \}
2868 
2869         \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2870           *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
2871                                   << \textcolor{stringliteral}{", level "}                   << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2872                                   << \textcolor{stringliteral}{", step "}                    << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2873                                   << \textcolor{stringliteral}{": nowAttempt = "}            << nowAttempt
2874                                   << \textcolor{stringliteral}{", prevExponent = "}          << prevExponent
2875                                   << \textcolor{stringliteral}{", failedExponent = "}        << failedExponent \textcolor{comment}{// gpmsa1}
2876                                   << \textcolor{stringliteral}{", exponents[0] = "}          << exponents[0]
2877                                   << \textcolor{stringliteral}{", nowExponent = "}           << nowExponent
2878                                   << \textcolor{stringliteral}{", exponents[1] = "}          << exponents[1]
2879                                   << \textcolor{stringliteral}{", effectiveSampleSize = "}   << effectiveSampleSize
2880                                   << \textcolor{stringliteral}{", weightSequenceSize = "}    << weightSequence.
      \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a0288ea295eedc216a1617b3286f6f3a0}{subSequenceSize}()
2881                                   << \textcolor{stringliteral}{", minEffectiveSizeRatio = "} << currOptions->m\_minEffectiveSizeRatio
2882                                   << \textcolor{stringliteral}{", nowEffectiveSizeRatio = "} << nowEffectiveSizeRatio
2883                                   << \textcolor{stringliteral}{", maxEffectiveSizeRatio = "} << currOptions->m\_maxEffectiveSizeRatio
2884       \textcolor{comment}{//<< ", aux2 = "                  << aux2}
2885       \textcolor{comment}{//<< ", aux3 = "                  << aux3}
2886                                   << \textcolor{stringliteral}{", testResult = "}            << testResult
2887                                   << std::endl;
2888         \}
2889         nowAttempt++;
2890 
2891         \textcolor{comment}{// Make sure all nodes in 'inter0Comm' have the same value of 'nowExponent'}
2892         \textcolor{keywordflow}{if} (\hyperlink{namespace_q_u_e_s_o_a4166a375c5adbea35afaaf20775bc519}{MiscCheckForSameValueInAllNodes}(nowExponent,
2893                                               0., \textcolor{comment}{// kept 'zero' on 2010/03/05}
2894                                               \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}(),
2895                                               \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence(), step 3, nowExponent
      "}) == \textcolor{keyword}{false}) \{
2896           \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2897             *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"WARNING, In
       MLSampling<P\_V,P\_M>::generateSequence()"}
2898                                     << \textcolor{stringliteral}{", level "}        << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2899                                     << \textcolor{stringliteral}{", step "}         << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2900                                     << \textcolor{stringliteral}{": nowAttempt = "} << nowAttempt
2901                                     << \textcolor{stringliteral}{", MiscCheck for 'nowExponent' detected a problem"}
2902                                     << std::endl;
2903           \}
2904         \}
2905 
2906         \textcolor{comment}{// Make sure all nodes in 'inter0Comm' have the same value of 'testResult'}
2907         \textcolor{keywordflow}{if} (\hyperlink{namespace_q_u_e_s_o_a4166a375c5adbea35afaaf20775bc519}{MiscCheckForSameValueInAllNodes}(testResult,
2908                                               0., \textcolor{comment}{// kept 'zero' on 2010/03/05}
2909                                               \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}(),
2910                                               \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence(), step 3, testResult"}
      ) == \textcolor{keyword}{false}) \{
2911           \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2912             *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"WARNING, In
       MLSampling<P\_V,P\_M>::generateSequence()"}
2913                                     << \textcolor{stringliteral}{", level "}        << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2914                                     << \textcolor{stringliteral}{", step "}         << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2915                                     << \textcolor{stringliteral}{": nowAttempt = "} << nowAttempt
2916                                     << \textcolor{stringliteral}{", MiscCheck for 'testResult' detected a problem"}
2917                                     << std::endl;
2918           \}
2919         \}
2920       \} \textcolor{keywordflow}{while} (testResult == \textcolor{keyword}{false});
2921       currExponent = nowExponent;
2922       \textcolor{keywordflow}{if} (failedExponent > 0.) \{ \textcolor{comment}{// gpmsa1}
2923         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}[\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.size()-1] = 
      nowUnifiedEvidenceLnFactor;
2924       \}
2925       \textcolor{keywordflow}{else} \{
2926         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.push\_back(nowUnifiedEvidenceLnFactor); \textcolor{comment}{// restart}
2927       \}
2928 
2929       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} quantity1 = weightSequence.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a52829afc95e5c36e9db44f40854153b0}{unifiedSequenceSize}(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1);
2930       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2931         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
2932                                 << \textcolor{stringliteral}{", level "}                                  << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2933                                 << \textcolor{stringliteral}{", step "}                                   << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2934                                 << \textcolor{stringliteral}{": weightSequence.subSequenceSize() = "}     << weightSequence.
      \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a0288ea295eedc216a1617b3286f6f3a0}{subSequenceSize}()
2935                                 << \textcolor{stringliteral}{", weightSequence.unifiedSequenceSize() = "} << quantity1
2936                                 << \textcolor{stringliteral}{", failedExponent = "}                       << failedExponent \textcolor{comment}{// gpmsa1}
2937                                 << \textcolor{stringliteral}{", currExponent = "}                         << currExponent
2938                                 << \textcolor{stringliteral}{", effective ratio = "}                      << nowEffectiveSizeRatio
2939                                 << \textcolor{stringliteral}{", log(evidence factor) = "}                 << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}[\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.size()-1]
2940                                 << \textcolor{stringliteral}{", evidence factor = "}                      << exp(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}[\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.size()-1])
2941                                 << std::endl;
2942 
2943         \textcolor{comment}{//unsigned int numZeros = 0;}
2944         \textcolor{comment}{//for (unsigned int i = 0; i < weightSequence.subSequenceSize(); ++i) \{}
2945         \textcolor{comment}{//  *m\_env.subDisplayFile() << "weightSequence[" << i}
2946         \textcolor{comment}{//                          << "] = " << weightSequence[i]}
2947         \textcolor{comment}{//                         << std::endl;}
2948         \textcolor{comment}{//  if (weightSequence[i] == 0.) numZeros++;}
2949         \textcolor{comment}{//\}}
2950         \textcolor{comment}{//*m\_env.subDisplayFile() << "Number of zeros in weightSequence = " << numZeros}
2951         \textcolor{comment}{//                        << std::endl;}
2952       \}
2953 
2954       \textcolor{comment}{// Make sure all nodes in 'inter0Comm' have the same value of 'logEvidenceFactor'}
2955       \textcolor{keywordflow}{if} (\hyperlink{namespace_q_u_e_s_o_a4166a375c5adbea35afaaf20775bc519}{MiscCheckForSameValueInAllNodes}(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}[\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.size()-1],
2956                                             3.0e-16, \textcolor{comment}{// changed from 'zero' on 2010/03/03}
2957                                             \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}(),
2958                                             \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence(), step 3,
       logEvidenceFactor"}) == \textcolor{keyword}{false}) \{
2959         \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2960           *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"WARNING, In
       MLSampling<P\_V,P\_M>::generateSequence()"}
2961                                   << \textcolor{stringliteral}{", level "}        << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2962                                   << \textcolor{stringliteral}{", step "}         << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2963                                   << \textcolor{stringliteral}{", failedExponent = "} << failedExponent \textcolor{comment}{// gpmsa1}
2964                                   << \textcolor{stringliteral}{": nowAttempt = "} << nowAttempt
2965                                   << \textcolor{stringliteral}{", MiscCheck for 'logEvidenceFactor' detected a problem"}
2966                                   << std::endl;
2967         \}
2968       \}
2969 
2970   \textcolor{keywordtype}{double} stepRunTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalStep);
2971   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2972     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving MLSampling<P\_V,P\_M>::generateSequence\_Step()"}
2973                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2974                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2975                             << \textcolor{stringliteral}{", failedExponent = "} << failedExponent \textcolor{comment}{// gpmsa}
2976                             << \textcolor{stringliteral}{", after "} << stepRunTime << \textcolor{stringliteral}{" seconds"}
2977                             << std::endl;
2978   \}
2979 
2980   \textcolor{keywordflow}{return};
2981 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a955fb446652327edbc275e3d9145e2db}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!generate\-Sequence\-\_\-\-Step04\-\_\-inter0@{generate\-Sequence\-\_\-\-Step04\-\_\-inter0}}
\index{generate\-Sequence\-\_\-\-Step04\-\_\-inter0@{generate\-Sequence\-\_\-\-Step04\-\_\-inter0}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{generate\-Sequence\-\_\-\-Step04\-\_\-inter0}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Sequence\-\_\-\-Step04\-\_\-inter0 (
\begin{DoxyParamCaption}
\item[{const {\bf Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{prev\-Chain, }
\item[{const {\bf Scalar\-Sequence}$<$ double $>$ \&}]{weight\-Sequence, }
\item[{P\-\_\-\-M \&}]{unified\-Cov\-Matrix}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a955fb446652327edbc275e3d9145e2db}


Creates covariance matrix for current level (Step 04 from M\-L algorithm). 

This method is responsible for the Step 04 in the M\-L algorithm implemented/described in the method \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a8d7296b30623c73ada38971cae27994a}{M\-L\-Sampling$<$\-P\-\_\-\-V,\-P\-\_\-\-M$>$\-::generate\-Sequence}.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em prev\-Chain,weight\-Sequence} & \\
\hline
\mbox{\tt out}  & {\em unified\-Cov\-Matrix} & \\
\hline
\end{DoxyParams}


Definition at line 2985 of file M\-L\-Sampling.\-C.



References Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::get\-Position\-Values(), L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::matrix\-Product(), Q\-U\-E\-S\-O\-::\-Misc\-Get\-Ellapsed\-Seconds(), Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-D\-O\-U\-B\-L\-E, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-S\-U\-M, Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::sub\-Sequence\-Size(), and Q\-U\-E\-S\-O\-::\-U\-Q\-\_\-\-O\-K\-\_\-\-R\-C.


\begin{DoxyCode}
2989 \{
2990   \textcolor{keywordtype}{int} iRC = \hyperlink{namespace_q_u_e_s_o_a8e909502900aecf24cedba022ea84471}{UQ\_OK\_RC};
2991   \textcolor{keyword}{struct }timeval timevalStep;
2992   iRC = gettimeofday(&timevalStep, NULL);
2993   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
2994 
2995       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2996         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
2997                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2998                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2999                                 << \textcolor{stringliteral}{": beginning step 4 of 11"}
3000                                 << std::endl;
3001       \}
3002 
3003       P\_V auxVec(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a92e963bb5cab3eecd290dfe4b8f03b04}{zeroVector}());
3004       P\_V subWeightedMeanVec(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a92e963bb5cab3eecd290dfe4b8f03b04}{zeroVector}());
3005       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < weightSequence.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a0288ea295eedc216a1617b3286f6f3a0}{subSequenceSize}(); ++i) \{
3006         prevChain.getPositionValues(i,auxVec);
3007         subWeightedMeanVec += weightSequence[i]*auxVec;
3008       \}
3009 
3010       \textcolor{comment}{// Todd Oliver 2010-09-07: compute weighted mean over all processors}
3011       P\_V unifiedWeightedMeanVec(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a92e963bb5cab3eecd290dfe4b8f03b04}{zeroVector}());
3012       \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
3013         subWeightedMeanVec.mpiAllReduce(\hyperlink{_mpi_comm_8h_afbf78d291c032aa7f512bc566cee2bd1}{RawValue\_MPI\_SUM},\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}(),unifiedWeightedMeanVec);
3014       \}
3015       \textcolor{keywordflow}{else} \{
3016         unifiedWeightedMeanVec = subWeightedMeanVec;
3017       \}
3018 
3019       P\_V diffVec(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a92e963bb5cab3eecd290dfe4b8f03b04}{zeroVector}());
3020       P\_M subCovMatrix(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a92e963bb5cab3eecd290dfe4b8f03b04}{zeroVector}());
3021       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < weightSequence.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a0288ea295eedc216a1617b3286f6f3a0}{subSequenceSize}(); ++i) \{
3022         prevChain.getPositionValues(i,auxVec);
3023         diffVec = auxVec - unifiedWeightedMeanVec;
3024         subCovMatrix += weightSequence[i]*\hyperlink{namespace_q_u_e_s_o_aea04e232d5d3dd76349a85bb8acf9e17}{matrixProduct}(diffVec,diffVec);
3025       \}
3026 
3027       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < unifiedCovMatrix.numRowsLocal(); ++i) \{ \textcolor{comment}{// KAUST5}
3028         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} j = 0; j < unifiedCovMatrix.numCols(); ++j) \{
3029           \textcolor{keywordtype}{double} localValue = subCovMatrix(i,j);
3030           \textcolor{keywordtype}{double} sumValue = 0.;
3031           \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
3032             \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &localValue, (\textcolor{keywordtype}{void} *) &sumValue, 
      (\textcolor{keywordtype}{int}) 1, \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, \hyperlink{_mpi_comm_8h_afbf78d291c032aa7f512bc566cee2bd1}{RawValue\_MPI\_SUM},
3033                                          \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
3034                                          \textcolor{stringliteral}{"failed MPI.Allreduce() for cov matrix"});
3035           \}
3036           \textcolor{keywordflow}{else} \{
3037             sumValue = localValue;
3038           \}
3039           unifiedCovMatrix(i,j) = sumValue;
3040         \}
3041       \}
3042 
3043       \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_afbe27e6149562020663b72da6592d933}{m\_numDisabledParameters} > 0) \{ \textcolor{comment}{// gpmsa2}
3044         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} paramId = 0; paramId < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.
      \hyperlink{class_q_u_e_s_o_1_1_vector_space_a5829a1f4f996f8307c840b705144d666}{dimLocal}(); ++paramId) \{
3045           \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ac76690384f70d74b8662faf7a051449e}{m\_parameterEnabledStatus}[paramId] == \textcolor{keyword}{false}) \{
3046             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a5829a1f4f996f8307c840b705144d666}{dimLocal}(); ++i) \{
3047               unifiedCovMatrix(i,paramId) = 0.;
3048             \}
3049             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} j = 0; j < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a5829a1f4f996f8307c840b705144d666}{dimLocal}(); ++j) \{
3050               unifiedCovMatrix(paramId,j) = 0.;
3051             \}
3052             unifiedCovMatrix(paramId,paramId) = 1.;
3053           \}
3054         \}
3055       \}
3056 
3057       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3058         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
3059                                 << \textcolor{stringliteral}{", level "}              << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3060                                 << \textcolor{stringliteral}{", step "}               << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3061                                 << \textcolor{stringliteral}{": unifiedCovMatrix = "} << unifiedCovMatrix
3062                                 << std::endl;
3063       \}
3064 
3065   \textcolor{keywordtype}{double} stepRunTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalStep);
3066   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3067     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving MLSampling<P\_V,P\_M>::generateSequence\_Step()"}
3068                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3069                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3070                             << \textcolor{stringliteral}{", after "} << stepRunTime << \textcolor{stringliteral}{" seconds"}
3071                             << std::endl;
3072   \}
3073 
3074   \textcolor{keywordflow}{return};
3075 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a3db529d364d5bb47916066d7cc21cb00}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!generate\-Sequence\-\_\-\-Step05\-\_\-inter0@{generate\-Sequence\-\_\-\-Step05\-\_\-inter0}}
\index{generate\-Sequence\-\_\-\-Step05\-\_\-inter0@{generate\-Sequence\-\_\-\-Step05\-\_\-inter0}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{generate\-Sequence\-\_\-\-Step05\-\_\-inter0}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Sequence\-\_\-\-Step05\-\_\-inter0 (
\begin{DoxyParamCaption}
\item[{unsigned int}]{unified\-Requested\-Num\-Samples, }
\item[{const {\bf Scalar\-Sequence}$<$ double $>$ \&}]{weight\-Sequence, }
\item[{std\-::vector$<$ unsigned int $>$ \&}]{unified\-Index\-Counters\-At\-Proc0\-Only, }
\item[{std\-::vector$<$ double $>$ \&}]{unified\-Weight\-Std\-Vector\-At\-Proc0\-Only}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a3db529d364d5bb47916066d7cc21cb00}


Creates {\bfseries unified} finite distribution for current level (Step 05 from M\-L algorithm). 

This method is responsible for the Step 05 in the M\-L algorithm implemented/described in the method \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a8d7296b30623c73ada38971cae27994a}{M\-L\-Sampling$<$\-P\-\_\-\-V,\-P\-\_\-\-M$>$\-::generate\-Sequence}.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em unified\-Requested\-Num\-Samples,weight\-Sequence} & \\
\hline
\mbox{\tt out}  & {\em unified\-Index\-Counters\-At\-Proc0\-Only,unified\-Weight\-Std\-Vector\-At\-Proc0\-Only} & \\
\hline
\end{DoxyParams}


Definition at line 3079 of file M\-L\-Sampling.\-C.



References Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::get\-Unified\-Contents\-At\-Proc0\-Only(), L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-Misc\-Get\-Ellapsed\-Seconds(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::sub\-Sequence\-Size(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::unified\-Sequence\-Size(), U\-Q\-\_\-\-F\-A\-T\-A\-L\-\_\-\-T\-E\-S\-T\-\_\-\-M\-A\-C\-R\-O, and Q\-U\-E\-S\-O\-::\-U\-Q\-\_\-\-O\-K\-\_\-\-R\-C.


\begin{DoxyCode}
3084 \{
3085   \textcolor{keywordtype}{int} iRC = \hyperlink{namespace_q_u_e_s_o_a8e909502900aecf24cedba022ea84471}{UQ\_OK\_RC};
3086   \textcolor{keyword}{struct }timeval timevalStep;
3087   iRC = gettimeofday(&timevalStep, NULL);
3088   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
3089 
3090       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3091         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
3092                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3093                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3094                                 << \textcolor{stringliteral}{": beginning step 5 of 11"}
3095                                 << std::endl;
3096       \}
3097 
3098 \textcolor{preprocessor}{#if 0 // For debug only}
3099 \textcolor{preprocessor}{}      \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3100         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
3101                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3102                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3103                                 << \textcolor{stringliteral}{", before weightSequence.getUnifiedContentsAtProc0Only()"}
3104                                 << \textcolor{stringliteral}{":"}
3105                                 << std::endl;
3106       \}
3107       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < weightSequence.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a0288ea295eedc216a1617b3286f6f3a0}{subSequenceSize}(); ++i) \{
3108         \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3109           *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{", weightSequence["} << i
3110                                   << \textcolor{stringliteral}{"] = "}              << weightSequence[i]
3111                                   << std::endl;
3112         \}
3113       \}
3114 \textcolor{preprocessor}{#endif}
3115 \textcolor{preprocessor}{}
3116       weightSequence.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_ab8802412461496eb72f6c1267507c28c}{getUnifiedContentsAtProc0Only}(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1,
3117                                                    unifiedWeightStdVectorAtProc0Only);
3118 
3119 \textcolor{preprocessor}{#if 0 // For debug only}
3120 \textcolor{preprocessor}{}      \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3121         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
3122                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3123                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3124                                 << \textcolor{stringliteral}{", after weightSequence.getUnifiedContentsAtProc0Only()"}
3125                                 << \textcolor{stringliteral}{":"}
3126                                 << std::endl;
3127       \}
3128       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < unifiedWeightStdVectorAtProc0Only.size(); ++i) \{
3129         \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3130           *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"  unifiedWeightStdVectorAtProc0Only["} << i
3131                                   << \textcolor{stringliteral}{"] = "}                                 << 
      unifiedWeightStdVectorAtProc0Only[i]
3132                                   << std::endl;
3133         \}
3134       \}
3135 \textcolor{preprocessor}{#endif}
3136 \textcolor{preprocessor}{}      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af71979655e46135b6a3c97b8909321f0}{sampleIndexes\_proc0}(unifiedRequestedNumSamples,        \textcolor{comment}{// input}
3137                           unifiedWeightStdVectorAtProc0Only, \textcolor{comment}{// input}
3138                           unifiedIndexCountersAtProc0Only);  \textcolor{comment}{// output}
3139 
3140       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} auxUnifiedSize = weightSequence.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a52829afc95e5c36e9db44f40854153b0}{unifiedSequenceSize}(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1);
3141       \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() == 0) \{
3142         \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(unifiedIndexCountersAtProc0Only.size() != auxUnifiedSize,
3143                             \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
3144                             \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
3145                             \textcolor{stringliteral}{"wrong output from sampleIndexesAtProc0() in step 5"});
3146       \}
3147 
3148   \textcolor{keywordtype}{double} stepRunTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalStep);
3149   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3150     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving MLSampling<P\_V,P\_M>::generateSequence\_Step()"}
3151                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3152                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3153                             << \textcolor{stringliteral}{", after "} << stepRunTime << \textcolor{stringliteral}{" seconds"}
3154                             << std::endl;
3155   \}
3156 
3157   \textcolor{keywordflow}{return};
3158 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a21f642100e0690f65563e2c1f8bed816}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!generate\-Sequence\-\_\-\-Step06\-\_\-all@{generate\-Sequence\-\_\-\-Step06\-\_\-all}}
\index{generate\-Sequence\-\_\-\-Step06\-\_\-all@{generate\-Sequence\-\_\-\-Step06\-\_\-all}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{generate\-Sequence\-\_\-\-Step06\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Sequence\-\_\-\-Step06\-\_\-all (
\begin{DoxyParamCaption}
\item[{const {\bf M\-L\-Sampling\-Level\-Options} $\ast$}]{curr\-Options, }
\item[{unsigned int}]{index\-Of\-First\-Weight, }
\item[{unsigned int}]{index\-Of\-Last\-Weight, }
\item[{const std\-::vector$<$ unsigned int $>$ \&}]{unified\-Index\-Counters\-At\-Proc0\-Only, }
\item[{bool \&}]{use\-Balanced\-Chains, }
\item[{std\-::vector$<$ {\bf Exchange\-Info\-Struct} $>$ \&}]{exchange\-Std\-Vec}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a21f642100e0690f65563e2c1f8bed816}


Decides on wheter or not to use balanced chains (Step 06 from M\-L algorithm). 

This method is responsible for the Step 06 in the M\-L algorithm implemented/described in the method \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a8d7296b30623c73ada38971cae27994a}{M\-L\-Sampling$<$\-P\-\_\-\-V,\-P\-\_\-\-M$>$\-::generate\-Sequence}.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em curr\-Options,index\-Of\-First\-Weight,index\-Of\-Last\-Weight,unified\-Index\-Counters\-At\-Proc0\-Only} & \\
\hline
\mbox{\tt out}  & {\em use\-Balanced\-Chains,exchange\-Std\-Vec} & \\
\hline
\end{DoxyParams}


Definition at line 3162 of file M\-L\-Sampling.\-C.



References L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-Misc\-Get\-Ellapsed\-Seconds(), and Q\-U\-E\-S\-O\-::\-U\-Q\-\_\-\-O\-K\-\_\-\-R\-C.


\begin{DoxyCode}
3169 \{
3170   \textcolor{keywordtype}{int} iRC = \hyperlink{namespace_q_u_e_s_o_a8e909502900aecf24cedba022ea84471}{UQ\_OK\_RC};
3171   \textcolor{keyword}{struct }timeval timevalStep;
3172   iRC = gettimeofday(&timevalStep, NULL);
3173   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
3174 
3175   useBalancedChains = \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a0f6f7872635b9546b3215fee347601f6}{decideOnBalancedChains\_all}(currOptions,                    
       \textcolor{comment}{// input}
3176                                                  indexOfFirstWeight,              \textcolor{comment}{// input}
3177                                                  indexOfLastWeight,               \textcolor{comment}{// input}
3178                                                  unifiedIndexCountersAtProc0Only, \textcolor{comment}{// input}
3179                                                  exchangeStdVec);                 \textcolor{comment}{// output}
3180 
3181   \textcolor{keywordtype}{double} stepRunTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalStep);
3182   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3183     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving MLSampling<P\_V,P\_M>::generateSequence\_Step()"}
3184                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3185                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3186                             << \textcolor{stringliteral}{", after "} << stepRunTime << \textcolor{stringliteral}{" seconds"}
3187                             << std::endl;
3188   \}
3189 
3190   \textcolor{keywordflow}{return};
3191 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a270d639f90f6f2c60d1af851eea63d41}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!generate\-Sequence\-\_\-\-Step07\-\_\-inter0@{generate\-Sequence\-\_\-\-Step07\-\_\-inter0}}
\index{generate\-Sequence\-\_\-\-Step07\-\_\-inter0@{generate\-Sequence\-\_\-\-Step07\-\_\-inter0}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{generate\-Sequence\-\_\-\-Step07\-\_\-inter0}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Sequence\-\_\-\-Step07\-\_\-inter0 (
\begin{DoxyParamCaption}
\item[{bool}]{use\-Balanced\-Chains, }
\item[{unsigned int}]{index\-Of\-First\-Weight, }
\item[{unsigned int}]{index\-Of\-Last\-Weight, }
\item[{const std\-::vector$<$ unsigned int $>$ \&}]{unified\-Index\-Counters\-At\-Proc0\-Only, }
\item[{{\bf Unbalanced\-Linked\-Chains\-Per\-Node\-Struct} \&}]{unbalanced\-Link\-Control, }
\item[{const {\bf M\-L\-Sampling\-Level\-Options} $\ast$}]{curr\-Options, }
\item[{const {\bf Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{prev\-Chain, }
\item[{std\-::vector$<$ {\bf Exchange\-Info\-Struct} $>$ \&}]{exchange\-Std\-Vec, }
\item[{{\bf Balanced\-Linked\-Chains\-Per\-Node\-Struct}$<$ P\-\_\-\-V $>$ \&}]{balanced\-Link\-Control}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a270d639f90f6f2c60d1af851eea63d41}


Plans for number of linked chains for each node so that all nodes generate the closest possible to the same number of positions (Step 07 from M\-L algorithm). 

This method is responsible for the Step 07 in the M\-L algorithm implemented/described in the method \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a8d7296b30623c73ada38971cae27994a}{M\-L\-Sampling$<$\-P\-\_\-\-V,\-P\-\_\-\-M$>$\-::generate\-Sequence}.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em use\-Balanced\-Chains,index\-Of\-First\-Weight,index\-Of\-Last\-Weight,unified\-Index\-Counters\-At\-Proc0\-Only,curr\-Options,prev\-Chain} & \\
\hline
\mbox{\tt in,out}  & {\em exchange\-Std\-Vec} & \\
\hline
\mbox{\tt out}  & {\em unbalanced\-Link\-Control,balanced\-Link\-Control} & \\
\hline
\end{DoxyParams}


Definition at line 3195 of file M\-L\-Sampling.\-C.



References Q\-U\-E\-S\-O\-::\-Balanced\-Linked\-Chains\-Per\-Node\-Struct$<$ P\-\_\-\-V $>$\-::bal\-Linked\-Chains, L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-Misc\-Get\-Ellapsed\-Seconds(), Q\-U\-E\-S\-O\-::\-Unbalanced\-Linked\-Chains\-Per\-Node\-Struct\-::unb\-Linked\-Chains, and Q\-U\-E\-S\-O\-::\-U\-Q\-\_\-\-O\-K\-\_\-\-R\-C.


\begin{DoxyCode}
3205 \{
3206   \textcolor{keywordtype}{int} iRC = \hyperlink{namespace_q_u_e_s_o_a8e909502900aecf24cedba022ea84471}{UQ\_OK\_RC};
3207   \textcolor{keyword}{struct }timeval timevalStep;
3208   iRC = gettimeofday(&timevalStep, NULL);
3209   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
3210 
3211       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3212         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
3213                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3214                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3215                                 << \textcolor{stringliteral}{": beginning step 7 of 11"}
3216                                 << std::endl;
3217       \}
3218 
3219       \textcolor{keywordflow}{if} (useBalancedChains) \{
3220         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75b2d73a0b07f594951a89cc1bc96849}{prepareBalLinkedChains\_inter0}(currOptions,                     \textcolor{comment}{//
       input}
3221                                       prevChain,                       \textcolor{comment}{// input}
3222                                       exchangeStdVec,                  \textcolor{comment}{// input/output}
3223                                       balancedLinkControl);            \textcolor{comment}{// output}
3224       \}
3225       \textcolor{keywordflow}{else} \{
3226         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a37dcf4d893b6c8f67fe077892bada773}{prepareUnbLinkedChains\_inter0}(indexOfFirstWeight,              \textcolor{comment}{//
       input}
3227                                       indexOfLastWeight,               \textcolor{comment}{// input}
3228                                       unifiedIndexCountersAtProc0Only, \textcolor{comment}{// input}
3229                                       unbalancedLinkControl);          \textcolor{comment}{// output}
3230       \}
3231 
3232       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3233         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
3234                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3235                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3236                                 << \textcolor{stringliteral}{": balancedLinkControl.balLinkedChains.size() = "}   << 
      balancedLinkControl.balLinkedChains.size()
3237                                 << \textcolor{stringliteral}{", unbalancedLinkControl.unbLinkedChains.size() = "} << 
      unbalancedLinkControl.unbLinkedChains.size()
3238                                 << std::endl;
3239       \}
3240 
3241   \textcolor{keywordtype}{double} stepRunTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalStep);
3242   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3243     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving MLSampling<P\_V,P\_M>::generateSequence\_Step()"}
3244                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3245                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3246                             << \textcolor{stringliteral}{", after "} << stepRunTime << \textcolor{stringliteral}{" seconds"}
3247                             << std::endl;
3248   \}
3249 
3250   \textcolor{keywordflow}{return};
3251 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a754bc11c7802f627fece9f063450739a}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!generate\-Sequence\-\_\-\-Step08\-\_\-all@{generate\-Sequence\-\_\-\-Step08\-\_\-all}}
\index{generate\-Sequence\-\_\-\-Step08\-\_\-all@{generate\-Sequence\-\_\-\-Step08\-\_\-all}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{generate\-Sequence\-\_\-\-Step08\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Sequence\-\_\-\-Step08\-\_\-all (
\begin{DoxyParamCaption}
\item[{{\bf Bayesian\-Joint\-Pdf}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{curr\-Pdf, }
\item[{{\bf Generic\-Vector\-R\-V}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{curr\-Rv}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a754bc11c7802f627fece9f063450739a}


Creates a vector R\-V for current level (Step 08 from M\-L algorithm). 

This method is responsible for the Step 08 in the M\-L algorithm implemented/described in the method \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a8d7296b30623c73ada38971cae27994a}{M\-L\-Sampling$<$\-P\-\_\-\-V,\-P\-\_\-\-M$>$\-::generate\-Sequence}.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em curr\-Pdf} & \\
\hline
\mbox{\tt out}  & {\em curr\-Rv} & \\
\hline
\end{DoxyParams}


Definition at line 3255 of file M\-L\-Sampling.\-C.



References L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-Misc\-Get\-Ellapsed\-Seconds(), Q\-U\-E\-S\-O\-::\-Generic\-Vector\-R\-V$<$ V, M $>$\-::set\-Pdf(), and Q\-U\-E\-S\-O\-::\-U\-Q\-\_\-\-O\-K\-\_\-\-R\-C.


\begin{DoxyCode}
3258 \{
3259   \textcolor{keywordtype}{int} iRC = \hyperlink{namespace_q_u_e_s_o_a8e909502900aecf24cedba022ea84471}{UQ\_OK\_RC};
3260   \textcolor{keyword}{struct }timeval timevalStep;
3261   iRC = gettimeofday(&timevalStep, NULL);
3262   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
3263 
3264       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3265         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
3266                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3267                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3268                                 << \textcolor{stringliteral}{": beginning step 8 of 11"}
3269                                 << std::endl;
3270       \}
3271 
3272       currRv.\hyperlink{class_q_u_e_s_o_1_1_generic_vector_r_v_a1645a2db9e84b44df65faefda9921277}{setPdf}(currPdf);
3273 
3274   \textcolor{keywordtype}{double} stepRunTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalStep);
3275   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3276     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving MLSampling<P\_V,P\_M>::generateSequence\_Step()"}
3277                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3278                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3279                             << \textcolor{stringliteral}{", after "} << stepRunTime << \textcolor{stringliteral}{" seconds"}
3280                             << std::endl;
3281   \}
3282 
3283   \textcolor{keywordflow}{return};
3284 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a26892288f3b1902d78ba049b96579a08}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!generate\-Sequence\-\_\-\-Step09\-\_\-all@{generate\-Sequence\-\_\-\-Step09\-\_\-all}}
\index{generate\-Sequence\-\_\-\-Step09\-\_\-all@{generate\-Sequence\-\_\-\-Step09\-\_\-all}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{generate\-Sequence\-\_\-\-Step09\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Sequence\-\_\-\-Step09\-\_\-all (
\begin{DoxyParamCaption}
\item[{const {\bf Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{prev\-Chain, }
\item[{unsigned int}]{index\-Of\-First\-Weight, }
\item[{unsigned int}]{index\-Of\-Last\-Weight, }
\item[{const std\-::vector$<$ double $>$ \&}]{unified\-Weight\-Std\-Vector\-At\-Proc0\-Only, }
\item[{const {\bf Scalar\-Sequence}$<$ double $>$ \&}]{weight\-Sequence, }
\item[{double}]{prev\-Eta, }
\item[{const {\bf Generic\-Vector\-R\-V}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{curr\-Rv, }
\item[{{\bf M\-L\-Sampling\-Level\-Options} $\ast$}]{curr\-Options, }
\item[{P\-\_\-\-M \&}]{unified\-Cov\-Matrix, }
\item[{double \&}]{curr\-Eta}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a26892288f3b1902d78ba049b96579a08}


Scales the unified covariance matrix until min $<$= rejection rate $<$= max (Step 09 from M\-L algorithm). 

This method is responsible for the Step 09 in the M\-L algorithm implemented/described in the method \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a8d7296b30623c73ada38971cae27994a}{M\-L\-Sampling$<$\-P\-\_\-\-V,\-P\-\_\-\-M$>$\-::generate\-Sequence}.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em prev\-Chain,index\-Of\-First\-Weight,index\-Of\-Last\-Weight,unified\-Weight\-Std\-Vector\-At\-Proc0\-Only,weight\-Sequence,prev\-Eta,curr\-Rv,curr\-Options,@param\mbox{[}in,out\mbox{]}} & unified\-Cov\-Matrix \\
\hline
\mbox{\tt out}  & {\em curr\-Eta} & \\
\hline
\end{DoxyParams}


Definition at line 3288 of file M\-L\-Sampling.\-C.



References Q\-U\-E\-S\-O\-::\-Balanced\-Linked\-Chains\-Per\-Node\-Struct$<$ P\-\_\-\-V $>$\-::bal\-Linked\-Chains, Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::get\-Unified\-Contents\-At\-Proc0\-Only(), L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-am\-Adapt\-Interval, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-cov\-Rejection\-Rate, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-dr\-Max\-Num\-Extra\-Stages, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-filtered\-Chain\-Generate, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-max\-Rejection\-Rate, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-min\-Rejection\-Rate, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-raw\-Chain\-Size, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-scale\-Cov\-Matrix, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-totally\-Mute, Q\-U\-E\-S\-O\-::\-Misc\-Check\-For\-Same\-Value\-In\-All\-Nodes(), Q\-U\-E\-S\-O\-::\-Misc\-Get\-Ellapsed\-Seconds(), Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-S\-U\-M, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-U\-N\-S\-I\-G\-N\-E\-D, Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::sub\-Sequence\-Size(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::unified\-Sequence\-Size(), U\-Q\-\_\-\-F\-A\-T\-A\-L\-\_\-\-T\-E\-S\-T\-\_\-\-M\-A\-C\-R\-O, and Q\-U\-E\-S\-O\-::\-U\-Q\-\_\-\-O\-K\-\_\-\-R\-C.


\begin{DoxyCode}
3299 \{
3300   \textcolor{keywordtype}{int} iRC = \hyperlink{namespace_q_u_e_s_o_a8e909502900aecf24cedba022ea84471}{UQ\_OK\_RC};
3301   \textcolor{keyword}{struct }timeval timevalStep;
3302   iRC = gettimeofday(&timevalStep, NULL);
3303   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
3304 
3305     \textcolor{keywordflow}{if} (currOptions->m\_scaleCovMatrix == \textcolor{keyword}{false}) \{
3306       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3307         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
3308                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3309                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3310                                 << \textcolor{stringliteral}{": skipping step 9 of 11"}
3311                                 << std::endl;
3312       \}
3313     \}
3314     \textcolor{keywordflow}{else} \{
3315       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3316         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In
       MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all()"}
3317                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3318                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3319                                 << \textcolor{stringliteral}{": beginning step 9 of 11"}
3320                                 << std::endl;
3321       \}
3322 
3323       \textcolor{keywordtype}{double} beforeEta           = prevEta;
3324       \textcolor{keywordtype}{double} beforeRejectionRate = 0.;               \textcolor{comment}{// To be updated}
3325       \textcolor{keywordtype}{bool}   beforeRejectionRateIsBelowRange = \textcolor{keyword}{true}; \textcolor{comment}{// To be updated}
3326 
3327       \textcolor{keywordtype}{double} nowEta           = prevEta;
3328       \textcolor{keywordtype}{double} nowRejectionRate = 0.;               \textcolor{comment}{// To be computed}
3329       \textcolor{keywordtype}{bool}   nowRejectionRateIsBelowRange = \textcolor{keyword}{true}; \textcolor{comment}{// To be computed}
3330 
3331       std::vector<double> etas(2,0.);
3332       etas[0] = beforeEta;
3333       etas[1] = 1.;
3334 
3335       std::vector<double> rejs(2,0.);
3336       rejs[0] = 0.; \textcolor{comment}{// To be computed}
3337       rejs[1] = 0.; \textcolor{comment}{// To be computed}
3338 
3339       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nowAttempt = 0;
3340       \textcolor{keywordtype}{bool} testResult = \textcolor{keyword}{false};
3341       \textcolor{keywordtype}{double} meanRejectionRate = .5*(currOptions->m\_minRejectionRate + currOptions->m\_maxRejectionRate);
3342       \textcolor{keywordtype}{bool} useMiddlePointLogicForEta = \textcolor{keyword}{false};
3343       P\_M nowCovMatrix(unifiedCovMatrix);
3344 \textcolor{preprocessor}{#if 0 // KAUST, to check}
3345 \textcolor{preprocessor}{}      std::vector<double> unifiedWeightStdVectorAtProc0Only(0);
3346       weightSequence.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_ab8802412461496eb72f6c1267507c28c}{getUnifiedContentsAtProc0Only}(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1,
3347                                                    unifiedWeightStdVectorAtProc0Only);
3348 \textcolor{preprocessor}{#endif}
3349 \textcolor{preprocessor}{}      \textcolor{keywordflow}{do} \{
3350         \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3351           *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In
       MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all()"}
3352                                   << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3353                                   << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3354                                   << \textcolor{stringliteral}{": entering loop for assessing rejection rate"}
3355                                   << \textcolor{stringliteral}{", with nowAttempt = "}  << nowAttempt
3356                                   << \textcolor{stringliteral}{", nowRejectionRate = "} << nowRejectionRate
3357                                   << std::endl;
3358         \}
3359         nowCovMatrix = unifiedCovMatrix;
3360 
3361         \textcolor{keywordflow}{if} (nowRejectionRate < currOptions->m\_minRejectionRate) \{
3362           nowRejectionRateIsBelowRange = \textcolor{keyword}{true};
3363         \}
3364         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (nowRejectionRate > currOptions->m\_maxRejectionRate) \{
3365           nowRejectionRateIsBelowRange = \textcolor{keyword}{false};
3366         \}
3367         \textcolor{keywordflow}{else} \{
3368           \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(\textcolor{keyword}{true},
3369                               \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
3370                               \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all()"},
3371                               \textcolor{stringliteral}{"nowRejectionRate should be out of the requested range at this point of the
       logic"});
3372         \}
3373 
3374         \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{ \textcolor{comment}{// KAUST}
3375           \textcolor{keywordflow}{if} (nowAttempt > 0) \{
3376             \textcolor{keywordflow}{if} (useMiddlePointLogicForEta == \textcolor{keyword}{false}) \{
3377               \textcolor{keywordflow}{if} (nowAttempt == 1) \{
3378                 \textcolor{comment}{// Ok, keep useMiddlePointLogicForEta = false}
3379               \}
3380               \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((beforeRejectionRateIsBelowRange == \textcolor{keyword}{true}) &&
3381                        (nowRejectionRateIsBelowRange    == \textcolor{keyword}{true})) \{
3382                 \textcolor{comment}{// Ok}
3383               \}
3384               \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((beforeRejectionRateIsBelowRange == \textcolor{keyword}{false}) &&
3385                        (nowRejectionRateIsBelowRange    == \textcolor{keyword}{false})) \{
3386                 \textcolor{comment}{// Ok}
3387               \}
3388               \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((beforeRejectionRateIsBelowRange == \textcolor{keyword}{true} ) &&
3389                        (nowRejectionRateIsBelowRange    == \textcolor{keyword}{false})) \{
3390                 useMiddlePointLogicForEta = \textcolor{keyword}{true};
3391 
3392                 \textcolor{comment}{// This is the first time the middle point logic will be used below}
3393                 etas[0] = std::min(beforeEta,nowEta);
3394                 etas[1] = std::max(beforeEta,nowEta);
3395 
3396                 \textcolor{keywordflow}{if} (etas[0] == beforeEta) \{
3397                   rejs[0] = beforeRejectionRate;
3398                   rejs[1] = nowRejectionRate;
3399                 \}
3400                 \textcolor{keywordflow}{else} \{
3401                   rejs[0] = nowRejectionRate;
3402                   rejs[1] = beforeRejectionRate;
3403                 \}
3404               \}
3405               \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((beforeRejectionRateIsBelowRange == \textcolor{keyword}{false}) &&
3406                        (nowRejectionRateIsBelowRange    == \textcolor{keyword}{true} )) \{
3407                 useMiddlePointLogicForEta = \textcolor{keyword}{true};
3408 
3409                 \textcolor{comment}{// This is the first time the middle point logic will be used below}
3410                 etas[0] = std::min(beforeEta,nowEta);
3411                 etas[1] = std::max(beforeEta,nowEta);
3412               \}
3413               \textcolor{keywordflow}{else} \{
3414                 \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(\textcolor{keyword}{true},
3415                                     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
3416                                     \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all()"},
3417                                     \textcolor{stringliteral}{"before and now range flags are inconsistent"});
3418               \}
3419             \} \textcolor{comment}{// if (useMiddlePointLogicForEta == false)}
3420 
3421             beforeEta                       = nowEta;
3422             beforeRejectionRate             = nowRejectionRate;
3423             beforeRejectionRateIsBelowRange = nowRejectionRateIsBelowRange;
3424             \textcolor{keywordflow}{if} (useMiddlePointLogicForEta == \textcolor{keyword}{false}) \{
3425               \textcolor{keywordflow}{if} (beforeRejectionRateIsBelowRange) nowEta *= 4.;
3426               \textcolor{keywordflow}{else}                                 nowEta /= 4.;
3427               \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3428                 *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In
       MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all()"}
3429                                         << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3430                                         << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3431                                         << \textcolor{stringliteral}{": in loop for assessing rejection rate"}
3432                                         << \textcolor{stringliteral}{", with nowAttempt = "}  << nowAttempt
3433                                         << \textcolor{stringliteral}{", useMiddlePointLogicForEta = false"}
3434                                         << \textcolor{stringliteral}{", nowEta just updated to value (to be tested) "} << nowEta
3435                                         << std::endl;
3436               \}
3437             \}
3438             \textcolor{keywordflow}{else} \{
3439               \textcolor{keywordflow}{if} (nowRejectionRate > meanRejectionRate) \{
3440                 \textcolor{keywordflow}{if} (rejs[0] > meanRejectionRate) \{
3441                   etas[0] = nowEta;
3442                   etas[1] = etas[1];
3443                 \}
3444                 \textcolor{keywordflow}{else} \{
3445                   etas[0] = etas[0];
3446                   etas[1] = nowEta;
3447                 \}
3448               \}
3449               \textcolor{keywordflow}{else} \{
3450                 \textcolor{keywordflow}{if} (rejs[0] < meanRejectionRate) \{
3451                   etas[0] = nowEta;
3452                   etas[1] = etas[1];
3453                 \}
3454                 \textcolor{keywordflow}{else} \{
3455                   etas[0] = etas[0];
3456                   etas[1] = nowEta;
3457                 \}
3458               \}
3459               nowEta = .5*(etas[0] + etas[1]);
3460               \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3461                 *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In
       MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all()"}
3462                                         << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3463                                         << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3464                                         << \textcolor{stringliteral}{": in loop for assessing rejection rate"}
3465                                         << \textcolor{stringliteral}{", with nowAttempt = "} << nowAttempt
3466                                         << \textcolor{stringliteral}{", useMiddlePointLogicForEta = true"}
3467                                         << \textcolor{stringliteral}{", nowEta just updated to value (to be tested) "} << nowEta
3468                                         << \textcolor{stringliteral}{", etas[0] = "} << etas[0]
3469                                         << \textcolor{stringliteral}{", etas[1] = "} << etas[1]
3470                                         << std::endl;
3471               \}
3472             \}
3473           \} \textcolor{comment}{// if (nowAttempt > 0)}
3474         \} \textcolor{comment}{// if (m\_env.inter0Rank() >= 0) // KAUST}
3475 
3476         nowCovMatrix *= nowEta;
3477 
3478         \textcolor{comment}{// prudencio 2010-12-09: logic 'originalSubNumSamples += 1' added because of the difference of
       results between GNU and INTEL compiled codes}
3479         \textcolor{keywordtype}{double}       doubSubNumSamples     = (1.-meanRejectionRate)/meanRejectionRate/currOptions->
      m\_covRejectionRate/currOptions->m\_covRejectionRate; \textcolor{comment}{// e.g. 19.99...; or 20.0; or 20.1; or 20.9}
3480         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} originalSubNumSamples = 1 + (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) (doubSubNumSamples); \textcolor{comment}{// e.g. 20; or 21; or
       21; or 21}
3481         \textcolor{keywordtype}{double}       auxDouble             = (double) originalSubNumSamples; \textcolor{comment}{// e.g. 20.0; or 21.0; or
       21.0; or 21.0}
3482         \textcolor{keywordflow}{if} ((auxDouble - doubSubNumSamples) < 1.e-8) \{ \textcolor{comment}{// e.g. 0.00...01; or 1.0; or 0.9; or 0.1}
3483           originalSubNumSamples += 1;
3484         \}
3485 
3486         \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{ \textcolor{comment}{// KAUST}
3487           \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3488             *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In
       MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all()"}
3489                                     << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3490                                     << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3491                                     << \textcolor{stringliteral}{": in loop for assessing rejection rate"}
3492                                     << \textcolor{stringliteral}{", about to sample "}     << originalSubNumSamples << \textcolor{stringliteral}{" indexes"}
3493                                     << \textcolor{stringliteral}{", meanRejectionRate = "} << meanRejectionRate
3494                                     << \textcolor{stringliteral}{", covRejectionRate = "}  << currOptions->m\_covRejectionRate
3495                                     << std::endl;
3496           \}
3497         \} \textcolor{comment}{// KAUST}
3498 
3499         std::vector<unsigned int> nowUnifiedIndexCountersAtProc0Only(0); \textcolor{comment}{// It will be resized by
       'sampleIndexes\_proc0()' below}
3500         \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{ \textcolor{comment}{// KAUST}
3501           \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} tmpUnifiedNumSamples = originalSubNumSamples*\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_aa780721ae0fdeabc5a15e04cb0cad964}{NumProc}();
3502           \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af71979655e46135b6a3c97b8909321f0}{sampleIndexes\_proc0}(tmpUnifiedNumSamples,                \textcolor{comment}{// input}
3503                               unifiedWeightStdVectorAtProc0Only,   \textcolor{comment}{// input}
3504                               nowUnifiedIndexCountersAtProc0Only); \textcolor{comment}{// output}
3505 
3506           \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} auxUnifiedSize = weightSequence.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a52829afc95e5c36e9db44f40854153b0}{unifiedSequenceSize}(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1);
3507           \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() == 0) \{
3508             \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(nowUnifiedIndexCountersAtProc0Only.size() != 
      auxUnifiedSize,
3509                                 \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
3510                                 \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all()"},
3511                                 \textcolor{stringliteral}{"wrong output from sampleIndexesAtProc0() in step 9"});
3512           \}
3513 
3514           \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3515             *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In
       MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all()"}
3516                                     << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3517                                     << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3518                                     << \textcolor{stringliteral}{": in loop for assessing rejection rate"}
3519                                     << \textcolor{stringliteral}{", about to distribute sampled assessment indexes"}
3520                                     << std::endl;
3521           \}
3522         \} \textcolor{comment}{// KAUST}
3523 
3524         std::vector<ExchangeInfoStruct>        exchangeStdVec(0);
3525         BalancedLinkedChainsPerNodeStruct<P\_V> nowBalLinkControl;
3526         UnbalancedLinkedChainsPerNodeStruct    nowUnbLinkControl; \textcolor{comment}{// KAUST}
3527 
3528         \textcolor{comment}{// All processors should call this routine in order to have the same decision value}
3529         \textcolor{keywordtype}{bool} useBalancedChains = \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a0f6f7872635b9546b3215fee347601f6}{decideOnBalancedChains\_all}(currOptions,         
                     \textcolor{comment}{// input}
3530                                                             indexOfFirstWeight,                 \textcolor{comment}{// input}
3531                                                             indexOfLastWeight,                  \textcolor{comment}{// input}
3532                                                             nowUnifiedIndexCountersAtProc0Only, \textcolor{comment}{// input}
3533                                                             exchangeStdVec);                    \textcolor{comment}{// output}
3534 
3535         \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{ \textcolor{comment}{// KAUST}
3536           \textcolor{keywordflow}{if} (useBalancedChains) \{
3537             \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75b2d73a0b07f594951a89cc1bc96849}{prepareBalLinkedChains\_inter0}(currOptions,                        \textcolor{comment}{
      // input}
3538                                           prevChain,                          \textcolor{comment}{// input}
3539                                           exchangeStdVec,                     \textcolor{comment}{// input/output}
3540                                           nowBalLinkControl);                 \textcolor{comment}{// output}
3541           \}
3542           \textcolor{keywordflow}{else} \{
3543             \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a37dcf4d893b6c8f67fe077892bada773}{prepareUnbLinkedChains\_inter0}(indexOfFirstWeight,                 \textcolor{comment}{
      // input}
3544                                           indexOfLastWeight,                  \textcolor{comment}{// input}
3545                                           nowUnifiedIndexCountersAtProc0Only, \textcolor{comment}{// input}
3546                                           nowUnbLinkControl);                 \textcolor{comment}{// output}
3547           \}
3548         \} \textcolor{comment}{// KAUST}
3549 
3550         \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3551           *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In
       MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all()"}
3552                                   << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3553                                   << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3554                                   << \textcolor{stringliteral}{": in loop for assessing rejection rate"}
3555                                   << \textcolor{stringliteral}{", about to generate assessment chain"}
3556                                   << std::endl;
3557         \}
3558 
3559         SequenceOfVectors<P\_V,P\_M> nowChain(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace},
3560                                                    0,
3561                                                    \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_options_a1d3d48598e0b59b46337ce66a52671a5}{m\_prefix}+\textcolor{stringliteral}{"now\_chain"});
3562         \textcolor{keywordtype}{double}       nowRunTime    = 0.;
3563         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nowRejections = 0;
3564 
3565         \textcolor{comment}{// KAUST: all nodes should call here}
3566         \textcolor{keywordtype}{bool}         savedTotallyMute           = currOptions->m\_totallyMute; \textcolor{comment}{// HERE - ENHANCEMENT}
3567         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} savedRawChainSize          = currOptions->m\_rawChainSize; \textcolor{comment}{// Ok to use rawChainSize}
3568 \textcolor{preprocessor}{#ifdef QUESO\_USES\_SEQUENCE\_STATISTICAL\_OPTIONS}
3569 \textcolor{preprocessor}{}        \textcolor{keywordtype}{bool}         savedRawChainComputeStats  = currOptions->m\_rawChainComputeStats;
3570 \textcolor{preprocessor}{#endif}
3571 \textcolor{preprocessor}{}        \textcolor{keywordtype}{bool}         savedFilteredChainGenerate = currOptions->m\_filteredChainGenerate;
3572         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} savedDrMaxNumExtraStages   = currOptions->m\_drMaxNumExtraStages;
3573         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} savedAmAdaptInterval       = currOptions->m\_amAdaptInterval;
3574 
3575         currOptions->m\_totallyMute = \textcolor{keyword}{true};
3576         \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 999999) \{
3577           currOptions->m\_totallyMute = \textcolor{keyword}{false};
3578         \}
3579         currOptions->m\_rawChainSize          = 0; \textcolor{comment}{// will be set inside generateXYZLinkedChains()}
3580 \textcolor{preprocessor}{#ifdef QUESO\_USES\_SEQUENCE\_STATISTICAL\_OPTIONS}
3581 \textcolor{preprocessor}{}        currOptions->m\_rawChainComputeStats  = \textcolor{keyword}{false};
3582 \textcolor{preprocessor}{#endif}
3583 \textcolor{preprocessor}{}        currOptions->m\_filteredChainGenerate = \textcolor{keyword}{false};
3584         currOptions->m\_drMaxNumExtraStages   = 0;
3585         currOptions->m\_amAdaptInterval       = 0;
3586 
3587         \textcolor{comment}{// KAUST: all nodes in 'subComm' should call here, important}
3588         \textcolor{keywordflow}{if} (useBalancedChains) \{
3589           \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a8e9d7681d17623c726814d206c8be4b2}{generateBalLinkedChains\_all}(*currOptions,       \textcolor{comment}{// input, only
       m\_rawChainSize changes}
3590                                       nowCovMatrix,       \textcolor{comment}{// input}
3591                                       currRv,             \textcolor{comment}{// input}
3592                                       nowBalLinkControl,  \textcolor{comment}{// input // Round Rock}
3593                                       nowChain,           \textcolor{comment}{// output}
3594                                       nowRunTime,         \textcolor{comment}{// output}
3595                                       nowRejections,      \textcolor{comment}{// output}
3596                                       NULL,               \textcolor{comment}{// output}
3597                                       NULL);              \textcolor{comment}{// output}
3598         \}
3599         \textcolor{keywordflow}{else} \{
3600           \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a04b0d797b321bb5c4047aab89a445e3c}{generateUnbLinkedChains\_all}(*currOptions,       \textcolor{comment}{// input, only
       m\_rawChainSize changes}
3601                                       nowCovMatrix,       \textcolor{comment}{// input}
3602                                       currRv,             \textcolor{comment}{// input}
3603                                       nowUnbLinkControl,  \textcolor{comment}{// input // Round Rock}
3604                                       indexOfFirstWeight, \textcolor{comment}{// input // Round Rock}
3605                                       prevChain,          \textcolor{comment}{// input // Round Rock}
3606                                       nowChain,           \textcolor{comment}{// output}
3607                                       nowRunTime,         \textcolor{comment}{// output}
3608                                       nowRejections,      \textcolor{comment}{// output}
3609                                       NULL,               \textcolor{comment}{// output}
3610                                       NULL);              \textcolor{comment}{// output}
3611         \}
3612 
3613         \textcolor{comment}{// KAUST: all nodes should call here}
3614         currOptions->m\_totallyMute           = savedTotallyMute;
3615         currOptions->m\_rawChainSize          = savedRawChainSize;
3616 \textcolor{preprocessor}{#ifdef QUESO\_USES\_SEQUENCE\_STATISTICAL\_OPTIONS}
3617 \textcolor{preprocessor}{}        currOptions->m\_rawChainComputeStats  = savedRawChainComputeStats;
3618 \textcolor{preprocessor}{#endif}
3619 \textcolor{preprocessor}{}        currOptions->m\_filteredChainGenerate = savedFilteredChainGenerate; \textcolor{comment}{// FIX ME}
3620         currOptions->m\_drMaxNumExtraStages   = savedDrMaxNumExtraStages;
3621         currOptions->m\_amAdaptInterval       = savedAmAdaptInterval;
3622 
3623         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < nowBalLinkControl.balLinkedChains.size(); ++i) \{
3624           \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(nowBalLinkControl.balLinkedChains[i].initialPosition == 
      NULL,
3625                               \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
3626                               \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all()"},
3627                               \textcolor{stringliteral}{"Initial position pointer in step 9 should not be NULL"});
3628           \textcolor{keyword}{delete} nowBalLinkControl.balLinkedChains[i].initialPosition;
3629           nowBalLinkControl.balLinkedChains[i].initialPosition = NULL;
3630         \}
3631         nowBalLinkControl.balLinkedChains.clear();
3632 
3633         \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{ \textcolor{comment}{// KAUST}
3634           \textcolor{comment}{// If only one cov matrix is used, then the rejection should be assessed among all inter0Comm
       nodes // KAUST3}
3635           \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nowUnifiedRejections = 0;
3636           \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &nowRejections, (\textcolor{keywordtype}{void} *) &
      nowUnifiedRejections, (\textcolor{keywordtype}{int}) 1, \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 
      \hyperlink{_mpi_comm_8h_afbf78d291c032aa7f512bc566cee2bd1}{RawValue\_MPI\_SUM},
3637                                        \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all()"},
3638                                        \textcolor{stringliteral}{"failed MPI.Allreduce() for now rejections"});
3639 
3640 \textcolor{preprocessor}{#if 0 // Round Rock 2009 12 29}
3641 \textcolor{preprocessor}{}          \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} tmpUnifiedNumSamples = 0;
3642           \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &tmpSubNumSamples, (\textcolor{keywordtype}{void} *) &
      tmpUnifiedNumSamples, (\textcolor{keywordtype}{int}) 1, \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 
      \hyperlink{_mpi_comm_8h_afbf78d291c032aa7f512bc566cee2bd1}{RawValue\_MPI\_SUM},
3643                                        \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all()"},
3644                                        \textcolor{stringliteral}{"failed MPI.Allreduce() for num samples in step 9"});
3645 \textcolor{preprocessor}{#endif}
3646 \textcolor{preprocessor}{}
3647           \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} tmpUnifiedNumSamples = originalSubNumSamples*\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_aa780721ae0fdeabc5a15e04cb0cad964}{NumProc}();
3648           nowRejectionRate = ((double) nowUnifiedRejections) / ((double) tmpUnifiedNumSamples);
3649 
3650           \textcolor{comment}{//bool aux1 = (nowRejectionRate == meanRejectionRate);}
3651           \textcolor{keywordtype}{bool} aux2 = (nowRejectionRate >= currOptions->m\_minRejectionRate)
3652                       &&
3653                       (nowRejectionRate <= currOptions->m\_maxRejectionRate);
3654           testResult = aux2;
3655 
3656           \textcolor{comment}{// Make sure all nodes in 'inter0Comm' have the same value of 'testResult'}
3657           \textcolor{keywordflow}{if} (\hyperlink{namespace_q_u_e_s_o_a4166a375c5adbea35afaaf20775bc519}{MiscCheckForSameValueInAllNodes}(testResult,
3658                                                 0., \textcolor{comment}{// kept 'zero' on 2010/03/03}
3659                                                 \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}(),
3660                                                 \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all(), step
       9, testResult"}) == \textcolor{keyword}{false}) \{
3661             \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3662               *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"WARNING, In
       MLSampling<P\_V,P\_M>::generateSequence()"}
3663                                       << \textcolor{stringliteral}{", level "}        << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3664                                       << \textcolor{stringliteral}{", step "}         << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3665                                       << \textcolor{stringliteral}{": nowAttempt = "} << nowAttempt
3666                                       << \textcolor{stringliteral}{", MiscCheck for 'testResult' detected a problem"}
3667                                       << std::endl;
3668             \}
3669     \}
3670         \} \textcolor{comment}{// if (m\_env.inter0Rank() >= 0) \{ // KAUST}
3671 
3672         \textcolor{comment}{// KAUST: all nodes in 'subComm' should have the same 'testResult'}
3673         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} tmpUint = (\textcolor{keywordtype}{unsigned} int) testResult;
3674         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &tmpUint, (\textcolor{keywordtype}{int}) 1, 
      \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 0, \textcolor{comment}{// Yes, 'subComm', important}
3675                               \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all()"},
3676                               \textcolor{stringliteral}{"failed MPI.Bcast() for testResult"});
3677         testResult = (bool) tmpUint;
3678 
3679         \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3680           *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In
       MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all()"}
3681                                   << \textcolor{stringliteral}{", level "}              << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3682                                   << \textcolor{stringliteral}{", step "}               << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3683                                   << \textcolor{stringliteral}{": in loop for assessing rejection rate"}
3684                                   << \textcolor{stringliteral}{", nowAttempt = "}       << nowAttempt
3685                                   << \textcolor{stringliteral}{", beforeEta = "}        << beforeEta
3686                                   << \textcolor{stringliteral}{", etas[0] = "}          << etas[0]
3687                                   << \textcolor{stringliteral}{", nowEta = "}           << nowEta
3688                                   << \textcolor{stringliteral}{", etas[1] = "}          << etas[1]
3689                                   << \textcolor{stringliteral}{", minRejectionRate = "} << currOptions->m\_minRejectionRate
3690                                   << \textcolor{stringliteral}{", nowRejectionRate = "} << nowRejectionRate
3691                                   << \textcolor{stringliteral}{", maxRejectionRate = "} << currOptions->m\_maxRejectionRate
3692                                   << std::endl;
3693         \}
3694         nowAttempt++;
3695 
3696         \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{ \textcolor{comment}{// KAUST}
3697           \textcolor{comment}{// Make sure all nodes in 'inter0Comm' have the same value of 'nowEta'}
3698           \textcolor{keywordflow}{if} (\hyperlink{namespace_q_u_e_s_o_a4166a375c5adbea35afaaf20775bc519}{MiscCheckForSameValueInAllNodes}(nowEta,
3699                                                 1.0e-16, \textcolor{comment}{// changed from 'zero' on 2009/11/dd}
3700                                                 \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}(),
3701                                                 \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all(), step
       9, nowEta"}) == \textcolor{keyword}{false}) \{
3702             \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3703               *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"WARNING, In
       MLSampling<P\_V,P\_M>::generateSequence()"}
3704                                       << \textcolor{stringliteral}{", level "}        << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3705                                       << \textcolor{stringliteral}{", step "}         << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3706                                       << \textcolor{stringliteral}{": nowAttempt = "} << nowAttempt
3707                                       << \textcolor{stringliteral}{", MiscCheck for 'nowEta' detected a problem"}
3708                                       << std::endl;
3709             \}
3710           \}
3711         \}
3712       \} \textcolor{keywordflow}{while} (testResult == \textcolor{keyword}{false});
3713       currEta = nowEta;
3714       \textcolor{keywordflow}{if} (currEta != 1.) \{
3715         unifiedCovMatrix *= currEta;
3716         \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_afbe27e6149562020663b72da6592d933}{m\_numDisabledParameters} > 0) \{ \textcolor{comment}{// gpmsa2}
3717           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} paramId = 0; paramId < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.
      \hyperlink{class_q_u_e_s_o_1_1_vector_space_a5829a1f4f996f8307c840b705144d666}{dimLocal}(); ++paramId) \{
3718             \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_ac76690384f70d74b8662faf7a051449e}{m\_parameterEnabledStatus}[paramId] == \textcolor{keyword}{false}) \{
3719               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a5829a1f4f996f8307c840b705144d666}{dimLocal}(); ++i) \{
3720                 unifiedCovMatrix(i,paramId) = 0.;
3721               \}
3722               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} j = 0; j < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a5829a1f4f996f8307c840b705144d666}{dimLocal}(); ++j) \{
3723                 unifiedCovMatrix(paramId,j) = 0.;
3724               \}
3725               unifiedCovMatrix(paramId,paramId) = 1.;
3726             \}
3727           \}
3728         \}
3729       \}
3730 
3731       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} quantity1 = weightSequence.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a52829afc95e5c36e9db44f40854153b0}{unifiedSequenceSize}(
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a67b0c3620662116f5a346fdaa5faf38e}{numOfProcsForStorage}() == 1);
3732       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3733         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In
       MLSampling<P\_V,P\_M>::generateSequence\_Step09\_all()"}
3734                                 << \textcolor{stringliteral}{", level "}                                  << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3735                                 << \textcolor{stringliteral}{", step "}                                   << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3736                                 << \textcolor{stringliteral}{": weightSequence.subSequenceSize() = "}     << weightSequence.
      \hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a0288ea295eedc216a1617b3286f6f3a0}{subSequenceSize}()
3737                                 << \textcolor{stringliteral}{", weightSequence.unifiedSequenceSize() = "} << quantity1
3738                                 << \textcolor{stringliteral}{", currEta = "}                              << currEta
3739                                 << \textcolor{stringliteral}{", assessed rejection rate = "}              << nowRejectionRate
3740                                 << std::endl;
3741       \}
3742     \}
3743 
3744   \textcolor{keywordtype}{double} stepRunTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalStep);
3745   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3746     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving MLSampling<P\_V,P\_M>::generateSequence\_Step()"}
3747                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3748                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3749                             << \textcolor{stringliteral}{", after "} << stepRunTime << \textcolor{stringliteral}{" seconds"}
3750                             << std::endl;
3751   \}
3752 
3753   \textcolor{keywordflow}{return};
3754 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a04322fda4c97eee6c6739fc007d642c1}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!generate\-Sequence\-\_\-\-Step10\-\_\-all@{generate\-Sequence\-\_\-\-Step10\-\_\-all}}
\index{generate\-Sequence\-\_\-\-Step10\-\_\-all@{generate\-Sequence\-\_\-\-Step10\-\_\-all}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{generate\-Sequence\-\_\-\-Step10\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Sequence\-\_\-\-Step10\-\_\-all (
\begin{DoxyParamCaption}
\item[{{\bf M\-L\-Sampling\-Level\-Options} \&}]{curr\-Options, }
\item[{const P\-\_\-\-M \&}]{unified\-Cov\-Matrix, }
\item[{const {\bf Generic\-Vector\-R\-V}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{curr\-Rv, }
\item[{bool}]{use\-Balanced\-Chains, }
\item[{const {\bf Unbalanced\-Linked\-Chains\-Per\-Node\-Struct} \&}]{unbalanced\-Link\-Control, }
\item[{unsigned int}]{index\-Of\-First\-Weight, }
\item[{const {\bf Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{prev\-Chain, }
\item[{const {\bf Balanced\-Linked\-Chains\-Per\-Node\-Struct}$<$ P\-\_\-\-V $>$ \&}]{balanced\-Link\-Control, }
\item[{{\bf Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{curr\-Chain, }
\item[{double \&}]{cumulative\-Raw\-Chain\-Run\-Time, }
\item[{unsigned int \&}]{cumulative\-Raw\-Chain\-Rejections, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ $\ast$}]{curr\-Log\-Likelihood\-Values, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ $\ast$}]{curr\-Log\-Target\-Values}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a04322fda4c97eee6c6739fc007d642c1}


Samples the vector R\-V of current level (Step 10 from M\-L algorithm). 

This method is responsible for the Step 10 in the M\-L algorithm implemented/described in the method \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a8d7296b30623c73ada38971cae27994a}{M\-L\-Sampling$<$\-P\-\_\-\-V,\-P\-\_\-\-M$>$\-::generate\-Sequence}.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em curr\-Options,unified\-Cov\-Matrix,curr\-Rv,use\-Balanced\-Chains,unbalanced\-Link\-Control,index\-Of\-First\-Weight,prev\-Chain,balanced\-Link\-Control} & \\
\hline
\mbox{\tt out}  & {\em curr\-Chain,cumulative\-Raw\-Chain\-Run\-Time,cumulative\-Raw\-Chain\-Rejections,curr\-Log\-Likelihood\-Values,curr\-Log\-Target\-Values} & \\
\hline
\end{DoxyParams}


Definition at line 3758 of file M\-L\-Sampling.\-C.



References L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-filtered\-Chain\-Generate, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-raw\-Chain\-Size, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-totally\-Mute, Q\-U\-E\-S\-O\-::\-Misc\-Get\-Ellapsed\-Seconds(), and Q\-U\-E\-S\-O\-::\-U\-Q\-\_\-\-O\-K\-\_\-\-R\-C.


\begin{DoxyCode}
3772 \{
3773   \textcolor{keywordtype}{int} iRC = \hyperlink{namespace_q_u_e_s_o_a8e909502900aecf24cedba022ea84471}{UQ\_OK\_RC};
3774   \textcolor{keyword}{struct }timeval timevalStep;
3775   iRC = gettimeofday(&timevalStep, NULL);
3776   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
3777 
3778       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3779         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
3780                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3781                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3782                                 << \textcolor{stringliteral}{": beginning step 10 of 11"}
3783                                 << \textcolor{stringliteral}{", currLogLikelihoodValues = "} << currLogLikelihoodValues
3784                                 << std::endl;
3785       \}
3786 
3787       \textcolor{comment}{// All nodes should call here}
3788       \textcolor{keywordtype}{bool}         savedTotallyMute           = currOptions.m\_totallyMute; \textcolor{comment}{// HERE - ENHANCEMENT}
3789       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} savedRawChainSize          = currOptions.m\_rawChainSize; \textcolor{comment}{// Ok to use rawChainSize}
3790 \textcolor{preprocessor}{#ifdef QUESO\_USES\_SEQUENCE\_STATISTICAL\_OPTIONS}
3791 \textcolor{preprocessor}{}      \textcolor{keywordtype}{bool}         savedRawChainComputeStats  = currOptions.m\_rawChainComputeStats;
3792 \textcolor{preprocessor}{#endif}
3793 \textcolor{preprocessor}{}      \textcolor{keywordtype}{bool}         savedFilteredChainGenerate = currOptions.m\_filteredChainGenerate;
3794 
3795       currOptions.m\_totallyMute = \textcolor{keyword}{true};
3796       \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 999999) \{
3797         currOptions.m\_totallyMute = \textcolor{keyword}{false};
3798       \}
3799       currOptions.m\_rawChainSize          = 0; \textcolor{comment}{// will be set inside generateXYZLinkedChains()}
3800 \textcolor{preprocessor}{#ifdef QUESO\_USES\_SEQUENCE\_STATISTICAL\_OPTIONS}
3801 \textcolor{preprocessor}{}      currOptions.m\_rawChainComputeStats  = \textcolor{keyword}{false};
3802 \textcolor{preprocessor}{#endif}
3803 \textcolor{preprocessor}{}      currOptions.m\_filteredChainGenerate = \textcolor{keyword}{false};
3804 
3805       \textcolor{comment}{// All nodes should call here}
3806       \textcolor{keywordflow}{if} (useBalancedChains) \{
3807         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a8e9d7681d17623c726814d206c8be4b2}{generateBalLinkedChains\_all}(currOptions,                  \textcolor{comment}{// input, only
       m\_rawChainSize changes}
3808                                     unifiedCovMatrix,             \textcolor{comment}{// input}
3809                                     currRv,                       \textcolor{comment}{// input}
3810                                     balancedLinkControl,          \textcolor{comment}{// input // Round Rock}
3811                                     currChain,                    \textcolor{comment}{// output}
3812                                     cumulativeRawChainRunTime,    \textcolor{comment}{// output}
3813                                     cumulativeRawChainRejections, \textcolor{comment}{// output}
3814                                     currLogLikelihoodValues,      \textcolor{comment}{// output // likelihood is important}
3815                                     currLogTargetValues);         \textcolor{comment}{// output}
3816       \}
3817       \textcolor{keywordflow}{else} \{
3818         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a04b0d797b321bb5c4047aab89a445e3c}{generateUnbLinkedChains\_all}(currOptions,                  \textcolor{comment}{// input, only
       m\_rawChainSize changes}
3819                                     unifiedCovMatrix,             \textcolor{comment}{// input}
3820                                     currRv,                       \textcolor{comment}{// input}
3821                                     unbalancedLinkControl,        \textcolor{comment}{// input // Round Rock}
3822                                     indexOfFirstWeight,           \textcolor{comment}{// input // Round Rock}
3823                                     prevChain,                    \textcolor{comment}{// input // Round Rock}
3824                                     currChain,                    \textcolor{comment}{// output}
3825                                     cumulativeRawChainRunTime,    \textcolor{comment}{// output}
3826                                     cumulativeRawChainRejections, \textcolor{comment}{// output}
3827                                     currLogLikelihoodValues,      \textcolor{comment}{// output // likelihood is important}
3828                                     currLogTargetValues);         \textcolor{comment}{// output}
3829       \}
3830 
3831       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3832         \textcolor{keywordtype}{double} tmpValue = INFINITY;
3833         \textcolor{keywordflow}{if} (currLogLikelihoodValues) tmpValue = (*currLogLikelihoodValues)[0];
3834         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence\_Step()"}
3835                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3836                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3837                                 << \textcolor{stringliteral}{", after chain generatrion"}
3838                                 << \textcolor{stringliteral}{", currLogLikelihoodValues[0] = "} << tmpValue
3839                                 << std::endl;
3840       \}
3841 
3842       \textcolor{comment}{// All nodes should call here}
3843       currOptions.m\_totallyMute           = savedTotallyMute;
3844       currOptions.m\_rawChainSize          = savedRawChainSize;
3845 \textcolor{preprocessor}{#ifdef QUESO\_USES\_SEQUENCE\_STATISTICAL\_OPTIONS}
3846 \textcolor{preprocessor}{}      currOptions.m\_rawChainComputeStats  = savedRawChainComputeStats;
3847 \textcolor{preprocessor}{#endif}
3848 \textcolor{preprocessor}{}      currOptions.m\_filteredChainGenerate = savedFilteredChainGenerate; \textcolor{comment}{// FIX ME}
3849 
3850   \textcolor{keywordtype}{double} stepRunTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalStep);
3851   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3852     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving MLSampling<P\_V,P\_M>::generateSequence\_Step()"}
3853                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3854                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3855                             << \textcolor{stringliteral}{", after "} << stepRunTime << \textcolor{stringliteral}{" seconds"}
3856                             << std::endl;
3857   \}
3858 
3859   \textcolor{keywordflow}{return};
3860 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_aae527304bc1012a91ffc396e94fbab11}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!generate\-Sequence\-\_\-\-Step11\-\_\-inter0@{generate\-Sequence\-\_\-\-Step11\-\_\-inter0}}
\index{generate\-Sequence\-\_\-\-Step11\-\_\-inter0@{generate\-Sequence\-\_\-\-Step11\-\_\-inter0}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{generate\-Sequence\-\_\-\-Step11\-\_\-inter0}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Sequence\-\_\-\-Step11\-\_\-inter0 (
\begin{DoxyParamCaption}
\item[{const {\bf M\-L\-Sampling\-Level\-Options} $\ast$}]{curr\-Options, }
\item[{unsigned int}]{unified\-Requested\-Num\-Samples, }
\item[{unsigned int}]{cumulative\-Raw\-Chain\-Rejections, }
\item[{{\bf Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{curr\-Chain, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ \&}]{curr\-Log\-Likelihood\-Values, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ \&}]{curr\-Log\-Target\-Values, }
\item[{unsigned int \&}]{unified\-Number\-Of\-Rejections}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_aae527304bc1012a91ffc396e94fbab11}


Filters chain (Step 11 from M\-L algorithm). 

This method is responsible for the Step 11 in the M\-L algorithm implemented/described in the method \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a8d7296b30623c73ada38971cae27994a}{M\-L\-Sampling$<$\-P\-\_\-\-V,\-P\-\_\-\-M$>$\-::generate\-Sequence}.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em curr\-Options,unified\-Requested\-Num\-Samples,cumulative\-Raw\-Chain\-Rejections,@param\mbox{[}in,out\mbox{]}} & curr\-Chain, curr\-Log\-Likelihood\-Values, curr\-Log\-Target\-Values \\
\hline
\mbox{\tt out}  & {\em unified\-Number\-Of\-Rejections} & \\
\hline
\end{DoxyParams}


Definition at line 3864 of file M\-L\-Sampling.\-C.



References Q\-U\-E\-S\-O\-::\-Base\-Vector\-Sequence$<$ V, M $>$\-::compute\-Filter\-Params(), Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::filter(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::filter(), L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-data\-Output\-Allowed\-Set, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-data\-Output\-File\-Name, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-filtered\-Chain\-Data\-Output\-File\-Name, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-filtered\-Chain\-Data\-Output\-File\-Type, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-filtered\-Chain\-Discarded\-Portion, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-filtered\-Chain\-Generate, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-filtered\-Chain\-Lag, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-prefix, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-raw\-Chain\-Data\-Output\-File\-Name, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-raw\-Chain\-Data\-Output\-File\-Type, Q\-U\-E\-S\-O\-::\-Misc\-Get\-Ellapsed\-Seconds(), Q\-U\-E\-S\-O\-::\-File\-Ptr\-Set\-Struct\-::ofs\-Var, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-S\-U\-M, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-U\-N\-S\-I\-G\-N\-E\-D, Q\-U\-E\-S\-O\-::\-Base\-Vector\-Sequence$<$ V, M $>$\-::set\-Name(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::set\-Name(), Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::sub\-Sequence\-Size(), Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::unified\-Write\-Contents(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::unified\-Write\-Contents(), U\-Q\-\_\-\-F\-A\-T\-A\-L\-\_\-\-T\-E\-S\-T\-\_\-\-M\-A\-C\-R\-O, U\-Q\-\_\-\-F\-I\-L\-E\-\_\-\-E\-X\-T\-E\-N\-S\-I\-O\-N\-\_\-\-F\-O\-R\-\_\-\-M\-A\-T\-L\-A\-B\-\_\-\-F\-O\-R\-M\-A\-T, U\-Q\-\_\-\-M\-H\-\_\-\-S\-G\-\_\-\-F\-I\-L\-E\-N\-A\-M\-E\-\_\-\-F\-O\-R\-\_\-\-N\-O\-\_\-\-F\-I\-L\-E, and Q\-U\-E\-S\-O\-::\-U\-Q\-\_\-\-O\-K\-\_\-\-R\-C.


\begin{DoxyCode}
3872 \{
3873   \textcolor{keywordtype}{int} iRC = \hyperlink{namespace_q_u_e_s_o_a8e909502900aecf24cedba022ea84471}{UQ\_OK\_RC};
3874   \textcolor{keyword}{struct }timeval timevalStep;
3875   iRC = gettimeofday(&timevalStep, NULL);
3876   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
3877 
3878   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3879     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence()"}
3880                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3881                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3882                             << \textcolor{stringliteral}{": beginning step 11 of 11"}
3883                             << std::endl;
3884   \}
3885 
3886   \textcolor{comment}{//if (m\_env.subComm().MyPID() == 0) std::cout << "Aqui 000" << std::endl;}
3887 
3888 \textcolor{preprocessor}{#ifdef QUESO\_USES\_SEQUENCE\_STATISTICAL\_OPTIONS}
3889 \textcolor{preprocessor}{}  \textcolor{keywordflow}{if} (currOptions->m\_rawChainComputeStats) \{
3890     FilePtrSetStruct filePtrSet;
3891     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ab8fe853074f12ea34e18724119a2fc75}{openOutputFile}(currOptions->m\_dataOutputFileName,
3892                          \hyperlink{_defines_8h_ac440026eff7deb1c1eed1eea0e8e36ba}{UQ\_FILE\_EXTENSION\_FOR\_MATLAB\_FORMAT}, \textcolor{comment}{// Yes,
       always ".m"}
3893                          currOptions->m\_dataOutputAllowedSet,
3894                          \textcolor{keyword}{false},
3895                          filePtrSet);
3896 
3897     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 10)) \{ \textcolor{comment}{// output debug}
3898       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence\_Step()"}
3899                               << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3900                               << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3901                               << \textcolor{stringliteral}{", calling computeStatistics for raw chain"}
3902                               << \textcolor{stringliteral}{". Ofstream pointer value = "} << filePtrSet.ofsVar
3903                               << \textcolor{stringliteral}{", statistical options are"}
3904                               << \textcolor{stringliteral}{"\(\backslash\)n"} << *currOptions->m\_rawChainStatisticalOptionsObj
3905                               << std::endl;
3906     \}
3907     \textcolor{comment}{//m\_env.syncPrintDebugMsg("At step 11, calling computeStatistics for raw
       chain",1,10,m\_env.inter0Comm()); // output debug}
3908     currChain.computeStatistics(*currOptions->m\_rawChainStatisticalOptionsObj,
3909                                 filePtrSet.ofsVar);
3910 
3911     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ab712bff194ddd91459d4ea8715c77e8b}{closeFile}(filePtrSet,\hyperlink{_defines_8h_ac440026eff7deb1c1eed1eea0e8e36ba}{UQ\_FILE\_EXTENSION\_FOR\_MATLAB\_FORMAT}
      );
3912   \}
3913   \textcolor{comment}{// Compute MLE and MAP}
3914   \textcolor{comment}{// rr0}
3915 \textcolor{preprocessor}{#endif}
3916 \textcolor{preprocessor}{}  \textcolor{keywordflow}{if} (currOptions->m\_rawChainDataOutputFileName != \hyperlink{_metropolis_hastings_s_g_options_8h_a75699ceb938d800e2b7f59ede3ea9a31}{UQ\_MH\_SG\_FILENAME\_FOR\_NO\_FILE}
      ) \{
3917     currChain.unifiedWriteContents(currOptions->m\_rawChainDataOutputFileName,
3918                                    currOptions->m\_rawChainDataOutputFileType); \textcolor{comment}{// KAUST5}
3919     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
3920       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence\_Step()"}
3921                               << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3922                               << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3923                               << \textcolor{stringliteral}{", before calling currLogLikelihoodValues.unifiedWriteContents()"}
3924                               << \textcolor{stringliteral}{", currLogLikelihoodValues[0] = "} << currLogLikelihoodValues[0]
3925                               << std::endl;
3926     \}
3927     currLogLikelihoodValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a2f832dd5eda37df06eb52650ab8ce733}{unifiedWriteContents}(currOptions->
      m\_rawChainDataOutputFileName,
3928                                                  currOptions->m\_rawChainDataOutputFileType);
3929     currLogTargetValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a2f832dd5eda37df06eb52650ab8ce733}{unifiedWriteContents}    (currOptions->
      m\_rawChainDataOutputFileName,
3930                                                  currOptions->m\_rawChainDataOutputFileType);
3931   \}
3932 
3933   \textcolor{keywordflow}{if} (currOptions->m\_filteredChainGenerate) \{
3934     FilePtrSetStruct filePtrSet;
3935     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ab8fe853074f12ea34e18724119a2fc75}{openOutputFile}(currOptions->m\_dataOutputFileName,
3936                          \hyperlink{_defines_8h_ac440026eff7deb1c1eed1eea0e8e36ba}{UQ\_FILE\_EXTENSION\_FOR\_MATLAB\_FORMAT}, \textcolor{comment}{// Yes,
       always ".m"}
3937                          currOptions->m\_dataOutputAllowedSet,
3938                          \textcolor{keyword}{false},
3939                          filePtrSet);
3940 
3941     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} filterInitialPos = (\textcolor{keywordtype}{unsigned} int) (currOptions->m\_filteredChainDiscardedPortion * (\textcolor{keywordtype}{double})
       currChain.subSequenceSize());
3942     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} filterSpacing    = currOptions->m\_filteredChainLag;
3943     \textcolor{keywordflow}{if} (filterSpacing == 0) \{
3944       currChain.computeFilterParams(filePtrSet.ofsVar,
3945                                     filterInitialPos,
3946                                     filterSpacing);
3947     \}
3948 
3949     \textcolor{comment}{// Filter positions from the converged portion of the chain}
3950     currChain.filter(filterInitialPos,
3951                      filterSpacing);
3952     currChain.setName(currOptions->m\_prefix + \textcolor{stringliteral}{"filtChain"});
3953 
3954     currLogLikelihoodValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_aaf386a04a0cebd7f88c5b7694a5fd3d1}{filter}(filterInitialPos,
3955                                    filterSpacing);
3956     currLogLikelihoodValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a198b72423333bc5aa1722b830b64a263}{setName}(currOptions->m\_prefix + \textcolor{stringliteral}{"filtLogLikelihood"});
3957 
3958     currLogTargetValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_aaf386a04a0cebd7f88c5b7694a5fd3d1}{filter}(filterInitialPos,
3959                                filterSpacing);
3960     currLogTargetValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a198b72423333bc5aa1722b830b64a263}{setName}(currOptions->m\_prefix + \textcolor{stringliteral}{"filtLogTarget"});
3961 
3962 \textcolor{preprocessor}{#ifdef QUESO\_USES\_SEQUENCE\_STATISTICAL\_OPTIONS}
3963 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (currOptions->m\_filteredChainComputeStats) \{
3964       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 10)) \{ \textcolor{comment}{// output debug}
3965         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateSequence\_Step()"}
3966                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
3967                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
3968                                 << \textcolor{stringliteral}{", calling computeStatistics for filtered chain"}
3969                                 << \textcolor{stringliteral}{". Ofstream pointer value = "} << filePtrSet.ofsVar
3970                                 << \textcolor{stringliteral}{", statistical options are"}
3971                                 << \textcolor{stringliteral}{"\(\backslash\)n"} << *currOptions->m\_rawChainStatisticalOptionsObj
3972                                 << std::endl;
3973       \}
3974 
3975       \textcolor{comment}{//m\_env.syncPrintDebugMsg("At step 11, calling computeStatistics for filtered
       chain",1,10,m\_env.inter0Comm()); // output debug}
3976       currChain.computeStatistics(*currOptions->m\_filteredChainStatisticalOptionsObj,
3977                                   filePtrSet.ofsVar);
3978 
3979     \}
3980 \textcolor{preprocessor}{#endif}
3981 \textcolor{preprocessor}{}    \textcolor{comment}{// Compute MLE and MAP}
3982     \textcolor{comment}{// rr0}
3983     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ab712bff194ddd91459d4ea8715c77e8b}{closeFile}(filePtrSet,\hyperlink{_defines_8h_ac440026eff7deb1c1eed1eea0e8e36ba}{UQ\_FILE\_EXTENSION\_FOR\_MATLAB\_FORMAT}
      );
3984 
3985     \textcolor{keywordflow}{if} (currOptions->m\_filteredChainDataOutputFileName != 
      \hyperlink{_metropolis_hastings_s_g_options_8h_a75699ceb938d800e2b7f59ede3ea9a31}{UQ\_MH\_SG\_FILENAME\_FOR\_NO\_FILE}) \{
3986       currChain.unifiedWriteContents              (currOptions->m\_filteredChainDataOutputFileName,
3987                                                    currOptions->m\_filteredChainDataOutputFileType);
3988       currLogLikelihoodValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a2f832dd5eda37df06eb52650ab8ce733}{unifiedWriteContents}(currOptions->
      m\_filteredChainDataOutputFileName,
3989                                                    currOptions->m\_filteredChainDataOutputFileType);
3990       currLogTargetValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a2f832dd5eda37df06eb52650ab8ce733}{unifiedWriteContents}    (currOptions->
      m\_filteredChainDataOutputFileName,
3991                                                    currOptions->m\_filteredChainDataOutputFileType);
3992     \}
3993   \} \textcolor{comment}{// if (currOptions->m\_filteredChainGenerate)}
3994 
3995   \textcolor{keywordflow}{if} (currOptions->m\_filteredChainGenerate) \{
3996     \textcolor{comment}{// Do not check}
3997   \}
3998   \textcolor{keywordflow}{else} \{
3999     \textcolor{comment}{// Check if unified size of generated chain matches the unified requested size // KAUST}
4000     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} tmpSize = currChain.subSequenceSize();
4001     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} unifiedGeneratedNumSamples = 0;
4002     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &tmpSize, (\textcolor{keywordtype}{void} *) &
      unifiedGeneratedNumSamples, (\textcolor{keywordtype}{int}) 1, \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, \hyperlink{_mpi_comm_8h_afbf78d291c032aa7f512bc566cee2bd1}{RawValue\_MPI\_SUM},
4003                                  \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
4004                                  \textcolor{stringliteral}{"failed MPI.Allreduce() for generated num samples in step 11"});
4005     \textcolor{comment}{//std::cout << "unifiedGeneratedNumSamples = "   << unifiedGeneratedNumSamples}
4006     \textcolor{comment}{//          << ", unifiedRequestedNumSamples = " << unifiedRequestedNumSamples}
4007     \textcolor{comment}{//          << std::endl;}
4008     \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(unifiedGeneratedNumSamples != unifiedRequestedNumSamples,
4009                         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
4010                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
4011                         \textcolor{stringliteral}{"currChain (linked one) has been generated with invalid size"});
4012   \}
4013 
4014   \textcolor{comment}{// Compute unified number of rejections}
4015   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &cumulativeRawChainRejections, (\textcolor{keywordtype}{void} *) &
      unifiedNumberOfRejections, (\textcolor{keywordtype}{int}) 1, \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 
      \hyperlink{_mpi_comm_8h_afbf78d291c032aa7f512bc566cee2bd1}{RawValue\_MPI\_SUM},
4016                                \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateSequence()"},
4017                                \textcolor{stringliteral}{"failed MPI.Allreduce() for number of rejections"});
4018 
4019   \textcolor{keywordtype}{double} stepRunTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalStep);
4020   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
4021     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving MLSampling<P\_V,P\_M>::generateSequence\_Step()"}
4022                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
4023                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
4024                             << \textcolor{stringliteral}{", after "} << stepRunTime << \textcolor{stringliteral}{" seconds"}
4025                             << std::endl;
4026   \}
4027 
4028   \textcolor{keywordflow}{return};
4029 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a04b0d797b321bb5c4047aab89a445e3c}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!generate\-Unb\-Linked\-Chains\-\_\-all@{generate\-Unb\-Linked\-Chains\-\_\-all}}
\index{generate\-Unb\-Linked\-Chains\-\_\-all@{generate\-Unb\-Linked\-Chains\-\_\-all}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{generate\-Unb\-Linked\-Chains\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Unb\-Linked\-Chains\-\_\-all (
\begin{DoxyParamCaption}
\item[{{\bf M\-L\-Sampling\-Level\-Options} \&}]{input\-Options, }
\item[{const P\-\_\-\-M \&}]{unified\-Cov\-Matrix, }
\item[{const {\bf Generic\-Vector\-R\-V}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{rv, }
\item[{const {\bf Unbalanced\-Linked\-Chains\-Per\-Node\-Struct} \&}]{unbalanced\-Link\-Control, }
\item[{unsigned int}]{index\-Of\-First\-Weight, }
\item[{const {\bf Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{prev\-Chain, }
\item[{{\bf Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{working\-Chain, }
\item[{double \&}]{cumulative\-Run\-Time, }
\item[{unsigned int \&}]{cumulative\-Rejections, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ $\ast$}]{curr\-Log\-Likelihood\-Values, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ $\ast$}]{curr\-Log\-Target\-Values}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a04b0d797b321bb5c4047aab89a445e3c}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em input\-Options,unified\-Cov\-Matrix,rv,unbalanced\-Link\-Control,index\-Of\-First\-Weight,prev\-Chain} & \\
\hline
\mbox{\tt out}  & {\em working\-Chain,cumulative\-Run\-Time,cumulative\-Rejections,curr\-Log\-Likelihood\-Values,curr\-Log\-Target\-Values} & \\
\hline
\end{DoxyParams}


Definition at line 890 of file M\-L\-Sampling.\-C.



References Q\-U\-E\-S\-O\-::\-Base\-Vector\-Sequence$<$ V, M $>$\-::append(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::append(), Q\-U\-E\-S\-O\-::\-Metropolis\-Hastings\-S\-G$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::generate\-Sequence(), Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::get\-Position\-Values(), Q\-U\-E\-S\-O\-::\-Metropolis\-Hastings\-S\-G$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::get\-Raw\-Chain\-Info(), L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-raw\-Chain\-Size, Q\-U\-E\-S\-O\-::\-Misc\-Get\-Ellapsed\-Seconds(), Q\-U\-E\-S\-O\-::\-M\-H\-Raw\-Chain\-Info\-Struct\-::num\-Rejections, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-M\-A\-X, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-M\-I\-N, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-S\-U\-M, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-U\-N\-S\-I\-G\-N\-E\-D, Q\-U\-E\-S\-O\-::\-M\-H\-Raw\-Chain\-Info\-Struct\-::run\-Time, Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::sub\-Sequence\-Size(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::sub\-Sequence\-Size(), and Q\-U\-E\-S\-O\-::\-Unbalanced\-Linked\-Chains\-Per\-Node\-Struct\-::unb\-Linked\-Chains.


\begin{DoxyCode}
902 \{
903   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
904 
905   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
906     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Entering
       MLSampling<P\_V,P\_M>::generateUnbLinkedChains\_all()"}
907                             << \textcolor{stringliteral}{": unbalancedLinkControl.unbLinkedChains.size() = "} << unbalancedLinkControl
      .unbLinkedChains.size()
908                             << \textcolor{stringliteral}{", indexOfFirstWeight = "}                           << indexOfFirstWeight
909                             << std::endl;
910   \}
911 
912   P\_V auxInitialPosition(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a92e963bb5cab3eecd290dfe4b8f03b04}{zeroVector}());
913 
914   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} chainIdMax = 0;
915   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
916     chainIdMax = unbalancedLinkControl.unbLinkedChains.size();
917   \}
918   \textcolor{comment}{// KAUST: all nodes in 'subComm' should have the same 'chainIdMax'}
919   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &chainIdMax, (\textcolor{keywordtype}{int}) 1, 
      \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 0, \textcolor{comment}{// Yes, 'subComm', important}
920                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateUnbLinkedChains\_all()"},
921                         \textcolor{stringliteral}{"failed MPI.Bcast() for chainIdMax"});
922 
923   \textcolor{keyword}{struct }timeval timevalEntering;
924   \textcolor{keywordtype}{int} iRC = 0;
925   iRC = gettimeofday(&timevalEntering, NULL);
926   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
927 
928   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
929     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} numberOfPositions = 0;
930     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} chainId = 0; chainId < chainIdMax; ++chainId) \{
931       numberOfPositions += unbalancedLinkControl.unbLinkedChains[chainId].numberOfPositions;
932     \}
933 
934     std::vector<unsigned int> auxBuf(1,0);
935 
936     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} minNumberOfPositions = 0;
937     auxBuf[0] = numberOfPositions;
938     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &auxBuf[0], (\textcolor{keywordtype}{void} *) &
      minNumberOfPositions, (\textcolor{keywordtype}{int}) auxBuf.size(), \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 
      \hyperlink{_mpi_comm_8h_a8e30f42fdac116861205e83e2aa18042}{RawValue\_MPI\_MIN},
939                                  \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateUnbLinkedChains\_all()"},
940                                  \textcolor{stringliteral}{"failed MPI.Allreduce() for min"});
941 
942     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} maxNumberOfPositions = 0;
943     auxBuf[0] = numberOfPositions;
944     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &auxBuf[0], (\textcolor{keywordtype}{void} *) &
      maxNumberOfPositions, (\textcolor{keywordtype}{int}) auxBuf.size(), \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 
      \hyperlink{_mpi_comm_8h_a68f3ac7ff71a6504e236b0c95de78178}{RawValue\_MPI\_MAX},
945                                  \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateUnbLinkedChains\_all()"},
946                                  \textcolor{stringliteral}{"failed MPI.Allreduce() for max"});
947 
948     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} sumNumberOfPositions = 0;
949     auxBuf[0] = numberOfPositions;
950     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &auxBuf[0], (\textcolor{keywordtype}{void} *) &
      sumNumberOfPositions, (\textcolor{keywordtype}{int}) auxBuf.size(), \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 
      \hyperlink{_mpi_comm_8h_afbf78d291c032aa7f512bc566cee2bd1}{RawValue\_MPI\_SUM},
951                                  \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateUnbLinkedChains\_all()"},
952                                  \textcolor{stringliteral}{"failed MPI.Allreduce() for sum"});
953 
954     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
955       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"KEY In
       MLSampling<P\_V,P\_M>::generateUnbLinkedChains\_all()"}
956                               << \textcolor{stringliteral}{", level "}               << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
957                               << \textcolor{stringliteral}{", step "}                << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
958                               << \textcolor{stringliteral}{": chainIdMax = "}        << chainIdMax
959                               << \textcolor{stringliteral}{", numberOfPositions = "} << numberOfPositions
960                               << \textcolor{stringliteral}{", at "}                  << ctime(&timevalEntering.tv\_sec)
961                               << std::endl;
962       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"KEY In
       MLSampling<P\_V,P\_M>::generateUnbLinkedChains\_all()"}
963                               << \textcolor{stringliteral}{", level "}                  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
964                               << \textcolor{stringliteral}{", step "}                   << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
965                               << \textcolor{stringliteral}{": minNumberOfPositions = "} << minNumberOfPositions
966                               << \textcolor{stringliteral}{", avgNumberOfPositions = "} << ((double) sumNumberOfPositions)/((double) 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_aa780721ae0fdeabc5a15e04cb0cad964}{NumProc}())
967                               << \textcolor{stringliteral}{", maxNumberOfPositions = "} << maxNumberOfPositions
968                               << std::endl;
969     \}
970   \}
971   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_abdd5cd35419283c33cc40a77d0f4f07f}{m\_debugExponent} == 1.) &&
972       (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}      == 10)) \{
973     \textcolor{comment}{//m\_env.setExceptionalCircumstance(true);}
974   \}
975   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} cumulativeNumPositions = 0;
976   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} chainId = 0; chainId < chainIdMax; ++chainId) \{
977     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} tmpChainSize = 0;
978     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
979       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} auxIndex = unbalancedLinkControl.unbLinkedChains[chainId].
      initialPositionIndexInPreviousChain - indexOfFirstWeight; \textcolor{comment}{// KAUST4 // Round Rock}
980       prevChain.getPositionValues(auxIndex,auxInitialPosition); \textcolor{comment}{// Round Rock}
981       tmpChainSize = unbalancedLinkControl.unbLinkedChains[chainId].numberOfPositions+1; \textcolor{comment}{// IMPORTANT: '+1'
       in order to discard initial position afterwards}
982       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()       ) &&
983           (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 3)) \{
984         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In
       MLSampling<P\_V,P\_M>::generateUnbLinkedChains\_all()"}
985                                 << \textcolor{stringliteral}{", level "}            << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
986                                 << \textcolor{stringliteral}{", step "}             << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
987                                 << \textcolor{stringliteral}{", chainId = "}        << chainId
988                                 << \textcolor{stringliteral}{" < "}                 << chainIdMax
989                                 << \textcolor{stringliteral}{": begin generating "} << tmpChainSize
990                                 << \textcolor{stringliteral}{" chain positions"}
991                                 << std::endl;
992       \}
993     \}
994     auxInitialPosition.mpiBcast(0, \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}()); \textcolor{comment}{// Yes, 'subComm', important // KAUST}
995 \textcolor{preprocessor}{#if 0 // For debug only}
996 \textcolor{preprocessor}{}    \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} r = 0; r < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_aa780721ae0fdeabc5a15e04cb0cad964}{NumProc}(); ++r) \{
997       \textcolor{keywordflow}{if} (r == \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_ab806f80f206210723fcb4df8185a55a8}{MyPID}()) \{
998   std::cout << \textcolor{stringliteral}{"Vector 'auxInitialPosition at rank "} << r
999                   << \textcolor{stringliteral}{" has contents "}                      << auxInitialPosition
1000                   << std::endl;
1001       \}
1002       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
1003     \}
1004     sleep(1);
1005 \textcolor{preprocessor}{#endif}
1006 \textcolor{preprocessor}{}
1007     \textcolor{comment}{// KAUST: all nodes in 'subComm' should have the same 'tmpChainSize'}
1008     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_affe39f53e3d5d678842413370af09145}{subComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &tmpChainSize, (\textcolor{keywordtype}{int}) 1, 
      \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 0, \textcolor{comment}{// Yes, 'subComm', important}
1009                           \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::generateUnbLinkedChains\_all()"},
1010                           \textcolor{stringliteral}{"failed MPI.Bcast() for tmpChainSize"});
1011 
1012     inputOptions.m\_rawChainSize = tmpChainSize;
1013     SequenceOfVectors<P\_V,P\_M> tmpChain(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace},
1014                                                0,
1015                                                \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_options_a1d3d48598e0b59b46337ce66a52671a5}{m\_prefix}+\textcolor{stringliteral}{"tmp\_chain"});
1016     ScalarSequence<double> tmpLogLikelihoodValues(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env},0,\textcolor{stringliteral}{""});
1017     ScalarSequence<double> tmpLogTargetValues    (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env},0,\textcolor{stringliteral}{""});
1018 
1019     \textcolor{comment}{// KAUST: all nodes should call here}
1020     MetropolisHastingsSG<P\_V,P\_M> mcSeqGenerator(inputOptions,
1021                                                         rv,
1022                                                         auxInitialPosition, \textcolor{comment}{// KEY new: pass logPrior and
       logLikelihood}
1023                                                         &unifiedCovMatrix);
1024 
1025     \textcolor{comment}{// KAUST: all nodes should call here}
1026     mcSeqGenerator.generateSequence(tmpChain,
1027                                     &tmpLogLikelihoodValues, \textcolor{comment}{// likelihood is IMPORTANT}
1028                                     &tmpLogTargetValues);
1029     MHRawChainInfoStruct mcRawInfo;
1030     mcSeqGenerator.getRawChainInfo(mcRawInfo);
1031     cumulativeRunTime    += mcRawInfo.runTime;
1032     cumulativeRejections += mcRawInfo.numRejections;
1033 
1034     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() >= 0) \{
1035       \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_af0bc451b18302cfd5ee747c321e1c6e5}{exceptionalCircumstance}()) \{
1036         \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()       ) &&
1037             (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{ \textcolor{comment}{// detailed output debug}
1038           P\_V tmpVec(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a92e963bb5cab3eecd290dfe4b8f03b04}{zeroVector}());
1039           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < tmpLogLikelihoodValues.subSequenceSize(); ++i) \{
1040             tmpChain.getPositionValues(i,tmpVec);
1041             *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"DEBUG finalChain["} << cumulativeNumPositions+i <
      < \textcolor{stringliteral}{"] "}
1042                                     << \textcolor{stringliteral}{"= tmpChain["}               << i << \textcolor{stringliteral}{"] = "} << tmpVec
1043                                     << \textcolor{stringliteral}{", tmpLogLikelihoodValues["} << i << \textcolor{stringliteral}{"] = "} << tmpLogLikelihoodValues
      [i]
1044                                     << \textcolor{stringliteral}{", tmpLogTargetValues["}     << i << \textcolor{stringliteral}{"] = "} << tmpLogTargetValues[i]
1045                                     << std::endl;
1046           \}
1047         \}
1048       \} \textcolor{comment}{// exceptional}
1049 
1050       cumulativeNumPositions += tmpChainSize;
1051       \textcolor{keywordflow}{if} (cumulativeNumPositions > 100) \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_abb2a6a8de19058957f856341fce2440e}{setExceptionalCircumstance}(\textcolor{keyword}{
      false});
1052 
1053       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()       ) &&
1054           (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 3)) \{
1055         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In
       MLSampling<P\_V,P\_M>::generateUnbLinkedChains\_all()"}
1056                                 << \textcolor{stringliteral}{", level "}               << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1057                                 << \textcolor{stringliteral}{", step "}                << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1058                                 << \textcolor{stringliteral}{", chainId = "}           << chainId
1059                                 << \textcolor{stringliteral}{" < "}                    << chainIdMax
1060                                 << \textcolor{stringliteral}{": finished generating "} << tmpChain.subSequenceSize()
1061                                 << \textcolor{stringliteral}{" chain positions"}
1062                                 << std::endl;
1063       \}
1064 
1065       \textcolor{comment}{// KAUST5: what if workingChain ends up with different size in different nodes? Important}
1066       workingChain.append              (tmpChain,              1,tmpChain.subSequenceSize()-1              
      ); \textcolor{comment}{// IMPORTANT: '1' in order to discard initial position}
1067       \textcolor{keywordflow}{if} (currLogLikelihoodValues) \{
1068         currLogLikelihoodValues->\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a75cdd556cc417e35a6b9f7aff86896ae}{append}(tmpLogLikelihoodValues,1,tmpLogLikelihoodValues.
      subSequenceSize()-1); \textcolor{comment}{// IMPORTANT: '1' in order to discard initial position}
1069         \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()        ) &&
1070             (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 99) &&
1071             (chainId == 0                  )) \{
1072           *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In
       MLSampling<P\_V,P\_M>::generateUnbLinkedChains\_all()"}
1073                                   << \textcolor{stringliteral}{", level "}     << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1074                                   << \textcolor{stringliteral}{", step "}      << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1075                                   << \textcolor{stringliteral}{", chainId = "} << chainId
1076                                   << \textcolor{stringliteral}{", tmpLogLikelihoodValues.subSequenceSize() = "} << 
      tmpLogLikelihoodValues.subSequenceSize()
1077                                   << \textcolor{stringliteral}{", tmpLogLikelihoodValues[0] = "}                << 
      tmpLogLikelihoodValues[0]
1078                                   << \textcolor{stringliteral}{", tmpLogLikelihoodValues[1] = "}                << 
      tmpLogLikelihoodValues[1]
1079                                   << \textcolor{stringliteral}{", currLogLikelihoodValues[0] = "}               << 
      (*currLogLikelihoodValues)[0]
1080                                   << std::endl;
1081         \}
1082       \}
1083       \textcolor{keywordflow}{if} (currLogTargetValues) \{
1084         currLogTargetValues->\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a75cdd556cc417e35a6b9f7aff86896ae}{append}    (tmpLogTargetValues,    1,tmpLogTargetValues.subSequenceSize()
      -1    ); \textcolor{comment}{// IMPORTANT: '1' in order to discard initial position}
1085       \}
1086     \}
1087   \} \textcolor{comment}{// for 'chainId'}
1088 
1089   \textcolor{keyword}{struct }timeval timevalBarrier;
1090   iRC = gettimeofday(&timevalBarrier, NULL);
1091   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
1092   \textcolor{keywordtype}{double} loopTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalEntering);
1093   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
1094     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::generateUnbLinkedChains\_all()"}
1095                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1096                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1097                             << \textcolor{stringliteral}{": ended chain loop after "} << loopTime << \textcolor{stringliteral}{" seconds"}
1098                             << \textcolor{stringliteral}{", calling fullComm().Barrier() at "} << ctime(&timevalBarrier.tv\_sec)
1099                             << std::endl;
1100   \}
1101 
1102   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}(); \textcolor{comment}{// KAUST4}
1103 
1104   \textcolor{keyword}{struct }timeval timevalLeaving;
1105   iRC = gettimeofday(&timevalLeaving, NULL);
1106   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
1107   \textcolor{keywordtype}{double} barrierTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalBarrier);
1108   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
1109     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving
       MLSampling<P\_V,P\_M>::generateUnbLinkedChains\_all()"}
1110                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1111                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1112                             << \textcolor{stringliteral}{": after "} << barrierTime << \textcolor{stringliteral}{" seconds in fullComm().Barrier()"}
1113                             << \textcolor{stringliteral}{", at "} << ctime(&timevalLeaving.tv\_sec)
1114                             << std::endl;
1115   \}
1116 
1117   \textcolor{keywordflow}{return};
1118 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a44ff302d505e5de781ea6635ea0d85d9}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!just\-Balance\-\_\-proc0@{just\-Balance\-\_\-proc0}}
\index{just\-Balance\-\_\-proc0@{just\-Balance\-\_\-proc0}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{just\-Balance\-\_\-proc0}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::just\-Balance\-\_\-proc0 (
\begin{DoxyParamCaption}
\item[{const {\bf M\-L\-Sampling\-Level\-Options} $\ast$}]{curr\-Options, }
\item[{std\-::vector$<$ {\bf Exchange\-Info\-Struct} $>$ \&}]{exchange\-Std\-Vec}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a44ff302d505e5de781ea6635ea0d85d9}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em curr\-Options,exchange\-Std\-Vec} & \\
\hline
\mbox{\tt out}  & {\em exchange\-Std\-Vec} & \\
\hline
\end{DoxyParams}


Definition at line 1518 of file M\-L\-Sampling.\-C.



References L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-load\-Balance\-Treshold, Q\-U\-E\-S\-O\-::\-Misc\-Get\-Ellapsed\-Seconds(), U\-Q\-\_\-\-F\-A\-T\-A\-L\-\_\-\-T\-E\-S\-T\-\_\-\-M\-A\-C\-R\-O, and Q\-U\-E\-S\-O\-::\-U\-Q\-\_\-\-O\-K\-\_\-\-R\-C.


\begin{DoxyCode}
1521 \{
1522   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() != 0) \textcolor{keywordflow}{return};
1523 
1524   \textcolor{keywordtype}{int} iRC = \hyperlink{namespace_q_u_e_s_o_a8e909502900aecf24cedba022ea84471}{UQ\_OK\_RC};
1525   \textcolor{keyword}{struct }timeval timevalBal;
1526   iRC = gettimeofday(&timevalBal, NULL);
1527   \textcolor{keywordflow}{if} (iRC) \{\}; \textcolor{comment}{// just to remove compiler warning}
1528 
1529   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} Np = \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ac0345f57e31ef7833e379ed972bd094d}{numSubEnvironments}();
1530   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} Nc = exchangeStdVec.size();
1531 
1532   std::vector<ExchangeInfoStruct> currExchangeStdVec(Nc);
1533   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} chainId = 0; chainId < Nc; ++chainId) \{
1534     currExchangeStdVec[chainId] = exchangeStdVec[chainId];
1535     currExchangeStdVec[chainId].finalNodeOfInitialPosition = currExchangeStdVec[chainId].
      originalNodeOfInitialPosition; \textcolor{comment}{// final = original}
1536   \}
1537 
1539   \textcolor{comment}{// Compute original ratio of positions per node}
1541 \textcolor{comment}{}  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} iterIdMax = 0;
1542   std::vector<unsigned int> currNumChainsPerNode   (Np,0);
1543   std::vector<unsigned int> currNumPositionsPerNode(Np,0);
1544   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} chainId = 0; chainId < Nc; ++chainId) \{
1545     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = currExchangeStdVec[chainId].finalNodeOfInitialPosition; \textcolor{comment}{// Yes, 'final'}
1546     currNumChainsPerNode   [nodeId] += 1;
1547     currNumPositionsPerNode[nodeId] += currExchangeStdVec[chainId].numberOfPositions;
1548     iterIdMax                       += currExchangeStdVec[chainId].numberOfPositions;
1549   \}
1550   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} currMinPosPerNode = *std::min\_element(currNumPositionsPerNode.begin(), 
      currNumPositionsPerNode.end());
1551   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} currMaxPosPerNode = *std::max\_element(currNumPositionsPerNode.begin(), 
      currNumPositionsPerNode.end());
1552   \textcolor{keywordtype}{double} currRatioOfPosPerNode = ((double) currMaxPosPerNode ) / ((double) currMinPosPerNode);
1553 
1555   \textcolor{comment}{// Loop}
1557 \textcolor{comment}{}  \textcolor{comment}{//iterIdMax /= 2;}
1558   \textcolor{keywordtype}{int} iterId = -1;
1559   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
1560     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::justBalance\_proc0()"}
1561                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1562                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1563                             << \textcolor{stringliteral}{", iter "}  << iterId
1564                             << \textcolor{stringliteral}{", currRatioOfPosPerNode = "} << currRatioOfPosPerNode
1565                             << std::endl;
1566     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = 0; nodeId < Np; ++nodeId) \{
1567       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"  KEY In MLSampling<P\_V,P\_M>::justBalance\_proc0()"}
1568                               << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1569                               << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1570                               << \textcolor{stringliteral}{", iter "}  << iterId
1571                               << \textcolor{stringliteral}{", currNumChainsPerNode["}    << nodeId << \textcolor{stringliteral}{"] = "} << currNumChainsPerNode[
      nodeId]
1572                               << \textcolor{stringliteral}{", currNumPositionsPerNode["} << nodeId << \textcolor{stringliteral}{"] = "} << 
      currNumPositionsPerNode[nodeId]
1573                               << std::endl;
1574     \}
1575   \}
1576 
1577   std::vector<std::vector<double> > vectorOfChainSizesPerNode(Np);
1578   \textcolor{keywordflow}{while} ((iterId                < (\textcolor{keywordtype}{int}) iterIdMax                   ) &&
1579          (currRatioOfPosPerNode > currOptions->m\_loadBalanceTreshold)) \{
1580     iterId++;
1581 
1583     \textcolor{comment}{// Initialize information}
1585 \textcolor{comment}{}    \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = 0; nodeId < Np; ++nodeId) \{
1586       vectorOfChainSizesPerNode[nodeId].clear(); \textcolor{comment}{// make sure vectors have size 0}
1587     \}
1588     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} chainId = 0; chainId < Nc; ++chainId) \{
1589       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = currExchangeStdVec[chainId].finalNodeOfInitialPosition; \textcolor{comment}{// Yes, 'final'}
1590       vectorOfChainSizesPerNode[nodeId].push\_back(currExchangeStdVec[chainId].numberOfPositions);
1591     \}
1592     \textcolor{comment}{// FIX ME: swap to save memory}
1593     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = 0; nodeId < Np; ++nodeId) \{
1594       std::sort(vectorOfChainSizesPerNode[nodeId].begin(), vectorOfChainSizesPerNode[nodeId].end());
1595       \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(vectorOfChainSizesPerNode[nodeId].size() != 
      currNumChainsPerNode[nodeId],
1596                           \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
1597                           \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::justBalance\_proc0()"},
1598                           \textcolor{stringliteral}{"inconsistent number of chains in node"});
1599     \}
1600 
1602     \textcolor{comment}{// Find [node with most postions], [node with least positions] and [number of positions to move]}
1604 \textcolor{comment}{}    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} currBiggestAmountOfPositionsPerNode  = currNumPositionsPerNode[0];
1605     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} currSmallestAmountOfPositionsPerNode = currNumPositionsPerNode[0];
1606     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} currNodeWithMostPositions = 0;
1607     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} currNodeWithLeastPositions = 0;
1608     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = 0; nodeId < Np; ++nodeId) \{
1609       \textcolor{keywordflow}{if} (currNumPositionsPerNode[nodeId] > currBiggestAmountOfPositionsPerNode) \{
1610         currBiggestAmountOfPositionsPerNode = currNumPositionsPerNode[nodeId];
1611         currNodeWithMostPositions = nodeId;
1612       \}
1613       \textcolor{keywordflow}{if} (currNumPositionsPerNode[nodeId] < currSmallestAmountOfPositionsPerNode) \{
1614         currSmallestAmountOfPositionsPerNode = currNumPositionsPerNode[nodeId];
1615         currNodeWithLeastPositions = nodeId;
1616       \}
1617     \}
1618 
1619     \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(currMinPosPerNode != currNumPositionsPerNode[
      currNodeWithLeastPositions],
1620                         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
1621                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::justBalance\_proc0()"},
1622                         \textcolor{stringliteral}{"inconsistent currMinPosPerNode"});
1623 
1624     \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(currMaxPosPerNode != currNumPositionsPerNode[
      currNodeWithMostPositions],
1625                         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
1626                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::justBalance\_proc0()"},
1627                         \textcolor{stringliteral}{"inconsistent currMaxPosPerNode"});
1628 
1629     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} numberOfPositionsToMove = vectorOfChainSizesPerNode[currNodeWithMostPositions][0];
1630 
1631     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 3)) \{
1632       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::justBalance\_proc0()"}
1633                               << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1634                               << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1635                               << \textcolor{stringliteral}{", iter "}  << iterId
1636                               << \textcolor{stringliteral}{", before update"}
1637                               << \textcolor{stringliteral}{", node w/ most pos is "}
1638                               << currNodeWithMostPositions  << \textcolor{stringliteral}{"(cs="} << currNumChainsPerNode[
      currNodeWithMostPositions ] << \textcolor{stringliteral}{", ps="} << currNumPositionsPerNode[currNodeWithMostPositions ] << \textcolor{stringliteral}{")"}
1639                               << \textcolor{stringliteral}{", node w/ least pos is "}
1640                               << currNodeWithLeastPositions << \textcolor{stringliteral}{"(cs="} << currNumChainsPerNode[
      currNodeWithLeastPositions] << \textcolor{stringliteral}{", ps="} << currNumPositionsPerNode[currNodeWithLeastPositions] << \textcolor{stringliteral}{")"}
1641                               << \textcolor{stringliteral}{", number of pos to move = "} << numberOfPositionsToMove
1642                               << std::endl;
1643     \}
1644 
1646     \textcolor{comment}{// Update 'final' fields in the two nodes}
1648 \textcolor{comment}{}    std::vector<ExchangeInfoStruct> newExchangeStdVec(Nc);
1649     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} chainId = 0; chainId < Nc; ++chainId) \{
1650       newExchangeStdVec[chainId] = currExchangeStdVec[chainId];
1651     \}
1652 
1653     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} chainId = 0; chainId < Nc; ++chainId) \{
1654       \textcolor{keywordflow}{if} ((newExchangeStdVec[chainId].finalNodeOfInitialPosition == (\textcolor{keywordtype}{int}) currNodeWithMostPositions) &&
1655           (newExchangeStdVec[chainId].numberOfPositions          == numberOfPositionsToMove        )) \{
1656         newExchangeStdVec[chainId].finalNodeOfInitialPosition = currNodeWithLeastPositions;
1657         \textcolor{keywordflow}{break}; \textcolor{comment}{// exit 'for'}
1658       \}
1659     \}
1660 
1662     \textcolor{comment}{// Compute new ratio of positions per node}
1664 \textcolor{comment}{}    std::vector<unsigned int> newNumChainsPerNode   (Np,0);
1665     std::vector<unsigned int> newNumPositionsPerNode(Np,0);
1666     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} chainId = 0; chainId < Nc; ++chainId) \{
1667       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = newExchangeStdVec[chainId].finalNodeOfInitialPosition; \textcolor{comment}{// Yes, 'final'}
1668       newNumChainsPerNode   [nodeId] += 1;
1669       newNumPositionsPerNode[nodeId] += newExchangeStdVec[chainId].numberOfPositions;
1670     \}
1671 
1672     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} newBiggestAmountOfPositionsPerNode  = newNumPositionsPerNode[0];
1673     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} newSmallestAmountOfPositionsPerNode = newNumPositionsPerNode[0];
1674     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} newNodeWithMostPositions = 0;
1675     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} newNodeWithLeastPositions = 0;
1676     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = 0; nodeId < Np; ++nodeId) \{
1677       \textcolor{keywordflow}{if} (newNumPositionsPerNode[nodeId] > newBiggestAmountOfPositionsPerNode) \{
1678         newBiggestAmountOfPositionsPerNode = newNumPositionsPerNode[nodeId];
1679         newNodeWithMostPositions = nodeId;
1680       \}
1681       \textcolor{keywordflow}{if} (newNumPositionsPerNode[nodeId] < newSmallestAmountOfPositionsPerNode) \{
1682         newSmallestAmountOfPositionsPerNode = newNumPositionsPerNode[nodeId];
1683         newNodeWithLeastPositions = nodeId;
1684       \}
1685     \}
1686 
1687     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 3)) \{
1688       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::justBalance\_proc0()"}
1689                               << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1690                               << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1691                               << \textcolor{stringliteral}{", iter "}  << iterId
1692                               << \textcolor{stringliteral}{", after update"}
1693                               << \textcolor{stringliteral}{", node w/ most pos is "}
1694                               << newNodeWithMostPositions  << \textcolor{stringliteral}{"(cs="} << newNumChainsPerNode[
      newNodeWithMostPositions ] << \textcolor{stringliteral}{", ps="} << newNumPositionsPerNode[newNodeWithMostPositions ] << \textcolor{stringliteral}{")"}
1695                               << \textcolor{stringliteral}{", node w/ least pos is "}
1696                               << newNodeWithLeastPositions << \textcolor{stringliteral}{"(cs="} << newNumChainsPerNode[
      newNodeWithLeastPositions] << \textcolor{stringliteral}{", ps="} << newNumPositionsPerNode[newNodeWithLeastPositions] << \textcolor{stringliteral}{")"}
1697                               << std::endl;
1698     \}
1699 
1700     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} newMinPosPerNode = *std::min\_element(newNumPositionsPerNode.begin(), 
      newNumPositionsPerNode.end());
1701     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} newMaxPosPerNode = *std::max\_element(newNumPositionsPerNode.begin(), 
      newNumPositionsPerNode.end());
1702     \textcolor{keywordtype}{double} newRatioOfPosPerNode = ((double) newMaxPosPerNode ) / ((double) newMinPosPerNode);
1703 
1704     \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(newMinPosPerNode != newNumPositionsPerNode[
      newNodeWithLeastPositions],
1705                         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
1706                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::justBalance\_proc0()"},
1707                         \textcolor{stringliteral}{"inconsistent newMinPosPerNode"});
1708 
1709     \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(newMaxPosPerNode != newNumPositionsPerNode[
      newNodeWithMostPositions],
1710                         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
1711                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::justBalance\_proc0()"},
1712                         \textcolor{stringliteral}{"inconsistent newMaxPosPerNode"});
1713 
1714     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 3)) \{
1715       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::justBalance\_proc0()"}
1716                               << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1717                               << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1718                               << \textcolor{stringliteral}{", iter "}  << iterId
1719                               << \textcolor{stringliteral}{", newMaxPosPerNode = "}     << newMaxPosPerNode
1720                               << \textcolor{stringliteral}{", newMinPosPerNode = "}     << newMinPosPerNode
1721                               << \textcolor{stringliteral}{", newRatioOfPosPerNode = "} << newRatioOfPosPerNode
1722                               << std::endl;
1723       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = 0; nodeId < Np; ++nodeId) \{
1724         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"  KEY In MLSampling<P\_V,P\_M>::justBalance\_proc0()"}
1725                                 << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1726                                 << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1727                                 << \textcolor{stringliteral}{", iter "}  << iterId
1728                                 << \textcolor{stringliteral}{", newNumChainsPerNode["}    << nodeId << \textcolor{stringliteral}{"] = "} << newNumChainsPerNode  
       [nodeId]
1729                                 << \textcolor{stringliteral}{", newNumPositionsPerNode["} << nodeId << \textcolor{stringliteral}{"] = "} << 
      newNumPositionsPerNode[nodeId]
1730                                 << std::endl;
1731       \}
1732     \}
1733 
1735     \textcolor{comment}{// See if we need to exit 'while'}
1737 \textcolor{comment}{}    \textcolor{keywordflow}{if} (newRatioOfPosPerNode > currRatioOfPosPerNode) \{
1738       \textcolor{keywordflow}{break}; \textcolor{comment}{// exit 'while'}
1739     \}
1740 
1742     \textcolor{comment}{// Prepare for next iteration}
1744 \textcolor{comment}{}    \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = 0; nodeId < Np; ++nodeId) \{
1745       currNumChainsPerNode   [nodeId] = 0;
1746       currNumPositionsPerNode[nodeId] = 0;
1747     \}
1748     currRatioOfPosPerNode = newRatioOfPosPerNode;
1749     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} chainId = 0; chainId < Nc; ++chainId) \{
1750       currExchangeStdVec[chainId] = newExchangeStdVec[chainId];
1751       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = currExchangeStdVec[chainId].finalNodeOfInitialPosition; \textcolor{comment}{// Yes, 'final'}
1752       currNumChainsPerNode   [nodeId] += 1;
1753       currNumPositionsPerNode[nodeId] += currExchangeStdVec[chainId].numberOfPositions;
1754     \}
1755     currMinPosPerNode = *std::min\_element(currNumPositionsPerNode.begin(), currNumPositionsPerNode.end());
1756     currMaxPosPerNode = *std::max\_element(currNumPositionsPerNode.begin(), currNumPositionsPerNode.end());
1757     currRatioOfPosPerNode = ((double) currMaxPosPerNode ) / ((double) currMinPosPerNode);
1758   \}
1759 
1761   \textcolor{comment}{// Prepare output information}
1763 \textcolor{comment}{}  \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} chainId = 0; chainId < Nc; ++chainId) \{
1764     exchangeStdVec[chainId].finalNodeOfInitialPosition = currExchangeStdVec[chainId].
      finalNodeOfInitialPosition; \textcolor{comment}{// Yes, 'final' = 'final'}
1765   \}
1766 
1768   \textcolor{comment}{// Printout solution information}
1770 \textcolor{comment}{}  std::vector<unsigned int> finalNumChainsPerNode   (Np,0);
1771   std::vector<unsigned int> finalNumPositionsPerNode(Np,0);
1772   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} chainId = 0; chainId < Nc; ++chainId) \{
1773     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = exchangeStdVec[chainId].finalNodeOfInitialPosition; \textcolor{comment}{// Yes, 'final'}
1774     finalNumChainsPerNode   [nodeId] += 1;
1775     finalNumPositionsPerNode[nodeId] += exchangeStdVec[chainId].numberOfPositions;
1776   \}
1777   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} finalMinPosPerNode = *std::min\_element(finalNumPositionsPerNode.begin(), 
      finalNumPositionsPerNode.end());
1778   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} finalMaxPosPerNode = *std::max\_element(finalNumPositionsPerNode.begin(), 
      finalNumPositionsPerNode.end());
1779   \textcolor{keywordtype}{double} finalRatioOfPosPerNode = ((double) finalMaxPosPerNode ) / ((double) finalMinPosPerNode);
1780 
1781   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
1782     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"KEY In MLSampling<P\_V,P\_M>::justBalance\_proc0()"}
1783                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1784                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1785                             << \textcolor{stringliteral}{": solution gives the following redistribution"}
1786                             << std::endl;
1787     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = 0; nodeId < Np; ++nodeId) \{
1788       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"  KEY In MLSampling<P\_V,P\_M>::justBalance\_proc0()"}
1789                               << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1790                               << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1791                               << \textcolor{stringliteral}{", finalNumChainsPerNode["}    << nodeId << \textcolor{stringliteral}{"] = "} << finalNumChainsPerNode
      [nodeId]
1792                               << \textcolor{stringliteral}{", finalNumPositionsPerNode["} << nodeId << \textcolor{stringliteral}{"] = "} << 
      finalNumPositionsPerNode[nodeId]
1793                               << std::endl;
1794     \}
1795     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"  KEY In MLSampling<P\_V,P\_M>::justBalance\_proc0()"}
1796                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1797                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1798                             << \textcolor{stringliteral}{", finalRatioOfPosPerNode = "} << finalRatioOfPosPerNode
1799                             << std::endl;
1800   \}
1801 
1803   \textcolor{comment}{// Measure time}
1805 \textcolor{comment}{}  \textcolor{keywordtype}{double} balRunTime = \hyperlink{namespace_q_u_e_s_o_a424bc33f2e6e287fd468408d14b772ee}{MiscGetEllapsedSeconds}(&timevalBal);
1806   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
1807     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving MLSampling<P\_V,P\_M>::justBalance\_proc0()"}
1808                             << \textcolor{stringliteral}{", level "}                   << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1809                             << \textcolor{stringliteral}{", step "}                    << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1810                             << \textcolor{stringliteral}{", iterId = "}                << iterId
1811                             << \textcolor{stringliteral}{", currRatioOfPosPerNode = "} << currRatioOfPosPerNode
1812                             << \textcolor{stringliteral}{", after "} << balRunTime << \textcolor{stringliteral}{" seconds"}
1813                             << std::endl;
1814   \}
1815 
1816   \textcolor{keywordflow}{return};
1817 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_ae870f4b12060ae67d0c4473828b142f1}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!log\-Evidence@{log\-Evidence}}
\index{log\-Evidence@{log\-Evidence}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{log\-Evidence}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ double {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::log\-Evidence (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const}}\label{class_q_u_e_s_o_1_1_m_l_sampling_ae870f4b12060ae67d0c4473828b142f1}


Method to calculate the logarithm of the evidence. 

Access to the private member\-: {\ttfamily m\-\_\-log\-Evidence}. 

Definition at line 4872 of file M\-L\-Sampling.\-C.


\begin{DoxyCode}
4873 \{
4874   \textcolor{keywordflow}{return} \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_afad63c42dccb1518319bf677f2bffde0}{m\_logEvidence};
4875 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_ace6bbf605f8b655e0671d20309160941}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!mean\-Log\-Likelihood@{mean\-Log\-Likelihood}}
\index{mean\-Log\-Likelihood@{mean\-Log\-Likelihood}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{mean\-Log\-Likelihood}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ double {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::mean\-Log\-Likelihood (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const}}\label{class_q_u_e_s_o_1_1_m_l_sampling_ace6bbf605f8b655e0671d20309160941}


Method to calculate the mean of the logarithm of the likelihood. 

Access to the private member\-: {\ttfamily m\-\_\-mean\-Log\-Likelihood}. 

Definition at line 4878 of file M\-L\-Sampling.\-C.


\begin{DoxyCode}
4879 \{
4880   \textcolor{keywordflow}{return} \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_aec4229773274b58e3eaa49a77738389f}{m\_meanLogLikelihood};
4881 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a1bb275df38553b88e2196103c7f5ea46}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!mpi\-Exchange\-Positions\-\_\-inter0@{mpi\-Exchange\-Positions\-\_\-inter0}}
\index{mpi\-Exchange\-Positions\-\_\-inter0@{mpi\-Exchange\-Positions\-\_\-inter0}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{mpi\-Exchange\-Positions\-\_\-inter0}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::mpi\-Exchange\-Positions\-\_\-inter0 (
\begin{DoxyParamCaption}
\item[{const {\bf Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{prev\-Chain, }
\item[{const std\-::vector$<$ {\bf Exchange\-Info\-Struct} $>$ \&}]{exchange\-Std\-Vec, }
\item[{const std\-::vector$<$ unsigned int $>$ \&}]{final\-Num\-Chains\-Per\-Node, }
\item[{const std\-::vector$<$ unsigned int $>$ \&}]{final\-Num\-Positions\-Per\-Node, }
\item[{{\bf Balanced\-Linked\-Chains\-Per\-Node\-Struct}$<$ P\-\_\-\-V $>$ \&}]{balanced\-Link\-Control}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a1bb275df38553b88e2196103c7f5ea46}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em prev\-Chain,exchange\-Std\-Vec,final\-Num\-Chains\-Per\-Node,final\-Num\-Positions\-Per\-Node} & \\
\hline
\mbox{\tt out}  & {\em balanced\-Link\-Control} & \\
\hline
\end{DoxyParams}


Definition at line 1821 of file M\-L\-Sampling.\-C.



References Q\-U\-E\-S\-O\-::\-Balanced\-Linked\-Chains\-Per\-Node\-Struct$<$ P\-\_\-\-V $>$\-::bal\-Linked\-Chains, Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::get\-Position\-Values(), L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-D\-O\-U\-B\-L\-E, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-I\-N\-\_\-\-P\-L\-A\-C\-E, and U\-Q\-\_\-\-F\-A\-T\-A\-L\-\_\-\-T\-E\-S\-T\-\_\-\-M\-A\-C\-R\-O.


\begin{DoxyCode}
1827 \{
1828   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() < 0) \textcolor{keywordflow}{return};
1829 
1830   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} Np = (\textcolor{keywordtype}{unsigned} int) \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_aa780721ae0fdeabc5a15e04cb0cad964}{NumProc}();
1831   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} Nc = exchangeStdVec.size();
1832 
1833   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
1834     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Entering
       MLSampling<P\_V,P\_M>::mpiExchangePositions\_inter0()"}
1835                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1836                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1837                             << \textcolor{stringliteral}{": Np = "} << Np
1838                             << \textcolor{stringliteral}{", Nc = "} << Nc
1839                             << std::endl;
1840   \}
1841 
1843   \textcolor{comment}{// Each node performs:}
1844   \textcolor{comment}{// --> a 'gatherv' for collecting all necessary initial positions from other nodes}
1845   \textcolor{comment}{// --> a 'gatherv' for collecting all necessary chain lenghts from other nodes}
1847 \textcolor{comment}{}  \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} r = 0; r < Np; ++r) \{
1849     \textcolor{comment}{// Prepare some counters}
1851 \textcolor{comment}{}    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}              numberOfInitialPositionsNodeRAlreadyHas = 0;
1852     std::vector<unsigned int> numberOfInitialPositionsNodeRHasToReceiveFromNode(Np,0);
1853     std::vector<unsigned int> indexesOfInitialPositionsNodeRHasToReceiveFromMe(0);
1854 
1855     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}              sumOfChainLenghtsNodeRAlreadyHas = 0;
1856     std::vector<unsigned int> chainLenghtsNodeRHasToInherit(0);
1857 
1858     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < Nc; ++i) \{
1859       \textcolor{keywordflow}{if} (exchangeStdVec[i].finalNodeOfInitialPosition == (\textcolor{keywordtype}{int}) r) \{
1860         \textcolor{keywordflow}{if} (exchangeStdVec[i].originalNodeOfInitialPosition == (\textcolor{keywordtype}{int}) r) \{
1861           numberOfInitialPositionsNodeRAlreadyHas++;
1862           sumOfChainLenghtsNodeRAlreadyHas += exchangeStdVec[i].numberOfPositions;
1863         \}
1864         \textcolor{keywordflow}{else} \{
1865           numberOfInitialPositionsNodeRHasToReceiveFromNode[exchangeStdVec[i].originalNodeOfInitialPosition
      ]++;
1866           chainLenghtsNodeRHasToInherit.push\_back(exchangeStdVec[i].numberOfPositions);
1867           \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() == exchangeStdVec[i].originalNodeOfInitialPosition) \{
1868             indexesOfInitialPositionsNodeRHasToReceiveFromMe.push\_back(exchangeStdVec[i].
      originalIndexOfInitialPosition);
1869           \}
1870         \}
1871       \}
1872     \}
1873 
1874     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} totalNumberOfInitialPositionsNodeRHasToReceive = 0;
1875     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = 0; nodeId < Np; ++nodeId) \{
1876       totalNumberOfInitialPositionsNodeRHasToReceive += numberOfInitialPositionsNodeRHasToReceiveFromNode[
      nodeId];
1877     \}
1878 
1879     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} totalNumberOfChainLenghtsNodeRHasToInherit = chainLenghtsNodeRHasToInherit.size();
1880     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} totalSumOfChainLenghtsNodeRHasToInherit = 0;
1881     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < totalNumberOfChainLenghtsNodeRHasToInherit; ++i) \{
1882       totalSumOfChainLenghtsNodeRHasToInherit += chainLenghtsNodeRHasToInherit[i];
1883     \}
1884 
1886     \textcolor{comment}{// Printout important information}
1888 \textcolor{comment}{}    \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
1889       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"KEY In
       MLSampling<P\_V,P\_M>::mpiExchangePositions\_inter0()"}
1890                               << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1891                               << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1892                               << \textcolor{stringliteral}{": r = "}                                              << r
1893                               << \textcolor{stringliteral}{", finalNumChainsPerNode[r] = "}                       << 
      finalNumChainsPerNode[r]
1894                               << \textcolor{stringliteral}{", totalNumberOfInitialPositionsNodeRHasToReceive = "} << 
      totalNumberOfInitialPositionsNodeRHasToReceive
1895                               << \textcolor{stringliteral}{", numberOfInitialPositionsNodeRAlreadyHas = "}        << 
      numberOfInitialPositionsNodeRAlreadyHas
1896                               << std::endl;
1897       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"KEY In
       MLSampling<P\_V,P\_M>::mpiExchangePositions\_inter0()"}
1898                               << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
1899                               << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
1900                               << \textcolor{stringliteral}{": r = "}                                       << r
1901                               << \textcolor{stringliteral}{", finalNumPositionsPerNode[r] = "}             << finalNumPositionsPerNode
      [r]
1902                               << \textcolor{stringliteral}{", totalSumOfChainLenghtsNodeRHasToInherit = "} << 
      totalSumOfChainLenghtsNodeRHasToInherit
1903                               << \textcolor{stringliteral}{", sumOfChainLenghtsNodeRAlreadyHas = "}        << 
      sumOfChainLenghtsNodeRAlreadyHas
1904                               << std::endl;
1905     \}
1906 
1908     \textcolor{comment}{// Make sanity checks}
1910 \textcolor{comment}{}    \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(indexesOfInitialPositionsNodeRHasToReceiveFromMe.size() != 
      numberOfInitialPositionsNodeRHasToReceiveFromNode[\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}()],
1911                         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
1912                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::mpiExchangePositions\_inter0()"},
1913                         \textcolor{stringliteral}{"inconsistent number of initial positions to send to node 'r'"});
1914 
1915     \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(finalNumChainsPerNode[r] != (
      totalNumberOfInitialPositionsNodeRHasToReceive + numberOfInitialPositionsNodeRAlreadyHas),
1916                         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
1917                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::mpiExchangePositions\_inter0()"},
1918                         \textcolor{stringliteral}{"inconsistent number of chains in node 'r'"});
1919 
1920     \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(finalNumPositionsPerNode[r] != (
      totalSumOfChainLenghtsNodeRHasToInherit + sumOfChainLenghtsNodeRAlreadyHas),
1921                         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
1922                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::mpiExchangePositions\_inter0()"},
1923                         \textcolor{stringliteral}{"inconsistent sum of chain lenghts in node 'r'"});
1924 
1925     \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(totalNumberOfInitialPositionsNodeRHasToReceive != 
      totalNumberOfChainLenghtsNodeRHasToInherit,
1926                         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
1927                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::mpiExchangePositions\_inter0()"},
1928                         \textcolor{stringliteral}{"inconsistent on total number of initial positions to receive in node 'r'"});
1929 
1930     \textcolor{comment}{// Optimize use of memory (FIX ME: don't need to use swap here ????)}
1931     indexesOfInitialPositionsNodeRHasToReceiveFromMe.resize(
      numberOfInitialPositionsNodeRHasToReceiveFromNode[\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}()]);
1932     chainLenghtsNodeRHasToInherit.resize                   (totalSumOfChainLenghtsNodeRHasToInherit);
1933 
1935     \textcolor{comment}{// Prepare counters and buffers for gatherv of initial positions}
1937 \textcolor{comment}{}    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} dimSize = \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a5829a1f4f996f8307c840b705144d666}{dimLocal}();
1938     P\_V auxInitialPosition(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.\hyperlink{class_q_u_e_s_o_1_1_vector_space_a92e963bb5cab3eecd290dfe4b8f03b04}{zeroVector}());
1939     std::vector<double> sendbuf(0);
1940     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} sendcnt = 0;
1941     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() != (int) r) \{
1942       sendcnt = numberOfInitialPositionsNodeRHasToReceiveFromNode[\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}()] * dimSize;
1943       sendbuf.resize(sendcnt);
1944       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < numberOfInitialPositionsNodeRHasToReceiveFromNode[
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}()]; ++i) \{
1945         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} auxIndex = indexesOfInitialPositionsNodeRHasToReceiveFromMe[i];
1946         prevChain.getPositionValues(auxIndex,auxInitialPosition);
1947         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} j = 0; j < dimSize; ++j) \{
1948           sendbuf[i*dimSize + j] = auxInitialPosition[j];
1949         \}
1950       \}
1951     \}
1952 
1953     std::vector<double> recvbuf(0);
1954     std::vector<int> recvcnts(Np,0); \textcolor{comment}{// '0' is already the correct value for recvcnts[r]}
1955     \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() == (int) r) \{
1956       recvbuf.resize(totalNumberOfInitialPositionsNodeRHasToReceive * dimSize);
1957       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = 0; nodeId < Np; ++nodeId) \{ \textcolor{comment}{// Yes, from '0' on (for 'r',
       numberOf...ToReceiveFromNode[r] = 0 anyway)}
1958         recvcnts[nodeId] = numberOfInitialPositionsNodeRHasToReceiveFromNode[nodeId\textcolor{comment}{/*m\_env.inter0Rank()*/}] 
      * dimSize;
1959       \}
1960     \}
1961 
1962     std::vector<int> displs(Np,0);
1963     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = 1; nodeId < Np; ++nodeId) \{ \textcolor{comment}{// Yes, from '1' on}
1964       displs[nodeId] = displs[nodeId-1] + recvcnts[nodeId-1];
1965     \}
1966 
1967 \textcolor{preprocessor}{#if 0}
1968 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() == r) \{
1969       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a9313449240c1bb2289870309a5c711ed}{Gatherv}(\hyperlink{_mpi_comm_8h_a578a93c04b9dab934e3a90f0beed4edf}{RawValue\_MPI\_IN\_PLACE}, (\textcolor{keywordtype}{int}) 
      sendcnt, \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, (\textcolor{keywordtype}{void} *) &recvbuf[0], (\textcolor{keywordtype}{int} *) &recvcnts[0], (\textcolor{keywordtype}{int} *) &displs[0
      ], \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, r, \textcolor{comment}{// LOAD BALANCE}
1970                                  \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::mpiExchangePositions\_inter0(1)"},
1971                                  \textcolor{stringliteral}{"failed MPI.Gatherv()"});
1972     \}
1973     \textcolor{keywordflow}{else} \{
1974       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a9313449240c1bb2289870309a5c711ed}{Gatherv}((\textcolor{keywordtype}{void} *) &sendbuf[0], (\textcolor{keywordtype}{int}) sendcnt, 
      \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, (\textcolor{keywordtype}{void} *) &recvbuf[0], (\textcolor{keywordtype}{int} *) &recvcnts[0], (\textcolor{keywordtype}{int} *) &displs[0], 
      \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, r, \textcolor{comment}{// LOAD BALANCE}
1975                                  \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::mpiExchangePositions\_inter0(2)"},
1976                                  \textcolor{stringliteral}{"failed MPI.Gatherv()"});
1977     \}
1978 \textcolor{preprocessor}{#else}
1979 \textcolor{preprocessor}{}    \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a9313449240c1bb2289870309a5c711ed}{Gatherv}((\textcolor{keywordtype}{void} *) &sendbuf[0], (\textcolor{keywordtype}{int}) sendcnt, 
      \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, (\textcolor{keywordtype}{void} *) &recvbuf[0], (\textcolor{keywordtype}{int} *) &recvcnts[0], (\textcolor{keywordtype}{int} *) &displs[0], 
      \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, r, \textcolor{comment}{// LOAD BALANCE}
1980                                \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::mpiExchangePositions\_inter0()"},
1981                                \textcolor{stringliteral}{"failed MPI.Gatherv()"});
1982 \textcolor{preprocessor}{#endif}
1983 \textcolor{preprocessor}{}
1985     \textcolor{comment}{// Make sanity checks}
1987 \textcolor{comment}{}
1989     \textcolor{comment}{// Transfer data from 'recvbuf' to 'balancedLinkControl'}
1990     \textcolor{comment}{// Remember that finalNumChainsPerNode[r] = (totalNumberOfInitialPositionsNodeRHasToReceive +
       numberOfInitialPositionsNodeRAlreadyHas)}
1991     \textcolor{comment}{// Remember that totalNumberOfInitialPositionsNodeRHasToReceive =
       totalNumberOfChainLenghtsNodeRHasToInherit}
1993 \textcolor{comment}{}    \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() == (int) r) \{
1994       balancedLinkControl.balLinkedChains.resize(finalNumChainsPerNode[r]);
1995       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} auxIndex = 0;
1996 
1997       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < Nc; ++i) \{
1998         \textcolor{keywordflow}{if} ((exchangeStdVec[i].finalNodeOfInitialPosition    == (\textcolor{keywordtype}{int}) r) &&
1999             (exchangeStdVec[i].originalNodeOfInitialPosition == (\textcolor{keywordtype}{int}) r)) \{
2000           prevChain.getPositionValues(exchangeStdVec[i].originalIndexOfInitialPosition,auxInitialPosition);
2001           balancedLinkControl.balLinkedChains[auxIndex].initialPosition = \textcolor{keyword}{new} P\_V(auxInitialPosition);
2002           balancedLinkControl.balLinkedChains[auxIndex].numberOfPositions = exchangeStdVec[i].
      numberOfPositions;
2003           auxIndex++;
2004   \}
2005       \}
2006 
2007       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < totalNumberOfInitialPositionsNodeRHasToReceive; ++i) \{
2008         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} j = 0; j < dimSize; ++j) \{
2009           auxInitialPosition[j] = recvbuf[i*dimSize + j];
2010         \}
2011         balancedLinkControl.balLinkedChains[auxIndex].initialPosition = \textcolor{keyword}{new} P\_V(auxInitialPosition);
2012         balancedLinkControl.balLinkedChains[auxIndex].numberOfPositions = chainLenghtsNodeRHasToInherit[i];
       \textcolor{comment}{// aqui 3}
2013         auxIndex++;
2014       \}
2015     \}
2016 
2017     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
2018   \} \textcolor{comment}{// for 'r'}
2019 
2020   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
2021     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Leaving
       MLSampling<P\_V,P\_M>::mpiExchangePositions\_inter0()"}
2022                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
2023                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
2024                             << std::endl;
2025   \}
2026 
2027   \textcolor{keywordflow}{return};
2028 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a75b2d73a0b07f594951a89cc1bc96849}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!prepare\-Bal\-Linked\-Chains\-\_\-inter0@{prepare\-Bal\-Linked\-Chains\-\_\-inter0}}
\index{prepare\-Bal\-Linked\-Chains\-\_\-inter0@{prepare\-Bal\-Linked\-Chains\-\_\-inter0}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{prepare\-Bal\-Linked\-Chains\-\_\-inter0}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::prepare\-Bal\-Linked\-Chains\-\_\-inter0 (
\begin{DoxyParamCaption}
\item[{const {\bf M\-L\-Sampling\-Level\-Options} $\ast$}]{curr\-Options, }
\item[{const {\bf Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{prev\-Chain, }
\item[{std\-::vector$<$ {\bf Exchange\-Info\-Struct} $>$ \&}]{exchange\-Std\-Vec, }
\item[{{\bf Balanced\-Linked\-Chains\-Per\-Node\-Struct}$<$ P\-\_\-\-V $>$ \&}]{balanced\-Link\-Control}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a75b2d73a0b07f594951a89cc1bc96849}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em curr\-Options,prev\-Chain,exchange\-Std\-Vec} & \\
\hline
\mbox{\tt out}  & {\em exchange\-Std\-Vec,balanced\-Link\-Control} & \\
\hline
\end{DoxyParams}


Definition at line 343 of file M\-L\-Sampling.\-C.



References L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-M\-L\-Sampling\-Level\-Options\-::m\-\_\-load\-Balance\-Algorithm\-Id, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-C\-H\-A\-R, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-D\-O\-U\-B\-L\-E, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-M\-A\-X, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-M\-I\-N, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-U\-N\-S\-I\-G\-N\-E\-D, and U\-Q\-\_\-\-F\-A\-T\-A\-L\-\_\-\-T\-E\-S\-T\-\_\-\-M\-A\-C\-R\-O.


\begin{DoxyCode}
348 \{
349   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() < 0) \textcolor{keywordflow}{return};
350 
351   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
352     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Entering
       MLSampling<P\_V,P\_M>::prepareBalLinkedChains\_inter0()"}
353                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
354                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
355                             << std::endl;
356   \}
357 
358   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} Np = (\textcolor{keywordtype}{unsigned} int) \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_aa780721ae0fdeabc5a15e04cb0cad964}{NumProc}();
359   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() == 0) \{
360     \textcolor{keywordflow}{switch} (currOptions->m\_loadBalanceAlgorithmId) \{
361       \textcolor{keywordflow}{case} 2:
362         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a44ff302d505e5de781ea6635ea0d85d9}{justBalance\_proc0}(currOptions,     \textcolor{comment}{// input}
363                           exchangeStdVec); \textcolor{comment}{// input/output}
364       \textcolor{keywordflow}{break};
365 
366       \textcolor{keywordflow}{case} 1:
367       \textcolor{keywordflow}{default}:
368 \textcolor{preprocessor}{#ifdef QUESO\_HAS\_GLPK}
369 \textcolor{preprocessor}{}        \textcolor{comment}{// Get final node responsible for a linked chain by solving BIP at node zero only}
370         solveBIP\_proc0(exchangeStdVec); \textcolor{comment}{// input/output}
371 \textcolor{preprocessor}{#else}
372 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) \{
373           *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"WARNING in
       MLSampling<P\_V,P\_M>::prepareBalLinkedChains\_inter0()"}
374                                   << \textcolor{stringliteral}{": algorithm id '"} << currOptions->m\_loadBalanceAlgorithmId
375                                   << \textcolor{stringliteral}{"' has been requested, but this QUESO library has not been built with
       'hdf5'"}
376                                   << \textcolor{stringliteral}{". Code will therefore process the algorithm id '"} << 2
377                                   << \textcolor{stringliteral}{"' instead..."}
378                                   << std::endl;
379         \}
380         \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a172d52f993f1322ed45aaddf71518dbb}{subRank}() == 0) \{
381           std::cerr << \textcolor{stringliteral}{"WARNING in MLSampling<P\_V,P\_M>::prepareBalLinkedChains\_inter0()"}
382                     << \textcolor{stringliteral}{": algorithm id '"} << currOptions->m\_loadBalanceAlgorithmId
383                     << \textcolor{stringliteral}{"' has been requested, but this QUESO library has not been built with 'hdf5'"}
384                     << \textcolor{stringliteral}{". Code will therefore process the algorithm id '"} << 2
385                     << \textcolor{stringliteral}{"' instead..."}
386                     << std::endl;
387         \}
388         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a44ff302d505e5de781ea6635ea0d85d9}{justBalance\_proc0}(currOptions,     \textcolor{comment}{// input}
389                           exchangeStdVec); \textcolor{comment}{// input/output}
390 \textcolor{preprocessor}{#endif}
391 \textcolor{preprocessor}{}      \textcolor{keywordflow}{break};
392     \}
393   \} \textcolor{comment}{// if (m\_env.inter0Rank() == 0)}
394 
395   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
396 
398   \textcolor{comment}{// Proc 0 now broadcasts the information on 'exchangeStdVec'}
400 \textcolor{comment}{}  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} exchangeStdVecSize = exchangeStdVec.size();
401   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &exchangeStdVecSize, (\textcolor{keywordtype}{int}) 1, 
      \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 0, \textcolor{comment}{// LOAD BALANCE}
402                            \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareBalLinkedChains\_inter0()"},
403                            \textcolor{stringliteral}{"failed MPI.Bcast() for exchangeStdVec size"});
404   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() > 0) exchangeStdVec.resize(exchangeStdVecSize);
405 
406   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &exchangeStdVec[0], (\textcolor{keywordtype}{int}) (exchangeStdVecSize*\textcolor{keyword}{
      sizeof}(ExchangeInfoStruct)), \hyperlink{_mpi_comm_8h_ae81a57f3cac29c0f9c656182d95b8af1}{RawValue\_MPI\_CHAR}, 0, \textcolor{comment}{// LOAD BALANCE}
407                            \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareBalLinkedChains\_inter0()"},
408                            \textcolor{stringliteral}{"failed MPI.Bcast() for exchangeStdVec data"});
409 
411   \textcolor{comment}{// All "management" nodes update 'finalNumChainsPerNode' and 'finalNumPostionsPerNode'}
413 \textcolor{comment}{}  std::vector<unsigned int> finalNumChainsPerNode   (Np,0);
414   std::vector<unsigned int> finalNumPositionsPerNode(Np,0);
415   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} Nc = exchangeStdVec.size();
416   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} chainId = 0; chainId < Nc; ++chainId) \{
417     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nodeId = exchangeStdVec[chainId].finalNodeOfInitialPosition;
418     finalNumChainsPerNode   [nodeId] += 1;
419     finalNumPositionsPerNode[nodeId] += exchangeStdVec[chainId].numberOfPositions;
420   \}
421 
423   \textcolor{comment}{// Sanity check}
425 \textcolor{comment}{}  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} finalMinPosPerNode = *std::min\_element(finalNumPositionsPerNode.begin(), 
      finalNumPositionsPerNode.end());
426   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} finalMaxPosPerNode = *std::max\_element(finalNumPositionsPerNode.begin(), 
      finalNumPositionsPerNode.end());
427   \textcolor{keywordtype}{double} finalRatioOfPosPerNode = ((double) finalMaxPosPerNode) / ((double)finalMinPosPerNode);
428   \textcolor{comment}{//std::cout << m\_env.worldRank() << ", finalRatioOfPosPerNode = " << finalRatioOfPosPerNode << std::endl;}
429 
430   std::vector<double> auxBuf(1,0.);
431   \textcolor{keywordtype}{double} minRatio = 0.;
432   auxBuf[0] = finalRatioOfPosPerNode;
433   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &auxBuf[0], (\textcolor{keywordtype}{void} *) &minRatio, (\textcolor{keywordtype}{int}) 
      auxBuf.size(), \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, \hyperlink{_mpi_comm_8h_a8e30f42fdac116861205e83e2aa18042}{RawValue\_MPI\_MIN}, \textcolor{comment}{// LOAD BALANCE}
434                                \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareBalLinkedChains\_inter0()"},
435                                \textcolor{stringliteral}{"failed MPI.Allreduce() for min"});
436   \textcolor{comment}{//std::cout << m\_env.worldRank() << ", minRatio = " << minRatio << std::endl;}
437   \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(minRatio != finalRatioOfPosPerNode,
438                       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
439                       \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareBalLinkedChains\_inter0()"},
440                       \textcolor{stringliteral}{"failed minRatio sanity check"});
441 
442   \textcolor{keywordtype}{double} maxRatio = 0.;
443   auxBuf[0] = finalRatioOfPosPerNode;
444   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &auxBuf[0], (\textcolor{keywordtype}{void} *) &maxRatio, (\textcolor{keywordtype}{int}) 
      auxBuf.size(), \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, \hyperlink{_mpi_comm_8h_a68f3ac7ff71a6504e236b0c95de78178}{RawValue\_MPI\_MAX}, \textcolor{comment}{// LOAD BALANCE}
445                                \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareBalLinkedChains\_inter0()"},
446                                \textcolor{stringliteral}{"failed MPI.Allreduce() for max"});
447   \textcolor{comment}{//std::cout << m\_env.worldRank() << ", maxRatio = " << maxRatio << std::endl;}
448   \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(maxRatio != finalRatioOfPosPerNode,
449                       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
450                       \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareBalLinkedChains\_inter0()"},
451                       \textcolor{stringliteral}{"failed maxRatio sanity check"});
452 
454   \textcolor{comment}{// Proc 0 now broadcasts the information on 'finalNumChainsPerNode'}
456 \textcolor{comment}{}  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} finalNumChainsPerNodeSize = finalNumChainsPerNode.size();
457   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &finalNumChainsPerNodeSize, (\textcolor{keywordtype}{int}) 1, 
      \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 0, \textcolor{comment}{// LOAD BALANCE}
458                            \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareBalLinkedChains\_inter0()"},
459                            \textcolor{stringliteral}{"failed MPI.Bcast() for finalNumChainsPerNode size"});
460   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() > 0) finalNumChainsPerNode.resize(finalNumChainsPerNodeSize);
461 
462   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &finalNumChainsPerNode[0], (\textcolor{keywordtype}{int}) 
      finalNumChainsPerNodeSize, \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 0, \textcolor{comment}{// LOAD BALANCE}
463                            \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareBalLinkedChains\_inter0()"},
464                            \textcolor{stringliteral}{"failed MPI.Bcast() for finalNumChainsPerNode data"});
465 
467   \textcolor{comment}{// Mpi exchange information between nodes and properly populate}
468   \textcolor{comment}{// balancedLinkControl.linkedChains at each node}
470 \textcolor{comment}{}  \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1bb275df38553b88e2196103c7f5ea46}{mpiExchangePositions\_inter0}(prevChain,
471                               exchangeStdVec,
472                               finalNumChainsPerNode,
473                               finalNumPositionsPerNode, \textcolor{comment}{// It is already valid at all "management" nodes
       (not only at node 0) because of the sanity check above}
474                               balancedLinkControl);
475 
476   \textcolor{keywordflow}{return};
477 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a37dcf4d893b6c8f67fe077892bada773}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!prepare\-Unb\-Linked\-Chains\-\_\-inter0@{prepare\-Unb\-Linked\-Chains\-\_\-inter0}}
\index{prepare\-Unb\-Linked\-Chains\-\_\-inter0@{prepare\-Unb\-Linked\-Chains\-\_\-inter0}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{prepare\-Unb\-Linked\-Chains\-\_\-inter0}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::prepare\-Unb\-Linked\-Chains\-\_\-inter0 (
\begin{DoxyParamCaption}
\item[{unsigned int}]{index\-Of\-First\-Weight, }
\item[{unsigned int}]{index\-Of\-Last\-Weight, }
\item[{const std\-::vector$<$ unsigned int $>$ \&}]{unified\-Index\-Counters\-At\-Proc0\-Only, }
\item[{{\bf Unbalanced\-Linked\-Chains\-Per\-Node\-Struct} \&}]{unbalanced\-Link\-Control}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a37dcf4d893b6c8f67fe077892bada773}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em index\-Of\-First\-Weight,index\-Of\-Last\-Weight,unified\-Index\-Counters\-At\-Proc0\-Only} & \\
\hline
\mbox{\tt out}  & {\em unbalanced\-Link\-Control} & \\
\hline
\end{DoxyParams}


Definition at line 481 of file M\-L\-Sampling.\-C.



References Q\-U\-E\-S\-O\-::\-Unbalanced\-Linked\-Chain\-Control\-Struct\-::initial\-Position\-Index\-In\-Previous\-Chain, L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, Q\-U\-E\-S\-O\-::\-Unbalanced\-Linked\-Chain\-Control\-Struct\-::number\-Of\-Positions, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-M\-A\-X, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-M\-I\-N, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-S\-U\-M, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-U\-N\-S\-I\-G\-N\-E\-D, Q\-U\-E\-S\-O\-::\-Unbalanced\-Linked\-Chains\-Per\-Node\-Struct\-::unb\-Linked\-Chains, and U\-Q\-\_\-\-F\-A\-T\-A\-L\-\_\-\-T\-E\-S\-T\-\_\-\-M\-A\-C\-R\-O.


\begin{DoxyCode}
486 \{
487   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() < 0) \textcolor{keywordflow}{return};
488 
489   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
490     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Entering
       MLSampling<P\_V,P\_M>::prepareUnbLinkedChains\_inter0()"}
491                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
492                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
493                             << \textcolor{stringliteral}{": indexOfFirstWeight = "} << indexOfFirstWeight
494                             << \textcolor{stringliteral}{", indexOfLastWeight = "}  << indexOfLastWeight
495                             << std::endl;
496   \}
497 
498   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}              subNumSamples = 0;
499   std::vector<unsigned int> unifiedIndexCountersAtAllProcs(0);
500 
501   \textcolor{comment}{// All nodes in 'inter0Comm' should resize to the same size // KAUST3}
502   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} resizeSize = unifiedIndexCountersAtProc0Only.size();
503   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &resizeSize, (\textcolor{keywordtype}{int}) 1, 
      \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 0,
504                            \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareUnbLinkedChains\_inter0()"},
505                            \textcolor{stringliteral}{"failed MPI.Bcast() for resizeSize"});
506   unifiedIndexCountersAtAllProcs.resize(resizeSize,0);
507 
508   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() == 0) unifiedIndexCountersAtAllProcs = 
      unifiedIndexCountersAtProc0Only;
509 
510   \textcolor{comment}{// Broadcast index counters to all nodes}
511   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &unifiedIndexCountersAtAllProcs[0], (\textcolor{keywordtype}{int}) 
      unifiedIndexCountersAtAllProcs.size(), \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 0,
512                            \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareUnbLinkedChains\_inter0()"},
513                            \textcolor{stringliteral}{"failed MPI.Bcast() for unified index counters"});
514 \textcolor{preprocessor}{#if 0 // Use allgatherv ??? for subNumSamples instead}
515 \textcolor{preprocessor}{}  \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
516     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::prepareUnbLinkedChains\_inter0()"}
517                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
518                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
519                             << \textcolor{stringliteral}{":"}
520                             << std::endl;
521     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} r = 0; r < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_aa780721ae0fdeabc5a15e04cb0cad964}{NumProc}(); ++r) \{
522       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"  unifiedIndexCountersAtAllProcs["} << r << \textcolor{stringliteral}{"] = "} << 
      unifiedIndexCountersAtAllProcs[r]
523                               << std::endl;
524     \}
525   \}
526 \textcolor{preprocessor}{#endif}
527 \textcolor{preprocessor}{}  \textcolor{comment}{//for (unsigned int i = 0; i < unifiedIndexCountersAtAllProcs.size(); ++i) \{}
528   \textcolor{comment}{//  *m\_env.subDisplayFile() << "unifiedIndexCountersAtAllProcs[" << i}
529   \textcolor{comment}{//                          << "] = " << unifiedIndexCountersAtAllProcs[i]}
530   \textcolor{comment}{//                          << std::endl;}
531   \textcolor{comment}{//\}}
532 
533   \textcolor{comment}{// Use 'indexOfFirstWeight' and 'indexOfLastWeight' in order to update 'subNumSamples'}
534   \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(indexOfFirstWeight >= unifiedIndexCountersAtAllProcs.size(),
535                       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
536                       \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareUnbLinkedChains\_inter0()"},
537                       \textcolor{stringliteral}{"invalid indexOfFirstWeight"});
538   \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(indexOfLastWeight >= unifiedIndexCountersAtAllProcs.size(),
539                       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
540                       \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareUnbLinkedChains\_inter0()"},
541                       \textcolor{stringliteral}{"invalid indexOfLastWeight"});
542   subNumSamples = 0;
543   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = indexOfFirstWeight; i <= indexOfLastWeight; ++i) \{
544     subNumSamples += unifiedIndexCountersAtAllProcs[i];
545   \}
546 
547   std::vector<unsigned int> auxBuf(1,0);
548 
549   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} minModifiedSubNumSamples = 0;
550   auxBuf[0] = subNumSamples;
551   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &auxBuf[0], (\textcolor{keywordtype}{void} *) &
      minModifiedSubNumSamples, (\textcolor{keywordtype}{int}) auxBuf.size(), \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 
      \hyperlink{_mpi_comm_8h_a8e30f42fdac116861205e83e2aa18042}{RawValue\_MPI\_MIN},
552                                \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareUnbLinkedChains\_inter0()"},
553                                \textcolor{stringliteral}{"failed MPI.Allreduce() for min"});
554 
555   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} maxModifiedSubNumSamples = 0;
556   auxBuf[0] = subNumSamples;
557   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &auxBuf[0], (\textcolor{keywordtype}{void} *) &
      maxModifiedSubNumSamples, (\textcolor{keywordtype}{int}) auxBuf.size(), \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 
      \hyperlink{_mpi_comm_8h_a68f3ac7ff71a6504e236b0c95de78178}{RawValue\_MPI\_MAX},
558                                \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareUnbLinkedChains\_inter0()"},
559                                \textcolor{stringliteral}{"failed MPI.Allreduce() for max"});
560 
561   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} sumModifiedSubNumSamples = 0;
562   auxBuf[0] = subNumSamples;
563   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a72e137e60ef8060efb1ee5fc874fa4b8}{Allreduce}((\textcolor{keywordtype}{void} *) &auxBuf[0], (\textcolor{keywordtype}{void} *) &
      sumModifiedSubNumSamples, (\textcolor{keywordtype}{int}) auxBuf.size(), \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 
      \hyperlink{_mpi_comm_8h_afbf78d291c032aa7f512bc566cee2bd1}{RawValue\_MPI\_SUM},
564                                \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareUnbLinkedChains\_inter0()"},
565                                \textcolor{stringliteral}{"failed MPI.Allreduce() for sum"});
566 
567   \textcolor{comment}{//UQ\_FATAL\_TEST\_MACRO(unifiedRequestedNumSamples != sumModifiedSubNumSamples,}
568   \textcolor{comment}{//                    m\_env.worldRank(),}
569   \textcolor{comment}{//                    "MLSampling<P\_V,P\_M>::prepareUnbLinkedChains\_inter0()",}
570   \textcolor{comment}{//                    "invalid state");}
571 
572   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
573     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"KEY Leaving
       MLSampling<P\_V,P\_M>::prepareUnbLinkedChains\_inter0()"}
574                             << \textcolor{stringliteral}{", level "}                                   << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
575                             << \textcolor{stringliteral}{", step "}                                    << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
576                             << \textcolor{stringliteral}{": subNumSamples = "}                         << subNumSamples
577                             << \textcolor{stringliteral}{", unifiedIndexCountersAtAllProcs.size() = "} << 
      unifiedIndexCountersAtAllProcs.size()
578                             << std::endl;
579     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"KEY Leaving
       MLSampling<P\_V,P\_M>::prepareUnbLinkedChains\_inter0()"}
580                             << \textcolor{stringliteral}{", level "}                      << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+
      \hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
581                             << \textcolor{stringliteral}{", step "}                       << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
582                             << \textcolor{stringliteral}{": minModifiedSubNumSamples = "} << minModifiedSubNumSamples
583                             << \textcolor{stringliteral}{", avgModifiedSubNumSamples = "} << ((double) sumModifiedSubNumSamples)/((
      double) \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a689e4d140c74d495d97eb498714a4b82}{inter0Comm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_aa780721ae0fdeabc5a15e04cb0cad964}{NumProc}())
584                             << \textcolor{stringliteral}{", maxModifiedSubNumSamples = "} << maxModifiedSubNumSamples
585                             << std::endl;
586   \}
587 
588   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} numberOfPositionsToGuaranteeForNode = subNumSamples;
589   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
590     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"KEY In
       MLSampling<P\_V,P\_M>::prepareUnbLinkedChains\_inter0()"}
591                             << \textcolor{stringliteral}{", level "}                                 << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
592                             << \textcolor{stringliteral}{", step "}                                  << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
593                             << \textcolor{stringliteral}{": numberOfPositionsToGuaranteeForNode = "} << 
      numberOfPositionsToGuaranteeForNode
594                             << std::endl;
595   \}
596   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = indexOfFirstWeight; i <= indexOfLastWeight; ++i) \{
597 \textcolor{comment}{//for (unsigned int i = 0; i < unifiedIndexCountersAtAllProcs.size(); ++i) \{ // KAUST4: important}
598     \textcolor{keywordflow}{while} (unifiedIndexCountersAtAllProcs[i] != 0) \{
599       \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 30)) \{
600         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{", numberOfPositionsToGuaranteeForNode = "} << 
      numberOfPositionsToGuaranteeForNode
601                                 << \textcolor{stringliteral}{", unifiedIndexCountersAtAllProcs["}        << i
602                                 << \textcolor{stringliteral}{"] = "}                                     << 
      unifiedIndexCountersAtAllProcs[i]
603                                 << std::endl;
604       \}
605       \textcolor{keywordflow}{if} (unifiedIndexCountersAtAllProcs[i] < numberOfPositionsToGuaranteeForNode) \{
606         UnbalancedLinkedChainControlStruct auxControl;
607         auxControl.initialPositionIndexInPreviousChain = i;
608         auxControl.numberOfPositions = unifiedIndexCountersAtAllProcs[i];
609         unbalancedLinkControl.unbLinkedChains.push\_back(auxControl);
610 
611         numberOfPositionsToGuaranteeForNode -= unifiedIndexCountersAtAllProcs[i];
612         unifiedIndexCountersAtAllProcs[i] = 0;
613       \}
614       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((unifiedIndexCountersAtAllProcs[i] == numberOfPositionsToGuaranteeForNode) &&
615                (unifiedIndexCountersAtAllProcs[i] > 0                                   )) \{
616       \textcolor{comment}{//else \{ // KAUST4}
617         UnbalancedLinkedChainControlStruct auxControl;
618         auxControl.initialPositionIndexInPreviousChain = i;
619         auxControl.numberOfPositions = numberOfPositionsToGuaranteeForNode;
620         unbalancedLinkControl.unbLinkedChains.push\_back(auxControl);
621 
622         unifiedIndexCountersAtAllProcs[i] -= numberOfPositionsToGuaranteeForNode;
623         numberOfPositionsToGuaranteeForNode = 0;
624       \}
625       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((unifiedIndexCountersAtAllProcs[i] == numberOfPositionsToGuaranteeForNode) &&
626                (unifiedIndexCountersAtAllProcs[i] == 0                                  )) \{
627         \textcolor{comment}{// Ok}
628       \}
629       \textcolor{keywordflow}{else} \{
630         \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(\textcolor{keyword}{true}, \textcolor{comment}{// KAUST4}
631                             \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
632                             \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareUnbLinkedChains\_inter0()"},
633                             \textcolor{stringliteral}{"should never get here"});
634       \}
635     \}
636   \}
637   \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(numberOfPositionsToGuaranteeForNode != 0, \textcolor{comment}{// subNumSamples, //
       KAUST4}
638                       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a78b57112bbd0e6dd0e8afec00b40ffa7}{worldRank}(),
639                       \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::prepareUnbLinkedChains\_inter0()"},
640                       \textcolor{stringliteral}{"numberOfPositionsToGuaranteeForNode exited loop with wrong value"});
641   \textcolor{comment}{// FIX ME: swap trick to save memory}
642 
643   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
644     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"KEY Leaving
       MLSampling<P\_V,P\_M>::prepareUnbLinkedChains\_inter0()"}
645                             << \textcolor{stringliteral}{", level "}                                          << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
646                             << \textcolor{stringliteral}{", step "}                                           << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
647                             << \textcolor{stringliteral}{": unbalancedLinkControl.unbLinkedChains.size() = "} << unbalancedLinkControl
      .unbLinkedChains.size()
648                             << std::endl;
649   \}
650 
651   \textcolor{keywordflow}{return};
652 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_aec103dbc7af1af9e982d8c162033e77b}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!print@{print}}
\index{print@{print}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{print}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::print (
\begin{DoxyParamCaption}
\item[{std\-::ostream \&}]{os}
\end{DoxyParamCaption}
) const}}\label{class_q_u_e_s_o_1_1_m_l_sampling_aec103dbc7af1af9e982d8c162033e77b}


T\-O\-D\-O\-: Prints the sequence. 

\begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000039}{Todo}]\-: implement me! \end{DoxyRefDesc}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_aa387be291dd763ce001ea769e87266c4}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!restart\-M\-L@{restart\-M\-L}}
\index{restart\-M\-L@{restart\-M\-L}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{restart\-M\-L}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::restart\-M\-L (
\begin{DoxyParamCaption}
\item[{double \&}]{curr\-Exponent, }
\item[{double \&}]{curr\-Eta, }
\item[{{\bf Sequence\-Of\-Vectors}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{curr\-Chain, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ \&}]{curr\-Log\-Likelihood\-Values, }
\item[{{\bf Scalar\-Sequence}$<$ double $>$ \&}]{curr\-Log\-Target\-Values}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_aa387be291dd763ce001ea769e87266c4}


Restarts M\-L algorithm. 

This method reads the control file and determines the number of lines on it; then it reads the stored values, calls M\-P\-I\-\_\-\-Bcast and processes the read data in all available M\-P\-I nodes.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em curr\-Exponent,curr\-Eta,curr\-Chain,curr\-Log\-Likelihood\-Values,curr\-Log\-Target\-Values.} & \\
\hline
\end{DoxyParams}


Definition at line 2149 of file M\-L\-Sampling.\-C.



References L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, M\-L\-\_\-\-C\-H\-E\-C\-K\-P\-O\-I\-N\-T\-\_\-\-F\-I\-X\-E\-D\-\_\-\-A\-M\-O\-U\-N\-T\-\_\-\-O\-F\-\_\-\-D\-A\-T\-A, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-D\-O\-U\-B\-L\-E, Raw\-Value\-\_\-\-M\-P\-I\-\_\-\-U\-N\-S\-I\-G\-N\-E\-D, Q\-U\-E\-S\-O\-::\-Sequence\-Of\-Vectors$<$ V, M $>$\-::unified\-Read\-Contents(), Q\-U\-E\-S\-O\-::\-Scalar\-Sequence$<$ T $>$\-::unified\-Read\-Contents(), and U\-Q\-\_\-\-F\-A\-T\-A\-L\-\_\-\-T\-E\-S\-T\-\_\-\-M\-A\-C\-R\-O.


\begin{DoxyCode}
2155 \{
2156   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 2)) \{
2157     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"\(\backslash\)n RESTARTING initiating at level "} << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}
2158                             << \textcolor{stringliteral}{"\(\backslash\)n"} << std::endl;
2159   \}
2160 
2161   \textcolor{comment}{//******************************************************************************}
2162   \textcolor{comment}{// Read 'control' file}
2163   \textcolor{comment}{//******************************************************************************}
2164   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} vectorSpaceDim  = 0;
2165   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} quantity1       = 0;
2166   std::string  checkingString(\textcolor{stringliteral}{""});
2167   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a84a239e42ae443cf71db6e03e8159620}{fullRank}() == 0) \{
2168     std::ifstream* ifsVar = \textcolor{keyword}{new} std::ifstream((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.m\_restartInput\_baseNameForFiles + \textcolor{stringliteral}{"
      Control.txt"}).c\_str(),
2169                                               std::ifstream::in);
2170 
2171     \textcolor{comment}{//******************************************************************************}
2172     \textcolor{comment}{// Determine number of lines}
2173     \textcolor{comment}{//******************************************************************************}
2174     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} numLines = std::count(std::istreambuf\_iterator<char>(*ifsVar),
2175                                        std::istreambuf\_iterator<char>(),
2176                                        \textcolor{charliteral}{'\(\backslash\)n'});
2177     ifsVar->seekg(0,std::ios\_base::beg);
2178     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 2)) \{
2179       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Restart input file has "} << numLines
2180                               << \textcolor{stringliteral}{" lines"}
2181                               << std::endl;
2182     \}
2183 
2184     \textcolor{comment}{//******************************************************************************}
2185     \textcolor{comment}{// Read all values}
2186     \textcolor{comment}{//******************************************************************************}
2187     *ifsVar >> \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}; \textcolor{comment}{// 1}
2188     \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(numLines != (
      \hyperlink{_m_l_sampling_8h_a6c830698381e4aa1c55b3b418754ae4b}{ML\_CHECKPOINT\_FIXED\_AMOUNT\_OF\_DATA} + m\_currLevel),
2189                         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a84a239e42ae443cf71db6e03e8159620}{fullRank}(),
2190                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::restartML()"},
2191                         \textcolor{stringliteral}{"number of lines read is different than pre-established number of lines in control
       file"});
2192 
2193     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.clear();
2194     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.resize(m\_currLevel,0.);
2195     *ifsVar >> vectorSpaceDim  \textcolor{comment}{// 2}
2196             >> currExponent    \textcolor{comment}{// 3}
2197             >> currEta         \textcolor{comment}{// 4}
2198             >> quantity1;      \textcolor{comment}{// 5}
2199     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.size(); ++i) \{
2200       *ifsVar >> \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}[i];
2201     \}
2202     *ifsVar >> checkingString; \textcolor{comment}{// 6 = ML\_CHECKPOINT\_FIXED\_AMOUNT\_OF\_DATA}
2203     \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(checkingString != \textcolor{stringliteral}{"COMPLETE"},
2204                         \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a84a239e42ae443cf71db6e03e8159620}{fullRank}(),
2205                         \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::restartML()"},
2206                         \textcolor{stringliteral}{"control txt input file is not complete"});
2207 
2208     \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 2)) \{
2209       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Restart input file has the following information:"}
2210                               << \textcolor{stringliteral}{"\(\backslash\)n m\_currLevel = "}      << m\_currLevel
2211                               << \textcolor{stringliteral}{"\(\backslash\)n vectorSpaceDim = "}   << vectorSpaceDim
2212                               << \textcolor{stringliteral}{"\(\backslash\)n currExponent = "}     << currExponent
2213                               << \textcolor{stringliteral}{"\(\backslash\)n currEta = "}          << currEta
2214                               << \textcolor{stringliteral}{"\(\backslash\)n quantity1 = "}        << quantity1;
2215       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.size(); ++i) \{
2216         *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"\(\backslash\)n ["} << i << \textcolor{stringliteral}{"] = "} << 
      \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}[i];
2217       \}
2218       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << std::endl;
2219     \}
2220 
2221 \textcolor{preprocessor}{#if 0 // For debug only}
2222 \textcolor{preprocessor}{}    std::string tmpString;
2223     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
2224       *ifsVar >> tmpString;
2225       std::cout << \textcolor{stringliteral}{"Just read '"} << tmpString << \textcolor{stringliteral}{"'"} << std::endl;
2226     \}
2227     \textcolor{keywordflow}{while} ((lineId < numLines) && (ifsVar->eof() == \textcolor{keyword}{false})) \{
2228     \}
2229     ifsVar->ignore(maxCharsPerLine,\textcolor{charliteral}{'\(\backslash\)n'});
2230 \textcolor{preprocessor}{#endif}
2231 \textcolor{preprocessor}{}
2232     \textcolor{keyword}{delete} ifsVar;
2233   \} \textcolor{comment}{// if (m\_env.fullRank() == 0)}
2234   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
2235 
2236   \textcolor{comment}{//******************************************************************************}
2237   \textcolor{comment}{// MPI\_Bcast 'm\_currLevel'}
2238   \textcolor{comment}{//******************************************************************************}
2239   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} tmpUint = (\textcolor{keywordtype}{unsigned} int) m\_currLevel;
2240   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &tmpUint, (\textcolor{keywordtype}{int}) 1, 
      \hyperlink{_mpi_comm_8h_a06cbfbc33436f6e0dc8a48ff3c49bdfc}{RawValue\_MPI\_UNSIGNED}, 0, \textcolor{comment}{// Yes, 'fullComm'}
2241                          \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::restartML()"},
2242                          \textcolor{stringliteral}{"failed MPI.Bcast() for m\_currLevel"});
2243   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a84a239e42ae443cf71db6e03e8159620}{fullRank}() != 0) \{
2244     m\_currLevel = tmpUint;
2245   \}
2246 
2247   \textcolor{comment}{//******************************************************************************}
2248   \textcolor{comment}{// MPI\_Bcast the rest of the information just read}
2249   \textcolor{comment}{//******************************************************************************}
2250   std::vector<double> tmpData(\hyperlink{_m_l_sampling_8h_a6c830698381e4aa1c55b3b418754ae4b}{ML\_CHECKPOINT\_FIXED\_AMOUNT\_OF\_DATA}-1+
      m\_currLevel,0.);
2251   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a84a239e42ae443cf71db6e03e8159620}{fullRank}() == 0) \{
2252     tmpData[0] = vectorSpaceDim;
2253     tmpData[1] = currExponent;
2254     tmpData[2] = currEta;
2255     tmpData[3] = quantity1;
2256     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.size(); ++i) \{
2257       tmpData[4+i] = \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}[i];
2258     \}
2259   \}
2260   \textcolor{keywordflow}{else} \{
2261     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.clear();
2262     \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.resize(m\_currLevel,0.);
2263   \}
2264   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_abd6af8db8b0c7fd2f5b62e26477a9537}{Bcast}((\textcolor{keywordtype}{void} *) &tmpData[0], (\textcolor{keywordtype}{int}) tmpData.size(), 
      \hyperlink{_mpi_comm_8h_ad0f503bd9fecfe4e570ca3d15aaf2518}{RawValue\_MPI\_DOUBLE}, 0, \textcolor{comment}{// Yes, 'fullComm'}
2265                          \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::restartML()"},
2266                          \textcolor{stringliteral}{"failed MPI.Bcast() for rest of information read from input file"});
2267   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a84a239e42ae443cf71db6e03e8159620}{fullRank}() != 0) \{
2268     vectorSpaceDim = tmpData[0];
2269     currExponent   = tmpData[1];
2270     currEta        = tmpData[2];
2271     quantity1      = tmpData[3];
2272     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}.size(); ++i) \{
2273       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{m\_logEvidenceFactors}[i] = tmpData[4+i];
2274     \}
2275   \}
2276 
2277   \textcolor{comment}{//******************************************************************************}
2278   \textcolor{comment}{// Process read data in all MPI nodes now}
2279   \textcolor{comment}{//******************************************************************************}
2280   \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}(vectorSpaceDim != \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{m\_vectorSpace}.
      \hyperlink{class_q_u_e_s_o_1_1_vector_space_acd4359dc120905c22ca1064e33787239}{dimGlobal}(),
2281                       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a84a239e42ae443cf71db6e03e8159620}{fullRank}(),
2282                       \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::restartML()"},
2283                       \textcolor{stringliteral}{"read vector space dimension is not consistent"});
2284   \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}((currExponent < 0.) || (currExponent > 1.),
2285                       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a84a239e42ae443cf71db6e03e8159620}{fullRank}(),
2286                       \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::restartML()"},
2287                       \textcolor{stringliteral}{"read currExponent is not consistent"});
2288   \hyperlink{_defines_8h_a56d63d18d0a6d45757de47fcc06f574d}{UQ\_FATAL\_TEST\_MACRO}((quantity1 % \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_ac0345f57e31ef7833e379ed972bd094d}{numSubEnvironments}()) != 0,
2289                       \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a84a239e42ae443cf71db6e03e8159620}{fullRank}(),
2290                       \textcolor{stringliteral}{"MLSampling<P\_V,P\_M>::restartML()"},
2291                       \textcolor{stringliteral}{"read size of chain should be a multiple of the number of subenvironments"});
2292   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} subSequenceSize = 0;
2293   subSequenceSize = ((double) quantity1) / ((double) \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_ac0345f57e31ef7833e379ed972bd094d}{numSubEnvironments}());
2294 
2295   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 2)) \{
2296     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Restart input file has the following information"}
2297                             << \textcolor{stringliteral}{": subSequenceSize = "} << subSequenceSize
2298                             << std::endl;
2299   \}
2300 
2301   \textcolor{comment}{//******************************************************************************}
2302   \textcolor{comment}{// Read three 'data' files}
2303   \textcolor{comment}{//******************************************************************************}
2304   \textcolor{keywordtype}{char} levelSufix[256];
2305   sprintf(levelSufix,\textcolor{stringliteral}{"%d"},m\_currLevel+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}); \textcolor{comment}{// Yes, '+0'}
2306 
2307   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 2)) \{
2308     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"\(\backslash\)n RESTARTING chain at level "} << m\_currLevel
2309                             << \textcolor{stringliteral}{"\(\backslash\)n"} << std::endl;
2310   \}
2311   currChain.unifiedReadContents(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.m\_restartInput\_baseNameForFiles + \textcolor{stringliteral}{"Chain\_l"} + levelSufix
      ,
2312                                 \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.m\_restartInput\_fileType,
2313                                 subSequenceSize);
2314   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
2315 
2316   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 2)) \{
2317     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"\(\backslash\)n RESTARTING like at level "} << m\_currLevel
2318                             << \textcolor{stringliteral}{"\(\backslash\)n"} << std::endl;
2319   \}
2320   currLogLikelihoodValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a6aaf13eda57e55b709d247cfd1ab22bc}{unifiedReadContents}(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.
      m\_restartInput\_baseNameForFiles + \textcolor{stringliteral}{"LogLike\_l"} + levelSufix,
2321                                               \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.m\_restartInput\_fileType,
2322                                               subSequenceSize);
2323   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
2324 
2325   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 2)) \{
2326     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"\(\backslash\)n RESTARTING target at level "} << m\_currLevel
2327                             << \textcolor{stringliteral}{"\(\backslash\)n"} << std::endl;
2328   \}
2329   currLogTargetValues.\hyperlink{class_q_u_e_s_o_1_1_scalar_sequence_a6aaf13eda57e55b709d247cfd1ab22bc}{unifiedReadContents}(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.
      m\_restartInput\_baseNameForFiles + \textcolor{stringliteral}{"LogTarget\_l"} + levelSufix,
2330                                           \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{m\_options}.m\_restartInput\_fileType,
2331                                           subSequenceSize);
2332   \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a0b0779b41ff304058856e97e1d16b4d4}{fullComm}().\hyperlink{class_q_u_e_s_o_1_1_mpi_comm_a4059971c30e023b272fccaa6aa00c426}{Barrier}();
2333 
2334   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 2)) \{
2335     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"\(\backslash\)n RESTARTING done at level "} << m\_currLevel
2336                             << \textcolor{stringliteral}{"\(\backslash\)n"} << std::endl;
2337   \}
2338 
2339   \textcolor{keywordflow}{return};
2340 \}
\end{DoxyCode}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_af71979655e46135b6a3c97b8909321f0}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!sample\-Indexes\-\_\-proc0@{sample\-Indexes\-\_\-proc0}}
\index{sample\-Indexes\-\_\-proc0@{sample\-Indexes\-\_\-proc0}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{sample\-Indexes\-\_\-proc0}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V , class P\-\_\-\-M $>$ void {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::sample\-Indexes\-\_\-proc0 (
\begin{DoxyParamCaption}
\item[{unsigned int}]{unified\-Requested\-Num\-Samples, }
\item[{const std\-::vector$<$ double $>$ \&}]{unified\-Weight\-Std\-Vector\-At\-Proc0\-Only, }
\item[{std\-::vector$<$ unsigned int $>$ \&}]{unified\-Index\-Counters\-At\-Proc0\-Only}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_af71979655e46135b6a3c97b8909321f0}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em unified\-Requested\-Num\-Samples,unified\-Weight\-Std\-Vector\-At\-Proc0\-Only} & \\
\hline
\mbox{\tt out}  & {\em unified\-Index\-Counters\-At\-Proc0\-Only} & \\
\hline
\end{DoxyParams}


Definition at line 93 of file M\-L\-Sampling.\-C.



References L\-E\-V\-E\-L\-\_\-\-R\-E\-F\-\_\-\-I\-D, and Q\-U\-E\-S\-O\-::\-Finite\-Distribution\-::sample().


\begin{DoxyCode}
97 \{
98   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() != 0) \textcolor{keywordflow}{return};
99 
100   \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
101     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Entering MLSampling<P\_V,P\_M>::sampleIndexes\_proc0()"}
102                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
103                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
104                             << \textcolor{stringliteral}{": unifiedRequestedNumSamples = "}               << 
      unifiedRequestedNumSamples
105                             << \textcolor{stringliteral}{", unifiedWeightStdVectorAtProc0Only.size() = "} << 
      unifiedWeightStdVectorAtProc0Only.size()
106                             << std::endl;
107   \}
108 
109 \textcolor{preprocessor}{#if 0 // For debug only}
110 \textcolor{preprocessor}{}  \textcolor{keywordflow}{if} ((\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}()) && (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.
      \hyperlink{class_q_u_e_s_o_1_1_base_environment_a1fe5f244fc0316a0ab3e37463f108b96}{displayVerbosity}() >= 0)) \{
111     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"In MLSampling<P\_V,P\_M>::sampleIndexes\_proc0()"}
112                             << \textcolor{stringliteral}{", level "} << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{m\_currLevel}+\hyperlink{_m_l_sampling_level_options_8h_a68d15eaf394d210effcf584b938206d3}{LEVEL\_REF\_ID}
113                             << \textcolor{stringliteral}{", step "}  << \hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{m\_currStep}
114                             << \textcolor{stringliteral}{":"}
115                             << std::endl;
116     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} numZeros = 0;
117     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < unifiedWeightStdVectorAtProc0Only.size(); ++i) \{
118       *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"  unifiedWeightStdVectorAtProc0Only["} << i
119                               << \textcolor{stringliteral}{"] = "} << unifiedWeightStdVectorAtProc0Only[i]
120                               << std::endl;
121       \textcolor{keywordflow}{if} (unifiedWeightStdVectorAtProc0Only[i] == 0.) numZeros++;
122     \}
123     *\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_a8a0064746ae8dddfece4229b9ad374d6}{subDisplayFile}() << \textcolor{stringliteral}{"Number of zeros in unifiedWeightStdVectorAtProc0Only = "}
       << numZeros
124                             << std::endl;
125   \}
126 \textcolor{preprocessor}{#endif}
127 \textcolor{preprocessor}{}
128   \textcolor{keywordflow}{if} (\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env}.\hyperlink{class_q_u_e_s_o_1_1_base_environment_ae106b5bb8a80b655b88b3a26b1e7c185}{inter0Rank}() == 0) \{
129     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} resizeSize = unifiedWeightStdVectorAtProc0Only.size();
130     unifiedIndexCountersAtProc0Only.resize(resizeSize,0);
131 
132     \textcolor{comment}{// Generate 'unifiedRequestedNumSamples' samples from 'tmpFD'}
133     FiniteDistribution tmpFd(\hyperlink{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{m\_env},
134                                     \textcolor{stringliteral}{""},
135                                     unifiedWeightStdVectorAtProc0Only);
136     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < unifiedRequestedNumSamples; ++i) \{
137       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} index = tmpFd.sample();
138       unifiedIndexCountersAtProc0Only[index] += 1;
139     \}
140   \}
141 
142   \textcolor{keywordflow}{return};
143 \}
\end{DoxyCode}


\subsection{Friends And Related Function Documentation}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a5a8aa9e185dfa1698ec94d6709895d2c}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!operator$<$$<$@{operator$<$$<$}}
\index{operator$<$$<$@{operator$<$$<$}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{operator$<$$<$}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ std\-::ostream\& operator$<$$<$ (
\begin{DoxyParamCaption}
\item[{std\-::ostream \&}]{os, }
\item[{const {\bf M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$ \&}]{obj}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [friend]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a5a8aa9e185dfa1698ec94d6709895d2c}


Definition at line 202 of file M\-L\-Sampling.\-h.


\begin{DoxyCode}
203                                       \{
204     obj.print(os);
205     \textcolor{keywordflow}{return} os;
206   \}
\end{DoxyCode}


\subsection{Member Data Documentation}
\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!m\-\_\-curr\-Level@{m\-\_\-curr\-Level}}
\index{m\-\_\-curr\-Level@{m\-\_\-curr\-Level}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{m\-\_\-curr\-Level}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ unsigned int {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-curr\-Level\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_af9416874c856e50f3b35270e801f17e4}


Current level. 



Definition at line 464 of file M\-L\-Sampling.\-h.

\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!m\-\_\-curr\-Step@{m\-\_\-curr\-Step}}
\index{m\-\_\-curr\-Step@{m\-\_\-curr\-Step}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{m\-\_\-curr\-Step}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ unsigned int {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-curr\-Step\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a1b1f8ccb4823bdfa26ec652f0807c63e}


Curret step. 



Definition at line 467 of file M\-L\-Sampling.\-h.

\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_abdd5cd35419283c33cc40a77d0f4f07f}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!m\-\_\-debug\-Exponent@{m\-\_\-debug\-Exponent}}
\index{m\-\_\-debug\-Exponent@{m\-\_\-debug\-Exponent}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{m\-\_\-debug\-Exponent}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ double {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-debug\-Exponent\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_abdd5cd35419283c33cc40a77d0f4f07f}


Exponent for debugging. 



Definition at line 470 of file M\-L\-Sampling.\-h.

\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_abec7f8cf9da08bc5c0a20d99fa4570af}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!m\-\_\-eig@{m\-\_\-eig}}
\index{m\-\_\-eig@{m\-\_\-eig}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{m\-\_\-eig}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ double {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-eig\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_abec7f8cf9da08bc5c0a20d99fa4570af}


Definition at line 474 of file M\-L\-Sampling.\-h.

\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!m\-\_\-env@{m\-\_\-env}}
\index{m\-\_\-env@{m\-\_\-env}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{m\-\_\-env}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ const {\bf Base\-Environment}\& {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-env\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a13f1ca4fe9f94822fe572a743eaced1d}


Queso enviroment. 



Definition at line 442 of file M\-L\-Sampling.\-h.



Referenced by Q\-U\-E\-S\-O\-::\-M\-L\-Sampling$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::\-M\-L\-Sampling().

\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_ab08c3059d23460db49b229aa88bd4e70}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!m\-\_\-likelihood\-Function@{m\-\_\-likelihood\-Function}}
\index{m\-\_\-likelihood\-Function@{m\-\_\-likelihood\-Function}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{m\-\_\-likelihood\-Function}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ const {\bf Base\-Scalar\-Function}$<$P\-\_\-\-V,P\-\_\-\-M$>$\& {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-likelihood\-Function\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_ab08c3059d23460db49b229aa88bd4e70}


Likelihood function. 



Definition at line 448 of file M\-L\-Sampling.\-h.

\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_afad63c42dccb1518319bf677f2bffde0}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!m\-\_\-log\-Evidence@{m\-\_\-log\-Evidence}}
\index{m\-\_\-log\-Evidence@{m\-\_\-log\-Evidence}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{m\-\_\-log\-Evidence}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ double {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-log\-Evidence\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_afad63c42dccb1518319bf677f2bffde0}


Definition at line 472 of file M\-L\-Sampling.\-h.

\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!m\-\_\-log\-Evidence\-Factors@{m\-\_\-log\-Evidence\-Factors}}
\index{m\-\_\-log\-Evidence\-Factors@{m\-\_\-log\-Evidence\-Factors}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{m\-\_\-log\-Evidence\-Factors}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ std\-::vector$<$double$>$ {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-log\-Evidence\-Factors\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a75f2ceab4a2c6774b3fa07d74221dbf3}


Definition at line 471 of file M\-L\-Sampling.\-h.

\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_aec4229773274b58e3eaa49a77738389f}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!m\-\_\-mean\-Log\-Likelihood@{m\-\_\-mean\-Log\-Likelihood}}
\index{m\-\_\-mean\-Log\-Likelihood@{m\-\_\-mean\-Log\-Likelihood}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{m\-\_\-mean\-Log\-Likelihood}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ double {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-mean\-Log\-Likelihood\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_aec4229773274b58e3eaa49a77738389f}


Definition at line 473 of file M\-L\-Sampling.\-h.

\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_afbe27e6149562020663b72da6592d933}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!m\-\_\-num\-Disabled\-Parameters@{m\-\_\-num\-Disabled\-Parameters}}
\index{m\-\_\-num\-Disabled\-Parameters@{m\-\_\-num\-Disabled\-Parameters}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{m\-\_\-num\-Disabled\-Parameters}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ unsigned int {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-num\-Disabled\-Parameters\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_afbe27e6149562020663b72da6592d933}


Definition at line 456 of file M\-L\-Sampling.\-h.

\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!m\-\_\-options@{m\-\_\-options}}
\index{m\-\_\-options@{m\-\_\-options}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{m\-\_\-options}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ {\bf M\-L\-Sampling\-Options} {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-options\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_af8504cc57ec72b3c52833826b2bfff8e}


Options for the M\-L algorithm. 



Definition at line 461 of file M\-L\-Sampling.\-h.



Referenced by Q\-U\-E\-S\-O\-::\-M\-L\-Sampling$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::\-M\-L\-Sampling().

\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_ac76690384f70d74b8662faf7a051449e}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!m\-\_\-parameter\-Enabled\-Status@{m\-\_\-parameter\-Enabled\-Status}}
\index{m\-\_\-parameter\-Enabled\-Status@{m\-\_\-parameter\-Enabled\-Status}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{m\-\_\-parameter\-Enabled\-Status}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ std\-::vector$<$bool$>$ {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-parameter\-Enabled\-Status\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_ac76690384f70d74b8662faf7a051449e}


Definition at line 458 of file M\-L\-Sampling.\-h.

\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_aa45e9c06bd51cae0dc2294af1831c158}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!m\-\_\-prior\-Rv@{m\-\_\-prior\-Rv}}
\index{m\-\_\-prior\-Rv@{m\-\_\-prior\-Rv}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{m\-\_\-prior\-Rv}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ const {\bf Base\-Vector\-R\-V}$<$P\-\_\-\-V,P\-\_\-\-M$>$\& {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-prior\-Rv\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_aa45e9c06bd51cae0dc2294af1831c158}


Prior R\-V. 



Definition at line 445 of file M\-L\-Sampling.\-h.

\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a21525858e93a7d9654fdf68c8ac25576}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!m\-\_\-target\-Domain@{m\-\_\-target\-Domain}}
\index{m\-\_\-target\-Domain@{m\-\_\-target\-Domain}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{m\-\_\-target\-Domain}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ {\bf Vector\-Set}$<$P\-\_\-\-V,P\-\_\-\-M$>$$\ast$ {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-target\-Domain\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a21525858e93a7d9654fdf68c8ac25576}


Domain of the target P\-D\-F\-: intersection of the domains of the prior P\-Df and likelihood function. 



Definition at line 454 of file M\-L\-Sampling.\-h.

\hypertarget{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}{\index{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}!m\-\_\-vector\-Space@{m\-\_\-vector\-Space}}
\index{m\-\_\-vector\-Space@{m\-\_\-vector\-Space}!QUESO::MLSampling@{Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}}
\subsubsection[{m\-\_\-vector\-Space}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class P\-\_\-\-V, class P\-\_\-\-M$>$ const {\bf Vector\-Space}$<$P\-\_\-\-V,P\-\_\-\-M$>$\& {\bf Q\-U\-E\-S\-O\-::\-M\-L\-Sampling}$<$ P\-\_\-\-V, P\-\_\-\-M $>$\-::m\-\_\-vector\-Space\hspace{0.3cm}{\ttfamily [private]}}}\label{class_q_u_e_s_o_1_1_m_l_sampling_a7bc4c72f65ba9166ed94a6e198b0915b}


\hyperlink{class_q_u_e_s_o_1_1_vector}{Vector} space. 



Definition at line 451 of file M\-L\-Sampling.\-h.



The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
src/stats/inc/\hyperlink{_m_l_sampling_8h}{M\-L\-Sampling.\-h}\item 
src/stats/src/\hyperlink{_m_l_sampling_8_c}{M\-L\-Sampling.\-C}\end{DoxyCompactItemize}
