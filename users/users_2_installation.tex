\chapter{Installation}\label{ch-install}
\thispagestyle{headings}
\markboth{Chapter \ref{ch-install}: Installation}{Chapter \ref{ch-install}: Installation}

This chapter describes how to install QUESO, test it and use it to create your application.

\section{Installation S}

There are eight steps to make the QUESO Library available at your LINUX computing system.
They are listed below, with examples of commands:
%
\begin{enumerate}
\item {prepare your LINUX environment (assuming csh; some commands might be enough): % item 1
\begin{itemize}
\item module load gnu
\item module load openmpi
\item {
\begin{verbatim}
setenv LD_LIBRARY_PATH \$LD_LIBRARY_PATH:
       /home/johndoe/Installations/gsl_1_12/lib:
       /home/johndoe/Installations/boost_1_37_0/lib:
       /home/johndoe/Installations/hpct_0_25_1/lib
\end{verbatim}
}
\item setenv CC gcc
\item setenv CXX g++
\item setenv MPICC mpicc
\item setenv MPICXX mpic++
\item setenv F77 f77
\item setenv FC gfortran
\end{itemize}
}
\item {install five packages: % item 2
\begin{itemize}
\item GNU Scientific Library (GSL)~\cite{Gsl}, e.g GSL 1.12,
\item Boost C++ Libraries~\cite{Boost}, e.g. Boost 1.37.0,
\item MPI Library, e.g. Open MPI~\cite{Openmpi} or MPICH~\cite{Mpich},
\item Trilinos Library~\cite{Trilinos}, e.g. Trilinos 9.0.2, and
\item {High Performance Computing Toolkit (HPCT)~\cite{Hpct}, e.g. HPCT 0.25.1.
\begin{itemize}
\item {
\begin{verbatim}
./configure --prefix=/home/johndoe/Installations/hpct_0_25_1 \
  --with-boost=/home/johndoe/Installations/boost_1_37_0
\end{verbatim}
}
\item make
\item make install
\item note: the directory '/home/johndoe/Installations/hpct\_0\_25\_1' does not need to exist in advance, since it will be created by the command 'make install' above.
\end{itemize}
}
\end{itemize}
}
\item {untar the QUESO tar.gz file (more comments in Section \ref{sc-source-dir-structure}): % item 3
\begin{itemize}
\item cd /home/johndoe
\item mkdir queso\_download
\item cd /home/johndoe/queso\_download
\item mv $<$ORIGINAL\_LOCATION$>$queso-0.41.0.tar.gz .
\item tar -zxvf queso-0.41.0.tar
\end{itemize}
}
\item {configure the QUESO building environment: % item 4
\begin{itemize}
\item cd /home/johndoe/queso\_download/queso-0.41.0
%\item ./bootstrap
\item {
\begin{verbatim}
./configure --prefix=/home/johndoe/Installations/queso_0_41_0_gnu \
  --with-trilinos=/home/johndoe/Installations/trilinos_9_0_2 \
  --with-boost=/home/johndoe/Installations/boost_1_37_0 \
  --with-gsl-prefix=/home/johndoe/Installations/gsl_1_12 \
  --with-hpct-prefix=/home/johndoe/Installations/hpct_0_25_1 \
  CXXFLAGS=''-DMPICH_IGNORE_CXX_SEEK -O3 -Wall -wd383 -wd981 -wd1572''
\end{verbatim}
}
\item if you want to see the full list of configure options, just run ``./configure --help''
\item note: the directory '/home/johndoe/Installations/queso\_0\_41\_0\_gnu' does not need to exist in advance, since it will be created in step 7.
\end{itemize}
}
\item {compile the QUESO source code (library, examples and tests): % item 5
\begin{itemize}
\item make
\end{itemize}
}
\item {check the compiled source (more comments in Section \ref{sc-checks}): % item 6
\begin{itemize}
\item make check
\end{itemize}
}
\item {install the QUESO library (more comments in Section \ref{sc-installed-dir-structure}): % item 7
\begin{itemize}
\item make install
\end{itemize}
}
\item {create the documentation in html format: % item 8
\begin{itemize}
\item make docs
\item firefox docs/html/index.html
\end{itemize}
}
\end{enumerate}
%%
%These steps are described in Sections~\ref{section:download}
%through~\ref{section:compile}.

%\section{Download} \label{section:download}
%There are two methods for obtaining the QUESO source code: the PECOS
%subversion repository and downloading the latest released version from
%?? (FIX ME: Does a download location exist?).  If you have read access
%to the PECOS subversion repository, you may obtain the code directly
%from the repository:
%%
%\begin{verbatim}
%svn co https://svn.ices.utexas.edu/repos/pecos/uq/queso <WORK_DIR>
%\end{verbatim}
%%
%where \verb+<WORK_DIR>+ denotes the desired download location.  If you
%do not have access to the repository, the latest QUESO release may be
%downloaded from ??.  After
%downloading the source tarball to \verb+<WORK_DIR>+, unpack the source
%as follows:
%%
%\begin{verbatim}
%cd <WORK_DIR>
%tar -zxvf queso_0.41.0.tar.gz (FIX ME: check tarball name)
%\end{verbatim}
%%

%\section{Configure the Build Environment} \label{section:configure}
%After downloading the source code, move into the top-level QUESO
%directory to configure the build environment.  Depending on how you
%obtained the source, this directory will be different.  If you
%obtained the source from the subversion repository,
%%
%\begin{verbatim}
%cd <WORK_DIR>/branches/0.41.0
%\end{verbatim}
%%
%If you downloaded the source from ?? and unpacked the tarball,
%%
%\begin{verbatim}
%cd <WORK_DIR>/queso_0.41.0
%\end{verbatim}
%%

%To configure the build environment, the \verb+configure+ script will
%be run.  The \verb+configure+ script is not stored on the subversion
%repository.  Thus, you may need to generate it using the
%\verb+bootstrap+ utility:
%%
%\begin{verbatim}
%./bootstrap
%\end{verbatim}
%%
%Then, to prepare the build environment, run
%%
%\begin{verbatim}
%./configure
%\end{verbatim}
%%
%The \verb+configure+ script accepts many options that you may use to
%customize the build environment.  For example, specifying
%\verb+--prefix=<INSTALL_DIR>+ sets \verb+<INSTALL_DIR>+ as the
%installation location used by the \verb+make install+ target, and
%specifiying \verb+--with-trilinos=<TRI_DIR>+ indicates that
%\verb+<TRI_DIR>+ is the root directory of your Trilinos installation.
%You may also use environment variables---e.g., \verb+CXX+ and
%\verb+CXXFLAGS+---to override default choices made by the
%\verb+configure+ script.

%To see the full list of configure options for item 3 above, use
%\begin{verbatim}
%./configure --help
%\end{verbatim}
%%

%\section{Compile the Code} \label{section:compile}
%After successfully running \verb+configure+, type
%%
%\begin{verbatim}
%make
%make install
%\end{verbatim}
%%
%to build and install the QUESO Tool libraries, headers, and examples.

\section{The Source Directory Structure} \label{sc-source-dir-structure}

The QUESO source directory contains three main directories. They are listed below and more
information about them can be obtained with the html documentation from step 8 above:
\begin{itemize}
\item {'libs', with five subdirectories:
\begin{itemize}
\item 'libs/core/', with 'inc' and 'src' subdirectories,
\item 'libs/misc/', with 'inc' and 'src' subdirectories,
\item 'libs/basic/', with 'inc' and 'src' subdirectories,
\item 'libs/stats/', with 'inc' and 'src' subdirectories, and
\item 'libs/interface/'.
\end{itemize}
}
\item {'examples', with four subdirectories:
\begin{itemize}
\item 'examples/statisticalForwardProblem/',
\item 'examples/statisticalInverseProblem1/',
\item 'examples/validationCycle/', and
\item 'examples/validationCycle2/'.
\end{itemize}
}
\item {'test', with four subdirectories:
\begin{itemize}
\item 'test/t01\_valid\_cycle/',
\item 'test/t02\_sip\_sfp/',
\item 'test/t03\_sequence/', and
\item 'text/gsl\_tests'.
\end{itemize}
}
\end{itemize}

The executables under 'examples/validationCycle2/', 'test/t02\_sip\_sfp/', 'test/t03\_sequence/' and 'test/gsl\_tests/'
have the majority of their codes in *.C files.
They might then be easier to understand than
the other exectuables in 'examples' and 'test/t01\_valid\_cycle', which
have the majority of their codes in *.h files, with templated routines.
It should be clear, though, that all executables might be implemented in either *.h or *.C files.
It is a matter of how generic you want your application to be.

\section{Checking the Compiled Source} \label{sc-checks}

Just run 'make ckeck' at the same directory where 'configure' and 'make' were run.
Many printouts will appear in the screen, but towards the end of them you should see
a message like:
\begin{verbatim}
==================
All 2 tests passed
==================
\end{verbatim}

The 2 tests mentioned in this message are the ones under 'test/t01\_valid\_cycle' and
'test/t02\_sip\_sfp'. These tests are used as part of the periodic QUESO regression tests.
The code for 't02\_sip\_sfp' is mentioned in Subsection \ref{subsc-t02} and is explained in more detail in Chapter \ref{ch-appl-example}.

\section{Running the Executables Provided with QUESO} \label{sc-running-execs}

This section assumes that you have successfully executed steps 1 through 6 above.
The codes listed in this section have explanations inside themselves, and some of them
print messages during execution to make it clearer what is going on.

\subsection{Executable at 'examples/statisticalInverseProblem1/'}

Just run the following commands:
\begin{itemize}
\item cd /home/johndoe/queso\_download/queso-0.41.0/
\item cd examples/statisticalInverseProblem1/tests/test\_2009\_02\_03/
\item rm outputData/*
\item ../../src/exStatisticalInverseProblem1\_gsl sip.inp [this will take some seconds]
\item matlab
\item {[inside matlab]} sip\_plot
\item {[press the left button of the mouse at a picture displayed by 'sip\_plot.m', in order to display the next picture]}
\item {[inside matlab]} exit
\item ls -l outputData/*.png
\end{itemize}

\subsection{Executable at 'examples/statisticalForwardProblem/'}

Just run the following commands:
\begin{itemize}
\item cd /home/johndoe/queso\_download/queso-0.41.0/
\item cd examples/statisticalForwardProblem1/tests/test\_2009\_02\_11/
\item rm outputData/*
\item ../../src/exStatisticalForwardProblem1\_gsl sfp.inp [this will take some seconds]
\item matlab
\item {[inside matlab] sfp\_plot}
\item {[press the left button of the mouse at a picture displayed by 'sfp\_plot.m', in order to display the next picture]}
\item {[inside matlab]} exit
\item ls -l outputData/*.png
\end{itemize}

%\subsection{Executable at 'examples/validationCycle/'}

%$~$\\

\subsection{Executable at 'test/t02\_sip\_sfp/sip\_sfp/'}\label{subsc-t02}

Just run the following commands:
\begin{itemize}
\item cd /home/johndoe/queso\_download/queso-0.41.0/
\item cd test/t02\_sip\_sfp/sip\_sfp/
\item rm outputData/*
\item ./SipSfpExample\_gsl example.inp [this will take some seconds]
\item matlab
\item {[inside matlab]} example\_plots
\item {[press the left button of the mouse at a picture displayed by 'example\_plots.m', in order to display the next picture]}
\item {[inside matlab]} exit
\item ls -l outputData/*.png
\end{itemize}

\section{The Installed Directory Structure} \label{sc-installed-dir-structure}

This section assumes you have successfully executed steps 1 through 7 above.
The QUESO installed directory contains three main directories:
\begin{itemize}
\item 'lib',
\item 'include', and
\item {'examples', with two subdirectories:
\begin{itemize}
\item 'examples/basic/',
\item 'examples/advanced/'.
\end{itemize}
}
\end{itemize}

\section{Create your Application with the installed QUESO} \label{sc-use-queso}

Prepare your environment by running
\begin{verbatim}
setenv LD_LIBRARY_PATH \$LD_LIBRARY_PATH:
       /home/johndoe/Installations/queso_0_41_0_gnu/lib
\end{verbatim}

An example Makefile is given below:
\begin{verbatim}
# BEGIN OF MAKEFILE
QUESO_DIR = /home/johndoe/Installations/queso_0_41_0_gnu/
TRILINOS_DIR = /home/johndoe/Installations/trilinos_9_0_2/
BOOST_DIR = /home/johndoe/Installations/boost_1_37_0/
GSL_DIR = /home/johndoe/Installations/gsl_1_12/
HPCT_DIR = /home/johndoe/Installations/hpct_0_25_1/

include $(TRILINOS_DIR)/include/Makefile.export.epetra

INC_PATHS = \
	-I. \
	-I$(QUESO_DIR)/include \
	-I$(MPI_DIR)/include \
	-I$(BOOST_DIR)/include/boost_1_37_0 \
	-I$(GSL_DIR)/include \
	-I$(HPCT_DIR)/include \
	$(EPETRA_INCLUDES)

LIBS = \
	-L$(QUESO_DIR)/lib \
	-lqueso \
	-L$(MPI_DIR)/lib \
	-L$(TRILINOS_DIR)/lib \
	-L$(BOOST_DIR)/lib \
	-lboost_program_options \
	-L$(GSL_DIR)/lib \
	-lgsl \
	-L$(HPCT_DIR)/lib \
	-lhpct \
	$(EPETRA_LIBS)

CXX = mpic++
CXXFLAGS += -O3 -Wall -c

default: all

.SUFFIXES: .o .C

all:	ex_gsl

clean:
	rm -f *~
	rm -f *.o
	rm -f example

ex_gsl: example_main.o example_likelihood.o example_qoi.o example_compute.o
	$(CXX) example_main.o \
	       example_likelihood.o \
	       example_qoi.o \
	       example_compute.o \
	       -o example_gsl $(LIBS)

%.o: %.C
	$(CXX) $(INC_PATHS) $(CXXFLAGS) $<
# END OF MAKEFILE
\end{verbatim}

More documentation is provided in Chapter \ref{ch-appl-example}.
