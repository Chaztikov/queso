\chapter{Installation}\label{ch-install}
\thispagestyle{headings}
\markboth{Chapter \ref{ch-install}: Installation}{Chapter \ref{ch-install}: Installation}

%This chapter describes how to install QUESO, test it and use it to create your application.

  
This chapter covers some of the basics that a user will need to know when beginning to use QUESO, such as 
how to obtain, configure, build, install, test \Queso\footnote{For the most up-to-date information,
please visit the online \Queso{} Home Page: \Quesoweb. The most accurate and complete information will be kept at this site.}
and use it to create your application.


        
\section{Pre-QUESO installation steps}\label{sec:Pre_Queso}


Herein, suppose you want to install QUESO and its dependencies on 
\begin{center}
\texttt{\$HOME/Installations/} 
\end{center}
%
so that you will not need root access rights. 

There are two main steps to prepare your LINUX computing system  for  the QUESO Library: obtain and install \Queso{} dependencies, and to define a number of environmental variables. These steps are discussed bellow.


\subsection{Obtain and install \Queso{} dependencies}

\Queso{} interfaces to a number of high-quality software packages to provide certain functionality. While some of them are required for the successful installation of \Queso{}, other may be used for enhancing its performance. 

\Queso dependencies are:
\begin{enumerate}%{itemize}

  \item \textbf{STL}: The Standard Template Library is a C++ library of container classes, algorithms, and iterators; it provides many of the basic algorithms and data structures of computer science~\cite{STL}. % The STL is a generic library, meaning that its components are heavily parameterized: almost every component in the STL is a template. You should make sure that you understand how templates work in C++ before you use the STL.

  \item \textbf{GSL}: The GNU Scientific Library is a numerical library for C and C++ programmers. It provides a wide range of mathematical routines such as random number generators, special functions and least-squares fitting. E.g. GSL 1.12~\cite{Gsl}. %There are over 1000 functions in total with an extensive test suite.

  \item \textbf{Boost}: Boost provides free peer-reviewed portable C++ source libraries, which can be used with the C++ Standard Library. E.g. Boost 1.37.0~\cite{Boost}.

  \item \textbf{MPI}: The Message Passing Interface is a standard for parallel programming using the message passing model. E.g. Open MPI~\cite{Openmpi} or MPICH~\cite{Mpich}. 

  \item \textbf{GRVY}: The Groovy Toolkit (GRVY) is a library used to house various support functions often required for application development of high-performance, scientific applications. The library is written in C++, but provides an API for development in C and Fortran. E.g. GRVY 0.31.0 ~\cite{grvy}.

\end{enumerate}%{itemize}

\Queso{} also works with the following optional libraries:

\begin{enumerate}%{itemize}
\item \textbf{HDF5}: The Hierarchical Data Format 5 is a technology suite that makes possible the management of extremely large and complex data collections. E.g. e.g. HDF5  5-1.8.8~\cite{HDF5}.

\item \textbf{GLPK}: The GNU Linear Programming Kit package is is a set of routines written in ANSI C and organized in the form of a callable library for solving large-scale linear programming, mixed integer programming, and other related problems~\cite{GLPK}. 

\item \textbf{PETSc}: The Portable, Extensible Toolkit for Scientific Computation (PETSc) is a suite of data structures and routines for the scalable (parallel) solution of scientific applications modeled by partial differential equations, including parallel linear and nonlinear solvers~\cite{Petsc}.

\item \textbf{Trilinos}: The Trilinos Project is an effort to develop and implement robust algorithms and enabling technologies using modern object-oriented software design, while still leveraging the value of established libraries. It emphasizes abstract interfaces for maximum flexibility of component interchanging, and provides a full-featured set of concrete classes that implement all abstract interfaces.  E.g. Trilinos 9.0.2~\cite{Trilinos}.
\end{enumerate}%{itemize}

PETSc requires MPI for its functionality. \Queso{} makes use of MPI to when running in parallel for certain operations.
\todo{Is this true? $\Longrightarrow$ } {\color{blue}The parallel version of the library is built upon the foundation provided by MPI. If this library is not available when \Queso{} is configured, only a serial version of \Queso{} can be built.}

% \paragraph*{Note:}
% The basic steps to install GRYV are: 
% \begin{verbatim}
% $ ./configure --prefix=$HOME/Installations/grvy_0_31_0 \
%   --with-boost=$HOME/Installations/boost_1_37_0
% $ make 
% $ make install
% \end{verbatim}
% %
% The directory \texttt{$HOME/Installations/grvy\_0\_31\_0} does not need to exist in advance, since it will be created by the command 'make install' above.



\subsection{Prepare your LINUX environment}

% Step one may differ whether your installation will performed in a stand-alone machine or in a network system which comprises Environment Modules\footnote{\url{http://www.modules.sourceforge.net}}~\footnote{\url{http://www.ices.utexas.edu/sysdocs/linux/modules.html}} to provide easy access to software, such as the one employed in ICES.


Before using QUESO, the user must first set a number of environmental variables, and indicate the full path
of the QUESO's dependencies: GSL, Boost and GVRY. For example, under the UNIX C shell (csh) a command of the form
%export LD_LIBRARY_PATH=\$LD_LIBRARY_PATH:/home/kemelli/LIBRARIES/QUESO_0.45.0/lib
\begin{verbatim}
$ setenv LD_LIBRARY_PATH \$LD_LIBRARY_PATH:
       $HOME/Installations/gsl_1_12/lib:
       $HOME/Installations/boost_1_37_0/lib:
       $HOME/Installations/grvy_0_31_0/lib
\end{verbatim}
can be placed in the user's .bashrc or other startup file. In addition, the user must set the following environmental
variables
\begin{verbatim}
$ setenv CC gcc
$ setenv CXX g++
$ setenv MPICC mpicc
$ setenv MPICXX mpic++
$ setenv F77 f77
$ setenv FC gfortran
\end{verbatim}


Under the UNIX bash shell you may need to replace \texttt{setenv} with \texttt{export}, so a command of the form
\begin{verbatim}
$ setenv CC gcc
\end{verbatim}
is replaced with
\begin{verbatim}
$ export CC=gcc
\end{verbatim}

\section{Obtaining a copy of \Queso{}}

The latest supported public release of \Queso{} is available in the form of a tarball (tar format compressed with gzip) from \Quesoweb{}.

Supposing you have downloaded the file `queso-0.45.1.tar.gz' into \texttt{\$HOME/queso\_download/}, follow the commands to expand the tarball:
\begin{verbatim}
$ cd $HOME/queso_download/
$ gunzip < queso-0.45.1.tar.gz  | tar xf -
$ cd $HOME/queso_download/queso-0.45.1   #enter the folder 
\end{verbatim}

For versions of \Queso{} other than 0.45.1, the file names in the above commands will need to be adjusted.


\subsection{Recommended build directory structure}\label{sec:Queso_tree}

Via Autoconf and Automake the \Queso{} configuration facilities provide a great deal 
of flexibility for configuring and building the existing \Queso{} packages. However,
unless a user has prior experience with Autotools, we very strongly recommend
the following process to build and maintain local builds of \Queso{}.
To start, we defined three useful terms:

\begin{description}
 \item [Source tree] - The directory structure where the \Queso{} source files are located. A source
tree is is typically the result of expanding an \Queso{} distribution source code bundle, such as a tarball.%, or by checking out a copy of the \Queso{} repository.
 \item [Build tree] %- The directory structure where object and library files %, as well as executables 
%are located.
- The tree where \Queso{} was built. It is always related to a specific source tree, and it is the directory structure where object and library files are located. Specifically, this is the tree where you invoked \texttt{configure, make}, etc. to build and install \Queso{}.
 \item [Installation tree] - The tree where \Queso{} was installed. It is typically the ``\texttt{prefix}'' argument given to \Queso{}'s configure script; it is the directory from which you run installed \Queso{} executables.
\end{description}

Although it is possible to run \verb+./configure+ from the source tree (in the directory where the configure file is located), we recommend separate build trees. The greatest advantage to having a separate build tree is that multiple builds of the library
can be maintained from the same source tree~\cite{Trilinos}.
%For example, both serial and parallel libraries can be built. This approach also eliminates problems with configuring in a `dirty' directory (one that has already been configured in).


\section{Configure the QUESO building environment}\label{sec:Queso_configure}
\Queso{} uses the GNU autoconf system for configuration, which detects various features of the host system and creates the Makefiles. %On most systems it should be sufficient to say:
% \begin{verbatim}
% $ ./configure         
% \end{verbatim}
%  
%             Or
%             $ sh configure
% 
The configuration process can be controlled through environment variables, command-line switches, and host configuration files.
For a complete list of switches type:
\begin{verbatim}
$ ./configure  --help       
\end{verbatim}
%
from the top level of the source tree. This command will also display the help page for \Queso{} options.%  when used from the Trilinos home directory in the source tree.
 Many of the \Queso{} configure options are used to describe the details of the build; For instance to include a package that is not currently built by default, HDF5, append \texttt{--with-hdf5=DIR}, where \texttt{DIR} is the root directory of HDF5 installation,  to the configure invocation line. 

 \Queso{} default installation location is `\texttt{/usr/local}', which requires superuser privileges. To use a path
        other than `\texttt{/usr/local}', specify the path with the `\texttt{--prefix=PATH}' switch. For instance `\verb+--prefix=$HOME/Installations+'.



The basic steps to configure QUESO using GRVY, Boost, Trilinos and GSL for installation at `\verb+$HOME/Installations/queso_0_45_1_gnu+' are:
\begin{verbatim}
$ ./configure --prefix=$HOME/Installations/queso_0_45_1_gnu \
  --with-trilinos=$HOME/Installations/trilinos_9_0_2 \
  --with-boost=$HOME/Installations/boost_1_37_0 \
  --with-gsl-prefix=$HOME/Installations/gsl_1_12 \
  --with-gvry=$HOME/Installations/grvy_0_31_0 \
  CXXFLAGS=''-DMPICH_IGNORE_CXX_SEEK -O3 -Wall -wd383 -wd981 -wd1572''
\end{verbatim}

Note: the directory `\verb+$HOME/Installations/queso_0_45_1_gnu+' does not need to exist in advance, since it will be created in Section \ref{sec:install_Queso_make}.


\section{Compile, check and install \Queso{}}
%
The library, confidence tests, and programs can be built by saying just:
\begin{verbatim}
$ make
\end{verbatim}

\Queso{} comes with various test suites, in order to check the compiled source (see more comments in Section \ref{sc-checks}). To run the tests, do:
\begin{verbatim}
$ make check
\end{verbatim}

Finally, the \Queso{} Library, include files, and support programs can be installed by (more comments in Section \ref{sc-installed-dir-structure}):
\begin{verbatim}
$ make install 
\end{verbatim}

The files are installed under the installation tree (refer to Section \ref{sec:Queso_tree}), e.g. the directory specified with `\texttt{--prefix=DIR}' in Section \ref{sec:Queso_configure}. The directory, if not existing, will be created automatically.%, provided the mkdir command supports the -p  option.


\subsection{Checking the compiled source} \label{sc-checks}

By running \texttt{make ckeck} at the build tree (the same directory where 'configure' and 'make' were run), many printouts will appear in the screen, but towards the end of them you should see
a message like:
\begin{verbatim}
==================
All 2 tests passed
==================
\end{verbatim}

The 2 tests mentioned in this message are the ones under \todo{ 'test/t01\_valid\_cycle' and
'test/t02\_sip\_sfp'. These tests are used as part of the periodic QUESO regression tests.
The code for 't02\_sip\_sfp' is mentioned in Subsection \ref{subsc-t02} and is explained in more detail in Chapter \ref{ch-appl-example}.}


\section{\Queso{} documentation}\label{sec:Queso_docs}

\Queso{} documentation is  based on Doxygen~\cite{Doxygen}, and can be regenerated by typing in the main directory:
\begin{verbatim}
$ make docs
\end{verbatim}

A folder named \verb+docs+ will be created in \verb+$HOME/queso_download/queso-0.45.1+ (the build tree; your current path) and you may access the code documentation in two different ways:
\begin{enumerate}
\item HyperText Markup Language (HTML)  format:
\begin{verbatim}
$ cd docs/html
$ firefox index.html
\end{verbatim}

\item Portable Document Format (PDF) format:
\begin{verbatim}
$ cd docs
$ acroread queso.pdf
\end{verbatim}

\end{enumerate}

\section{Summary of installation steps}


Supposing you have downloaded the file `queso-0.45.1.tar.gz' into \texttt{\$HOME/queso\_download/}.
%
The basic steps to configure QUESO using GRVY, Boost, Trilinos and GSL for installation at `\verb+$HOME/Installations/queso_0_45_1_gnu+'  are:

\begin{verbatim}
$ cd $HOME/queso_download/               #enter source tree
$ gunzip < queso-0.45.1.tar.gz  | tar xf -
$ cd $HOME/queso_download/queso-0.45.1   #enter the folder/build tree 
$ ./configure --prefix=$HOME/Installations/queso_0_45_1_gnu \
  --with-trilinos=$HOME/Installations/trilinos_9_0_2 \
  --with-boost=$HOME/Installations/boost_1_37_0 \
  --with-gsl-prefix=$HOME/Installations/gsl_1_12 \
  --with-gvry=$HOME/Installations/grvy_0_31_0 \
  CXXFLAGS=''-DMPICH_IGNORE_CXX_SEEK -O3 -Wall -wd383 -wd981 -wd1572''
$ make 
$ make check
$ make install 
$ make docs
$ ls $HOME/Installations/queso_0_45_1_gnu #listing QUESO installation dir/tree
>>  bin  examples  include  lib
\end{verbatim}

\paragraph*{Note:} According to  Section \ref{sec:Queso_tree}, \texttt{\$HOME/queso\_download/} is the source tree, \\ \verb+$HOME/queso_download/queso-0.45.1+ is the build tree, and \newline
\verb+$HOME/Installations/queso_0_45_1_gnu+ is the installation tree.


%%
%These steps are described in Sections~\ref{section:download}
%through~\ref{section:compile}.

%\section{Download} \label{section:download}
%There are two methods for obtaining the QUESO source code: the PECOS
%subversion repository and downloading the latest released version from
%?? (FIX ME: Does a download location exist?).  If you have read access
%to the PECOS subversion repository, you may obtain the code directly
%from the repository:
%%
%\begin{verbatim}
%svn co https://svn.ices.utexas.edu/repos/pecos/uq/queso <WORK_DIR>
%\end{verbatim}
%%
%where \verb+<WORK_DIR>+ denotes the desired download location.  If you
%do not have access to the repository, the latest QUESO release may be
%downloaded from ??.  After
%downloading the source tarball to \verb+<WORK_DIR>+, unpack the source
%as follows:
%%
%\begin{verbatim}
%cd <WORK_DIR>
%tar -zxvf queso_0.45.1.tar.gz (FIX ME: check tarball name)
%\end{verbatim}
%%

%\section{Configure the Build Environment} \label{section:configure}
%After downloading the source code, move into the top-level QUESO
%directory to configure the build environment.  Depending on how you
%obtained the source, this directory will be different.  If you
%obtained the source from the subversion repository,
%%
%\begin{verbatim}
%cd <WORK_DIR>/branches/0.45.1
%\end{verbatim}
%%
%If you downloaded the source from ?? and unpacked the tarball,
%%
%\begin{verbatim}
%cd <WORK_DIR>/queso_0.45.1
%\end{verbatim}
%%

%To configure the build environment, the \verb+configure+ script will
%be run.  The \verb+configure+ script is not stored on the subversion
%repository.  Thus, you may need to generate it using the
%\verb+bootstrap+ utility:
%%
%\begin{verbatim}
%./bootstrap
%\end{verbatim}
%%
%Then, to prepare the build environment, run
%%
%\begin{verbatim}
%./configure
%\end{verbatim}
%%
%The \verb+configure+ script accepts many options that you may use to
%customize the build environment.  For example, specifying
%\verb+--prefix=<INSTALL_DIR>+ sets \verb+<INSTALL_DIR>+ as the
%installation location used by the \verb+make install+ target, and
%specifiying \verb+--with-trilinos=<TRI_DIR>+ indicates that
%\verb+<TRI_DIR>+ is the root directory of your Trilinos installation.
%You may also use environment variables---e.g., \verb+CXX+ and
%\verb+CXXFLAGS+---to override default choices made by the
%\verb+configure+ script.

%To see the full list of configure options for item 3 above, use
%\begin{verbatim}
%./configure --help
%\end{verbatim}
%%

%\section{Compile the Code} \label{section:compile}
%After successfully running \verb+configure+, type
%%
%\begin{verbatim}
%make
%make install
%\end{verbatim}
%%
%to build and install the QUESO Tool libraries, headers, and examples.


\section{The Source Directory Structure} \label{sc-source-dir-structure}

The QUESO source directory contains three main directories, \texttt{src, examples} and \texttt{test}. They are listed below and more
information about them can be obtained with the html documentation from Section \ref{sec:Queso_docs} above:
\begin{enumerate}
\item \texttt{\bf src}, with five subdirectories:
\begin{enumerate}
\item \texttt{src/basic/}: with \texttt{inc} and \texttt{src} subdirectories,
\item \texttt{src/core/}:  with \texttt{inc} and \texttt{src} subdirectories,
\item \texttt{src/misc/}:  with \texttt{inc} and \texttt{src} subdirectories,
\item \texttt{src/stats/}: with \texttt{inc} and \texttt{src} subdirectories, and
\item \texttt{src/contrib/}.
\end{enumerate}

\item \texttt{\bf examples}, with six subdirectories:
\begin{enumerate}
\item \texttt{examples/statisticalForwardProblem/},
\item \texttt{examples/statisticalInverseProblem1/},
\item \texttt{examples/validationCycle/}, 
\item \texttt{examples/validationCycle2/},
\item \texttt{examples/validationPyramid/},
\item \texttt{examples/infoTheoryProblem/},
\end{enumerate}

\item  \texttt{\bf test}, with five subdirectories:
\begin{enumerate}
\item \texttt{test/t01\_valid\_cycle/},
\item \texttt{test/t02\_sip\_sfp/},
\item \texttt{test/t03\_sequence/}, 
\item \texttt{test/t04\_bimodal/}, and
\item \texttt{test/gsl\_tests}.
\end{enumerate}

\end{enumerate}


The executables under \texttt{test/t02\_sip\_sfp/},  \texttt{test/t03\_sequence/}, \texttt{test/t04\_bimodal/},   \texttt{test/gsl\_tests}, and \texttt{examples/validationCycle2/}, have the majority of their codes in *.C files.
Thus, it might be easier to understand them than the other executables in  \texttt{examples} and \texttt{test/t01\_valid\_cycle/}, which
have the majority of their codes in *.h files, with templated routines.
It should be clear, though, that all executables might be implemented in either *.h or *.C files: it is a matter of how generic you want your application to be.


\subsection{Running the Executables Provided with QUESO} \label{sc-running-execs}

This section assumes that you have successfully executed steps described in Sections \ref{sec:Pre_Queso} through \ref{sec:Queso_docs} above.
The codes listed in this section have explanations inside themselves, and some of them
print messages during execution to make it clearer what is going on.

\subsubsection{Executable at 'examples/statisticalInverseProblem1/'}


Just run the following commands:
\begin{itemize}
\item cd \$HOME/queso\_download/queso-0.45.1/
\item cd examples/statisticalInverseProblem1/tests/test\_2009\_02\_03/
\item rm outputData/*
\item ../../src/exStatisticalInverseProblem1\_gsl sip.inp [this will take some seconds]
\item matlab
\item {[inside matlab]} sip\_plot
\item {[press the left button of the mouse at a picture displayed by 'sip\_plot.m', in order to display the next picture]}
\item {[inside matlab]} exit
\item ls -l outputData/*.png
\end{itemize}

\subsubsection{Executable at 'examples/statisticalForwardProblem/'}

Just run the following commands:
\begin{itemize}
\item cd \$HOME/queso\_download/queso-0.45.1/
\item cd examples/statisticalForwardProblem1/tests/test\_2009\_02\_11/
\item rm outputData/*
\item ../../src/exStatisticalForwardProblem1\_gsl sfp.inp [this will take some seconds]
\item matlab
\item {[inside matlab] sfp\_plot}
\item {[press the left button of the mouse at a picture displayed by 'sfp\_plot.m', in order to display the next picture]}
\item {[inside matlab]} exit
\item ls -l outputData/*.png
\end{itemize}

%\subsection{Executable at 'examples/validationCycle/'}

%$~$\\

\subsubsection{Executable at 'test/t02\_sip\_sfp/sip\_sfp/'}\label{subsc-t02}

Just run the following commands:
\begin{itemize}
\item cd \$HOME/queso\_download/queso-0.45.1/
\item cd test/t02\_sip\_sfp/sip\_sfp/
\item rm outputData/*
\item ./SipSfpExample\_gsl example.inp [this will take some seconds]
\item matlab
\item {[inside matlab]} example\_plots
\item {[press the left button of the mouse at a picture displayed by 'example\_plots.m', in order to display the next picture]}
\item {[inside matlab]} exit
\item ls -l outputData/*.png
\end{itemize}

\section{The Installed Directory Structure} \label{sc-installed-dir-structure}

This section assumes you have successfully executed steps 1 through 7 above.
The QUESO installed directory contains three main directories:
\begin{itemize}
\item 'lib',
\item 'include', and
\item {'examples', with two subdirectories:
\begin{itemize}
\item 'examples/basic/',
\item 'examples/advanced/'.
\end{itemize}
}
\end{itemize}

\section{Create your Application with the installed QUESO} \label{sc-use-queso}

Prepare your environment by running
\begin{verbatim}
setenv LD_LIBRARY_PATH \$LD_LIBRARY_PATH:
       $HOME/Installations/queso_0_45_1_gnu/lib
\end{verbatim}

An example Makefile is given below:
\begin{verbatim}
# BEGIN OF MAKEFILE
QUESO_DIR = $HOME/Installations/queso_0_45_1_gnu/
TRILINOS_DIR = $HOME/Installations/trilinos_9_0_2/
BOOST_DIR = $HOME/Installations/boost_1_37_0/
GSL_DIR = $HOME/Installations/gsl_1_12/
HPCT_DIR = $HOME/Installations/hpct_0_25_1/

include $(TRILINOS_DIR)/include/Makefile.export.epetra

INC_PATHS = \
	-I. \
	-I$(QUESO_DIR)/include \
	-I$(MPI_DIR)/include \
	-I$(BOOST_DIR)/include/boost_1_37_0 \
	-I$(GSL_DIR)/include \
	-I$(HPCT_DIR)/include \
	$(EPETRA_INCLUDES)

LIBS = \
	-L$(QUESO_DIR)/lib \
	-lqueso \
	-L$(MPI_DIR)/lib \
	-L$(TRILINOS_DIR)/lib \
	-L$(BOOST_DIR)/lib \
	-lboost_program_options \
	-L$(GSL_DIR)/lib \
	-lgsl \
	-L$(HPCT_DIR)/lib \
	-lhpct \
	$(EPETRA_LIBS)

CXX = mpic++
CXXFLAGS += -O3 -Wall -c

default: all

.SUFFIXES: .o .C

all:	ex_gsl

clean:
	rm -f *~
	rm -f *.o
	rm -f example

ex_gsl: example_main.o example_likelihood.o example_qoi.o example_compute.o
	$(CXX) example_main.o \
	       example_likelihood.o \
	       example_qoi.o \
	       example_compute.o \
	       -o example_gsl $(LIBS)

%.o: %.C
	$(CXX) $(INC_PATHS) $(CXXFLAGS) $<
# END OF MAKEFILE
\end{verbatim}

More documentation is provided in Chapter \ref{ch-appl-example}.
